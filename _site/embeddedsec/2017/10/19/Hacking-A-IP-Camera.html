<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="author" content="herrfeder"> <meta name="theme-color" content=""> <meta name="keywords" content="iot hacking hardware ARM "> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css"> <link rel="shortcut icon" href="https://ooo.0o0.ooo/2017/05/27/59294212bc16e.png"> <link rel="icon" sizes="192x192" href="https://ooo.0o0.ooo/2017/06/08/5939484dc618e.png"> <link rel="apple-touch-icon" href="https://ooo.0o0.ooo/2017/06/08/5939484dc618e.png"> <title>Hacking An IPCamera Part1</title> <meta name="description" content=""> <link rel="canonical" href="http://localhost:4000/embeddedsec/2017/10/19/Hacking-A-IP-Camera.html"> <link rel="alternate" type="application/rss+xml" title="H4ck and that" href="http://localhost:4000/feed.xml"> <link rel="manifest" href="/manifest.json"> <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script> <script src="https://cdn.bootcss.com/mdui/0.3.0/js/mdui.min.js"></script> <script src="/assets/js/History.js"></script> <link rel="preload" href="https://cdn.bootcss.com/mdui/0.3.0/css/mdui.min.css" as="style" onload="this.rel='stylesheet'"> <link rel="preload" href="/assets/css/global.css" as="style" onload="this.rel='stylesheet'"> <noscript><link rel="stylesheet" href="https://cdn.bootcss.com/mdui/0.3.0/css/mdui.min.css"></noscript> <noscript><link rel="stylesheet" href="/assets/css/global.css"></noscript> <link rel="stylesheet" href="https://cdn.bootcss.com/nprogress/0.2.0/nprogress.min.css"> <script src="https://cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script> <script> $(document).ready(function () { NProgress.configure({ showSpinner: true }); NProgress.start(); $('#nprogress .bar').css({ 'background': '' }); $('#nprogress .peg').css({ 'box-shadow': '0 0 10px , 0 0 15px ' }); $('#nprogress .spinner-icon').css({ 'border-top-color': '', 'border-left-color': '' }); setTimeout(function() { NProgress.done(); },); }); </script> <script> var defaultTitle = document.title; var imgzoom = false; var tagid; jQuery(document).ready(function($) { var siteUrl = 'http://'+(document.location.hostname||document.location.host); var disqusstatus = { flag: false, }; $(document).delegate('a[href^="/"][target!="_blank"],a[href^="'+siteUrl+'"]', "click", function(e) { if(e.currentTarget.id.indexOf('tag_')===0){ tagid = e.currentTarget.id.replace(/tag_/,""); } e.preventDefault(); History.pushState({}, "", this.pathname); NProgress.start(); }); History.Adapter.bind(window, 'statechange', function(){ var State = History.getState(); $.get(State.url, function(data){ $('.mdui-tooltip').remove(); $(".mdui-container").fadeOut(300,function(){ $('.container').html($(data).find('.content')); document.title = data.match(/<title>(.*?)<\/title>/)[1]; defaultTitle = document.title; NProgress.done(); $('#k-menus').html($(data).find('#k-menus').children()); $('#k-mobile-menus').html($(data).find('#k-mobile-menus').children()); $(".content").css('top','50px'); $(".content").css('position','relative'); $(".mdui-container").fadeIn(); $(".content").animate({top:'0px'}); }); }); }); }); </script> <script> !function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this); !function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this); !function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this); !function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this); </script> <script type="text/x-mathjax-config;executed=true"> MathJax.Hub.Config({tex2jax:{processEscapes: true, inlineMath: [ ['$','$'], ["\\(","\\)"] ], skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']}}); MathJax.Hub.Config({TeX:{extensions: ["cancel.js", "enclose.js"], Macros:{a:"\\alpha",b:"\\beta",c:"\\chi",d:"\\delta",e:"\\epsilon",f:"\\phi",g:"\\gamma",h:"\\eta",i:"\\iota",j:"\\varphi",k:"\\kappa",l:"\\lambda",m:"\\mu",n:"\\nu",o:"\\omicron",p:"\\pi",q:"\\theta",r:"\\rho",s:"\\sigma",t:"\\tau",u:"\\upsilon",v:"\\varpi",w:"\\omega",x:"\\xi",y:"\\psi",z:"\\zeta",D:"\\Delta",F:"\\Phi",G:"\\Gamma",J:"\\vartheta",L:"\\Lambda",P:"\\Pi",Q:"\\Theta",S:"\\Sigma",U:"\\Upsilon",V:"\\varsigma",W:"\\Omega",X:"\\Xi",Y:"\\Psi",ve:"\\varepsilon",vk:"\\varkappa",vq:"\\vartheta",vp:"\\varpi",vr:"\\varrho",vs:"\\varsigma",vf:"\\varphi",alg:"\\begin{align}", ealg:"\\end{align}",bmat:"\\begin{bmatrix}", Bmat:"\\begin{Bmatrix}", pmat:"\\begin{pmatrix}", Pmat:"\\begin{Pmatrix}", vmat:"\\begin{vmatrix}", Vmat:"\\begin{Vmatrix}",ebmat:"\\end{bmatrix}", eBmat:"\\end{Bmatrix}", epmat:"\\end{pmatrix}", ePmat:"\\end{Pmatrix}", evmat:"\\end{vmatrix}", eVmat:"\\end{Vmatrix}",AA:"\\unicode{x212B}", Sum:"\\sum\\limits", abs:['\\lvert #1\\rvert',1], rmd:['\\mathop{\\mathrm{d}#1}',1],bi:['\\boldsymbol{#1}', 1], obar:['0\\!\\!\\!\\raise{.05em}{-}'],opar:['\\frac{\\partial #1}{\\partial #2}', 2], oppar:['\\frac{\\partial^2 #1}{\\partial #2^2}', 2]}}}); MathJax.Hub.Queue(function(){ var all=MathJax.Hub.getAllJax(),i;for(i=0;i<all.length;i+=1){all[i].SourceElement().parentNode.className+=' has-jax';}}); </script> <script src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-AMS_CHTML"></script> </head> <body> <style> .k-mdui-headroom-unpinned-top{ box-shadow: none!important; -webkit-transform: translate3d(0,150%,0)!important; transform: translate3d(0,150%,0)!important; } </style> <button id="toTop" style="display:none;z-index: 1;" mdui-headroom="{unpinnedClass:'k-mdui-headroom-unpinned-top'}" class="mdui-fab mdui-color-white mdui-fab-fixed mdui-ripple"><i class="mdui-icon material-icons">expand_less</i></button> <script> (function($){$.fn.scrollToTop=function(options){var config={"speed":800};if(options){$.extend(config,{"speed":options})}return this.each(function(){var $this=$(this);$(window).scroll(function(){if($(this).scrollTop()>100){$this.fadeIn()}else{$this.fadeOut()}});$this.click(function(e){e.preventDefault();$("body, html").animate({scrollTop:0},config.speed)})})};$.fn.scrollBodyToTop=function(options){var config={"speed":800};if(options){$.extend(config,{"speed":options})}return this.each(function(){var $this=$(this);$(".placeholder").scroll(function(){if($(this).scrollTop()>100){$this.fadeIn()}else{$this.fadeOut()}});$this.click(function(e){e.preventDefault();$(".placeholder").animate({scrollTop:0},config.speed)})})}})(jQuery); </script> <script> $("#toTop").scrollToTop(); </script> <style> .k-nav-search-card { position: fixed; width: 268px; z-index: 9999; } .k-navsearch-btn { position: relative; display: inline-block; height: 36px; box-sizing: border-box; padding: 0 16px; margin: 0; overflow: hidden; font-size: 14px; font-weight: 500; line-height: 36px; color: inherit; text-align: center; text-decoration: none; text-transform: uppercase; letter-spacing: .04em; white-space: nowrap; vertical-align: middle; -ms-touch-action: manipulation; touch-action: manipulation; cursor: pointer; zoom: 1; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; background: 0 0; border: none; border-radius: 2px; outline: 0; -webkit-transition: all .2s cubic-bezier(.4,0,.2,1),box-shadow .2s cubic-bezier(.4,0,1,1); transition: all .2s cubic-bezier(.4,0,.2,1),box-shadow .2s cubic-bezier(.4,0,1,1); will-change: box-shadow; -webkit-user-drag: none; } .mdui-textfield-expandable.mdui-textfield-expanded { width: 300px; } .k-header-menus{ display: -webkit-inline-box; display: inline-block; } .typeahead__group-group a{ width: 100%; text-align: left; } </style> <header mdui-headroom class="mdui-appbar mdui-shadow-0 mdui-appbar-fixed"> <div class="mdui-toolbar"> <a href="javascript:;" class="mdui-btn mdui-btn-icon mdui-hidden-sm-up" mdui-drawer="{target: '#k-menu'}"><i class="mdui-icon material-icons">&#xe5d2;</i></a> <a href="/" class="mdui-typo-title">H4CK AND THAT</a> <div class="mdui-toolbar-spacer"></div> <div class="mdui-hidden-xs-down"> <div class="k-header-menus" id="k-menus"> <a href="/" class="mdui-btn mdui-ripple ">HOME</a> <a href="/category/" class="mdui-btn mdui-ripple ">CATEGORY</a> <a href="/tags/" class="mdui-btn mdui-ripple ">TAGS</a> </div> <div class="mdui-textfield k-navsearch-btn mdui-textfield-expandable"> <button class="mdui-textfield-icon k-navsearch-open mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">&#xe8b6;</i></button> <div class="typeahead__container"> <div class="typeahead__field"> <span class="typeahead__query"> <input class="mdui-textfield-input k-nav-search" type="text" placeholder="Search"/> </span> </div> </div> <button class="mdui-textfield-close k-navsearch-close mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">&#xe5cd;</i></button> </div> </div> </div> </header> <div class="mdui-drawer mdui-drawer-close" id="k-menu"> <div class="mdui-textfield"> <div class="typeahead__container"> <div class="typeahead__field"> <span class="typeahead__query"> <i class="mdui-icon material-icons">&#xe8b6;</i> <input class="mdui-textfield-input k-nav-search" type="text" placeholder="Search"/> </span> </div> </div> </div> <ul id="k-mobile-menus" class="mdui-list"> <a href="/" class="mdui-list-item mdui-ripple "> <i class="mdui-list-item-icon mdui-icon material-icons">home</i> <div class="mdui-list-item-content">HOME</div> </a> <a href="/category/" class="mdui-list-item mdui-ripple "> <i class="mdui-list-item-icon mdui-icon material-icons">&#xe53b;</i> <div class="mdui-list-item-content">CATEGORY</div> </a> <a href="/tags/" class="mdui-list-item mdui-ripple "> <i class="mdui-list-item-icon mdui-icon material-icons">&#xe893;</i> <div class="mdui-list-item-content">TAGS</div> </a> </ul> </div> <script> !function(t){"function"==typeof define&&define.amd?define("jquery-typeahead",["jquery"],function(e){return t(e)}):"object"==typeof module&&module.exports?module.exports=function(e,i){return void 0===e&&(e="undefined"!=typeof window?require("jquery"):require("jquery")(i)),t(e)}():t(jQuery)}(function(t){"use strict";window.Typeahead={version:"2.8.0"};var e={input:null,minLength:2,maxLength:!1,maxItem:8,dynamic:!1,delay:300,order:null,offset:!1,hint:!1,accent:!1,highlight:!0,group:!1,groupOrder:null,maxItemPerGroup:null,dropdownFilter:!1,dynamicFilter:null,backdrop:!1,backdropOnFocus:!1,cache:!1,ttl:36e5,compression:!1,searchOnFocus:!1,blurOnTab:!0,resultContainer:null,generateOnLoad:null,mustSelectItem:!1,href:null,display:["display"],template:null,templateValue:null,groupTemplate:null,correlativeTemplate:!1,emptyTemplate:!1,cancelButton:!0,loadingAnimation:!0,filter:!0,matcher:null,source:null,callback:{onInit:null,onReady:null,onShowLayout:null,onHideLayout:null,onSearch:null,onResult:null,onLayoutBuiltBefore:null,onLayoutBuiltAfter:null,onNavigateBefore:null,onNavigateAfter:null,onMouseEnter:null,onMouseLeave:null,onClickBefore:null,onClickAfter:null,onDropdownFilter:null,onSendRequest:null,onReceiveRequest:null,onPopulateSource:null,onCacheSave:null,onSubmit:null,onCancel:null},selector:{container:"typeahead__container",result:"typeahead__result",list:"typeahead__list",group:"typeahead__group",item:"typeahead__item",empty:"typeahead__empty",display:"typeahead__display",query:"typeahead__query",filter:"typeahead__filter",filterButton:"typeahead__filter-button",dropdown:"typeahead__dropdown",dropdownItem:"typeahead__dropdown-item",button:"typeahead__button",backdrop:"typeahead__backdrop",hint:"typeahead__hint",cancelButton:"typeahead__cancel-button"},debug:!1},i=".typeahead",o={from:"ãàáäâẽèéëêìíïîõòóöôùúüûñç",to:"aaaaaeeeeeiiiiooooouuuunc"},s=~window.navigator.appVersion.indexOf("MSIE 9."),n=~window.navigator.appVersion.indexOf("MSIE 10"),r=~window.navigator.userAgent.indexOf("Trident")&&~window.navigator.userAgent.indexOf("rv:11"),a=function(t,e){this.rawQuery=t.val()||"",this.query=t.val()||"",this.selector=t[0].selector,this.deferred=null,this.tmpSource={},this.source={},this.dynamicGroups=[],this.hasDynamicGroups=!1,this.generatedGroupCount=0,this.groupBy="group",this.groups=[],this.searchGroups=[],this.generateGroups=[],this.requestGroups=[],this.result={},this.groupTemplate="",this.resultHtml=null,this.resultCount=0,this.resultCountPerGroup={},this.options=e,this.node=t,this.namespace="."+this.helper.slugify.call(this,this.selector)+i,this.container=null,this.resultContainer=null,this.item=null,this.xhr={},this.hintIndex=null,this.filters={dropdown:{},dynamic:{}},this.dropdownFilter={"static":[],dynamic:[]},this.dropdownFilterAll=null,this.isDropdownEvent=!1,this.requests={},this.backdrop={},this.hint={},this.hasDragged=!1,this.focusOnly=!1,this.__construct()};a.prototype={_validateCacheMethod:function(t){var e,i=["localStorage","sessionStorage"];if(t===!0)t="localStorage";else if("string"==typeof t&&!~i.indexOf(t))return!1;e="undefined"!=typeof window[t];try{window[t].setItem("typeahead","typeahead"),window[t].removeItem("typeahead")}catch(o){e=!1}return e&&t||!1},extendOptions:function(){if(this.options.cache=this._validateCacheMethod(this.options.cache),this.options.compression&&("object"==typeof LZString&&this.options.cache||(this.options.compression=!1)),(!this.options.maxLength||isNaN(this.options.maxLength))&&(this.options.maxLength=1/0),"undefined"!=typeof this.options.maxItem&&~[0,!1].indexOf(this.options.maxItem)&&(this.options.maxItem=1/0),this.options.maxItemPerGroup&&!/^\d+$/.test(this.options.maxItemPerGroup)&&(this.options.maxItemPerGroup=null),this.options.display&&!Array.isArray(this.options.display)&&(this.options.display=[this.options.display]),this.options.group&&(Array.isArray(this.options.group)||("string"==typeof this.options.group?this.options.group={key:this.options.group}:"boolean"==typeof this.options.group&&(this.options.group={key:"group"}),this.options.group.key=this.options.group.key||"group")),this.options.highlight&&!~["any",!0].indexOf(this.options.highlight)&&(this.options.highlight=!1),this.options.dropdownFilter&&this.options.dropdownFilter instanceof Object){Array.isArray(this.options.dropdownFilter)||(this.options.dropdownFilter=[this.options.dropdownFilter]);for(var i=0,s=this.options.dropdownFilter.length;s>i;++i)this.dropdownFilter[this.options.dropdownFilter[i].value?"static":"dynamic"].push(this.options.dropdownFilter[i])}this.options.dynamicFilter&&!Array.isArray(this.options.dynamicFilter)&&(this.options.dynamicFilter=[this.options.dynamicFilter]),this.options.accent&&("object"==typeof this.options.accent?this.options.accent.from&&this.options.accent.to&&this.options.accent.from.length===this.options.accent.to.length:this.options.accent=o),this.options.groupTemplate&&(this.groupTemplate=this.options.groupTemplate),this.options.resultContainer&&("string"==typeof this.options.resultContainer&&(this.options.resultContainer=t(this.options.resultContainer)),this.options.resultContainer instanceof t&&this.options.resultContainer[0]&&(this.resultContainer=this.options.resultContainer)),this.options.maxItemPerGroup&&this.options.group&&this.options.group.key&&(this.groupBy=this.options.group.key),this.options.callback&&this.options.callback.onClick&&(this.options.callback.onClickBefore=this.options.callback.onClick,delete this.options.callback.onClick),this.options.callback&&this.options.callback.onNavigate&&(this.options.callback.onNavigateBefore=this.options.callback.onNavigate,delete this.options.callback.onNavigate),this.options=t.extend(!0,{},e,this.options)},unifySourceFormat:function(){this.dynamicGroups=[],Array.isArray(this.options.source)&&(this.options.source={group:{data:this.options.source}}),"string"==typeof this.options.source&&(this.options.source={group:{ajax:{url:this.options.source}}}),this.options.source.ajax&&(this.options.source={group:{ajax:this.options.source.ajax}}),(this.options.source.url||this.options.source.data)&&(this.options.source={group:this.options.source});var t,e,i;for(t in this.options.source)if(this.options.source.hasOwnProperty(t)){if(e=this.options.source[t],"string"==typeof e&&(e={ajax:{url:e}}),i=e.url||e.ajax,Array.isArray(i)?(e.ajax="string"==typeof i[0]?{url:i[0]}:i[0],e.ajax.path=e.ajax.path||i[1]||null,delete e.url):("object"==typeof e.url?e.ajax=e.url:"string"==typeof e.url&&(e.ajax={url:e.url}),delete e.url),!e.data&&!e.ajax)return!1;e.display&&!Array.isArray(e.display)&&(e.display=[e.display]),e.minLength="number"==typeof e.minLength?e.minLength:this.options.minLength,e.maxLength="number"==typeof e.maxLength?e.maxLength:this.options.maxLength,e.dynamic="boolean"==typeof e.dynamic||this.options.dynamic,e.minLength>e.maxLength&&(e.minLength=e.maxLength),this.options.source[t]=e,this.options.source[t].dynamic&&this.dynamicGroups.push(t),e.cache="undefined"!=typeof e.cache?this._validateCacheMethod(e.cache):this.options.cache,e.compression&&("object"==typeof LZString&&e.cache||(e.compression=!1))}return this.hasDynamicGroups=this.options.dynamic||!!this.dynamicGroups.length,!0},init:function(){this.helper.executeCallback.call(this,this.options.callback.onInit,[this.node]),this.container=this.node.closest("."+this.options.selector.container)},delegateEvents:function(){var e=this,i=["focus"+this.namespace,"input"+this.namespace,"propertychange"+this.namespace,"keydown"+this.namespace,"keyup"+this.namespace,"search"+this.namespace,"generate"+this.namespace];t("html").on("touchmove",function(){e.hasDragged=!0}).on("touchstart",function(){e.hasDragged=!1}),this.node.closest("form").on("submit",function(t){return e.options.mustSelectItem&&e.helper.isEmpty(e.item)?void t.preventDefault():(e.options.backdropOnFocus||e.hideLayout(),e.options.callback.onSubmit?e.helper.executeCallback.call(e,e.options.callback.onSubmit,[e.node,this,e.item,t]):void 0)}).on("reset",function(){setTimeout(function(){e.node.trigger("input"+e.namespace),e.hideLayout()})});var o=!1;if(this.node.attr("placeholder")&&(n||r)){var a=!0;this.node.on("focusin focusout",function(){a=!(this.value||!this.placeholder)}),this.node.on("input",function(t){a&&(t.stopImmediatePropagation(),a=!1)})}this.node.off(this.namespace).on(i.join(" "),function(i,n){switch(i.type){case"generate":e.generateSource(Object.keys(e.options.source));break;case"focus":if(e.focusOnly){e.focusOnly=!1;break}e.options.backdropOnFocus&&(e.buildBackdropLayout(),e.showLayout()),e.options.searchOnFocus&&(e.deferred=t.Deferred(),e.generateSource());break;case"keydown":i.keyCode&&~[9,13,27,38,39,40].indexOf(i.keyCode)&&(o=!0,e.navigate(i));break;case"keyup":s&&e.node[0].value.replace(/^\s+/,"").toString().length<e.query.length&&e.node.trigger("input"+e.namespace);break;case"propertychange":if(o){o=!1;break}case"input":e.deferred=t.Deferred(),e.rawQuery=e.node[0].value.toString(),e.query=e.rawQuery.replace(/^\s+/,""),""===e.rawQuery&&""===e.query&&(i.originalEvent=n||{},e.helper.executeCallback.call(e,e.options.callback.onCancel,[e.node,i])),e.options.cancelButton&&e.toggleCancelButtonVisibility(),e.options.hint&&e.hint.container&&""!==e.hint.container.val()&&0!==e.hint.container.val().indexOf(e.rawQuery)&&e.hint.container.val(""),e.hasDynamicGroups?e.helper.typeWatch(function(){e.generateSource()},e.options.delay):e.generateSource();break;case"search":e.searchResult(),e.buildLayout(),e.result.length||e.searchGroups.length&&e.options.emptyTemplate&&e.query.length?e.showLayout():e.hideLayout(),e.deferred&&e.deferred.resolve()}return e.deferred&&e.deferred.promise()}),this.options.generateOnLoad&&this.node.trigger("generate"+this.namespace)},filterGenerateSource:function(){this.searchGroups=[],this.generateGroups=[];for(var t in this.options.source)if(this.options.source.hasOwnProperty(t)&&this.query.length>=this.options.source[t].minLength&&this.query.length<=this.options.source[t].maxLength){if(this.searchGroups.push(t),!this.options.source[t].dynamic&&this.source[t])continue;this.generateGroups.push(t)}},generateSource:function(e){if(this.filterGenerateSource(),Array.isArray(e)&&e.length)this.generateGroups=e;else if(!this.generateGroups.length)return void this.node.trigger("search"+this.namespace);if(this.requestGroups=[],this.generatedGroupCount=0,this.options.loadingAnimation&&this.container.addClass("loading"),!this.helper.isEmpty(this.xhr)){for(var i in this.xhr)this.xhr.hasOwnProperty(i)&&this.xhr[i].abort();this.xhr={}}for(var o,s,n,r,a,l,h,c=this,i=0,u=this.generateGroups.length;u>i;++i){if(o=this.generateGroups[i],n=this.options.source[o],r=n.cache,a=n.compression,r&&(l=window[r].getItem("TYPEAHEAD_"+this.selector+":"+o))){a&&(l=LZString.decompressFromUTF16(l)),h=!1;try{l=JSON.parse(l+""),l.data&&l.ttl>(new Date).getTime()?(this.populateSource(l.data,o),h=!0):window[r].removeItem("TYPEAHEAD_"+this.selector+":"+o)}catch(p){}if(h)continue}!n.data||n.ajax?n.ajax&&(this.requests[o]||(this.requests[o]=this.generateRequestObject(o)),this.requestGroups.push(o)):"function"==typeof n.data?(s=n.data.call(this),Array.isArray(s)?c.populateSource(s,o):"function"==typeof s.promise&&!function(e){t.when(s).then(function(t){t&&Array.isArray(t)&&c.populateSource(t,e)})}(o)):this.populateSource(t.extend(!0,[],n.data),o)}return this.requestGroups.length&&this.handleRequests(),!!this.generateGroups.length},generateRequestObject:function(t){var e=this,i=this.options.source[t],o={request:{url:i.ajax.url||null,dataType:"json",beforeSend:function(o,s){e.xhr[t]=o;var n=e.requests[t].callback.beforeSend||i.ajax.beforeSend;"function"==typeof n&&n.apply(null,arguments)}},callback:{beforeSend:null,done:null,fail:null,then:null,always:null},extra:{path:i.ajax.path||null,group:t},validForGroup:[t]};if("function"!=typeof i.ajax&&(i.ajax instanceof Object&&(o=this.extendXhrObject(o,i.ajax)),Object.keys(this.options.source).length>1))for(var s in this.requests)this.requests.hasOwnProperty(s)&&(this.requests[s].isDuplicated||o.request.url&&o.request.url===this.requests[s].request.url&&(this.requests[s].validForGroup.push(t),o.isDuplicated=!0,delete o.validForGroup));return o},extendXhrObject:function(e,i){return"object"==typeof i.callback&&(e.callback=i.callback,delete i.callback),"function"==typeof i.beforeSend&&(e.callback.beforeSend=i.beforeSend,delete i.beforeSend),e.request=t.extend(!0,e.request,i),"jsonp"!==e.request.dataType.toLowerCase()||e.request.jsonpCallback||(e.request.jsonpCallback="callback_"+e.extra.group),e},handleRequests:function(){var e,i=this,o=this.requestGroups.length;if(this.helper.executeCallback.call(this,this.options.callback.onSendRequest,[this.node,this.query])!==!1)for(var s=0,n=this.requestGroups.length;n>s;++s)e=this.requestGroups[s],this.requests[e].isDuplicated||!function(e,s){if("function"==typeof i.options.source[e].ajax){var n=i.options.source[e].ajax.call(i,i.query);if(s=i.extendXhrObject(i.generateRequestObject(e),"object"==typeof n?n:{}),"object"!=typeof s.request||!s.request.url)return void i.populateSource([],e);i.requests[e]=s}var r,a,l=!1;if(~s.request.url.indexOf("")&&(l||(s=t.extend(!0,{},s),l=!0),s.request.url=s.request.url.replace("",encodeURIComponent(i.query))),s.request.data)for(var h in s.request.data)if(s.request.data.hasOwnProperty(h)&&~String(s.request.data[h]).indexOf("")){l||(s=t.extend(!0,{},s),l=!0),s.request.data[h]=s.request.data[h].replace("",i.query);break}t.ajax(s.request).done(function(t,e,o){a=null;for(var n=0,l=s.validForGroup.length;l>n;n++)r=i.requests[s.validForGroup[n]],r.callback.done instanceof Function&&(a=r.callback.done.call(i,t,e,o))}).fail(function(t,e,o){for(var n=0,a=s.validForGroup.length;a>n;n++)r=i.requests[s.validForGroup[n]],r.callback.fail instanceof Function&&r.callback.fail.call(i,t,e,o)}).always(function(t,e,n){for(var l=0,h=s.validForGroup.length;h>l;l++){if(r=i.requests[s.validForGroup[l]],r.callback.always instanceof Function&&r.callback.always.call(i,t,e,n),"object"!=typeof n)return;i.populateSource("function"==typeof t.promise&&[]||a||t,r.extra.group,r.extra.path||r.request.path),o-=1,0===o&&i.helper.executeCallback.call(i,i.options.callback.onReceiveRequest,[i.node,i.query])}}).then(function(t,e){for(var o=0,n=s.validForGroup.length;n>o;o++)r=i.requests[s.validForGroup[o]],r.callback.then instanceof Function&&r.callback.then.call(i,t,e)})}(e,this.requests[e])},populateSource:function(t,e,i){var o=this,s=this.options.source[e],n=s.ajax&&s.data;i&&"string"==typeof i&&(t=this.helper.namespace.call(this,i,t)),Array.isArray(t)||(t=[]),n&&("function"==typeof n&&(n=n()),Array.isArray(n)&&(t=t.concat(n)));for(var r,a=s.display?"compiled"===s.display[0]?s.display[1]:s.display[0]:"compiled"===this.options.display[0]?this.options.display[1]:this.options.display[0],l=0,h=t.length;h>l;l++)null!==t[l]&&"boolean"!=typeof t[l]&&("string"==typeof t[l]&&(r={},r[a]=t[l],t[l]=r),t[l].group=e);if(!this.hasDynamicGroups&&this.dropdownFilter.dynamic.length)for(var c,u,p={},l=0,h=t.length;h>l;l++)for(var d=0,f=this.dropdownFilter.dynamic.length;f>d;d++)c=this.dropdownFilter.dynamic[d].key,u=t[l][c],u&&(this.dropdownFilter.dynamic[d].value||(this.dropdownFilter.dynamic[d].value=[]),p[c]||(p[c]=[]),~p[c].indexOf(u.toLowerCase())||(p[c].push(u.toLowerCase()),this.dropdownFilter.dynamic[d].value.push(u)));if(this.options.correlativeTemplate){var y=s.template||this.options.template,g="";if("function"==typeof y&&(y=y.call(this,"",{})),y){if(Array.isArray(this.options.correlativeTemplate))for(var l=0,h=this.options.correlativeTemplate.length;h>l;l++)g+="+this.options.correlativeTemplate[l]+ ";else g=y.replace(/<.+?>/g,"");for(var l=0,h=t.length;h>l;l++)t[l].compiled=g.replace(/\{\{([\w\-\.]+)(?:\|(\w+))?}}/g,function(e,i){return o.helper.namespace.call(o,i,t[l],"get","")}).trim();s.display?~s.display.indexOf("compiled")||s.display.unshift("compiled"):~this.options.display.indexOf("compiled")||this.options.display.unshift("compiled")}else;}this.options.callback.onPopulateSource&&(t=this.helper.executeCallback.call(this,this.options.callback.onPopulateSource,[this.node,t,e,i])),this.tmpSource[e]=Array.isArray(t)&&t||[];var m=this.options.source[e].cache,v=this.options.source[e].compression,b=this.options.source[e].ttl||this.options.ttl;if(m&&!window[m].getItem("TYPEAHEAD_"+this.selector+":"+e)){this.options.callback.onCacheSave&&(t=this.helper.executeCallback.call(this,this.options.callback.onCacheSave,[this.node,t,e,i]));var k=JSON.stringify({data:t,ttl:(new Date).getTime()+b});v&&(k=LZString.compressToUTF16(k)),window[m].setItem("TYPEAHEAD_"+this.selector+":"+e,k)}this.incrementGeneratedGroup()},incrementGeneratedGroup:function(){if(this.generatedGroupCount++,this.generatedGroupCount===this.generateGroups.length){this.xhr={};for(var t=0,e=this.generateGroups.length;e>t;t++)this.source[this.generateGroups[t]]=this.tmpSource[this.generateGroups[t]];this.hasDynamicGroups||this.buildDropdownItemLayout("dynamic"),this.options.loadingAnimation&&this.container.removeClass("loading"),this.node.trigger("search"+this.namespace)}},navigate:function(t){if(this.helper.executeCallback.call(this,this.options.callback.onNavigateBefore,[this.node,this.query,t]),27===t.keyCode)return t.preventDefault(),void(this.query.length?(this.resetInput(),this.node.trigger("input"+this.namespace,[t])):(this.node.blur(),this.hideLayout()));if(this.options.blurOnTab&&9===t.keyCode)return this.node.blur(),void this.hideLayout();if(this.result.length){var e=this.resultContainer.find("."+this.options.selector.item),i=e.filter(".active"),o=i[0]&&e.index(i)||null,s=null;if(13===t.keyCode)return void(i.length>0&&(t.preventDefault(),i.find("a:first").trigger("click",t)));if(39===t.keyCode)return void(o?e.eq(o).find("a:first")[0].click():this.options.hint&&""!==this.hint.container.val()&&this.helper.getCaret(this.node[0])>=this.query.length&&e.find('a[data-index="'+this.hintIndex+'"]')[0].click());e.length>0&&i.removeClass("active"),38===t.keyCode?(t.preventDefault(),i.length>0?o-1>=0&&(s=o-1,e.eq(s).addClass("active")):(s=e.length-1,e.last().addClass("active"))):40===t.keyCode&&(t.preventDefault(),i.length>0?o+1<e.length&&(s=o+1,e.eq(s).addClass("active")):(s=0,e.first().addClass("active"))),t.preventInputChange&&~[38,40].indexOf(t.keyCode)&&this.buildHintLayout(null!==s&&s<this.result.length?[this.result[s]]:null),this.options.hint&&this.hint.container&&this.hint.container.css("color",t.preventInputChange?this.hint.css.color:null===s&&this.hint.css.color||this.hint.container.css("background-color")||"fff"),this.node.val(null===s||t.preventInputChange?this.rawQuery:this.result[s][this.result[s].matchedKey]),this.helper.executeCallback.call(this,this.options.callback.onNavigateAfter,[this.node,e,null!==s&&e.eq(s).find("a:first")||void 0,null!==s&&this.result[s]||void 0,this.query,t])}},searchResult:function(t){t||(this.item={}),this.resetLayout(),this.helper.executeCallback.call(this,this.options.callback.onSearch,[this.node,this.query])!==!1&&(this.searchGroups.length&&this.searchResultData(),this.helper.executeCallback.call(this,this.options.callback.onResult,[this.node,this.query,this.result,this.resultCount,this.resultCountPerGroup]),this.isDropdownEvent&&(this.helper.executeCallback.call(this,this.options.callback.onDropdownFilter,[this.node,this.query,this.filters.dropdown,this.result]),this.isDropdownEvent=!1))},searchResultData:function(){var e,i,o,s,n,r,a,l,h,c,u,p,d,f=this,y=this.groupBy,g=null,m=this.query.toLowerCase(),v=this.options.maxItem,b=this.options.maxItemPerGroup,k=this.filters.dynamic&&!this.helper.isEmpty(this.filters.dynamic),w="function"==typeof this.options.matcher&&this.options.matcher;this.options.accent&&(m=this.helper.removeAccent.call(this,m));for(var x=0,C=this.searchGroups.length;C>x;++x)if(e=this.searchGroups[x],!this.filters.dropdown||"group"!==this.filters.dropdown.key||this.filters.dropdown.value===e){a="undefined"!=typeof this.options.source[e].filter?this.options.source[e].filter:this.options.filter,h="function"==typeof this.options.source[e].matcher&&this.options.source[e].matcher||w;for(var q=0,O=this.source[e].length;O>q&&(!(this.resultItemCount>=v)||this.options.callback.onResult);q++)if((!k||this.dynamicFilter.validate.apply(this,[this.source[e][q]]))&&(i=this.source[e][q],null!==i&&"boolean"!=typeof i&&(!this.filters.dropdown||(i[this.filters.dropdown.key]||"").toLowerCase()===(this.filters.dropdown.value||"").toLowerCase()))){if(g="group"===y?e:i[y]?i[y]:i.group,g&&!this.result[g]&&(this.result[g]=[],this.resultCountPerGroup[g]=0),b&&"group"===y&&this.result[g].length>=b&&!this.options.callback.onResult)break;n=this.options.source[e].display||this.options.display;for(var S=0,F=n.length;F>S;++S){if(a!==!1){if(r=/\./.test(n[S])?this.helper.namespace.call(this,n[S],i):i[n[S]],"undefined"==typeof r||""===r)continue;r=this.helper.cleanStringFromScript(r)}if("function"==typeof a){if(l=a.call(this,i,r),void 0===l)break;if(!l)continue;"object"==typeof l&&(i=l)}if(~[void 0,!0].indexOf(a)){if(s=r,s=s.toString().toLowerCase(),this.options.accent&&(s=this.helper.removeAccent.call(this,s)),o=s.indexOf(m),this.options.correlativeTemplate&&"compiled"===n[S]&&0>o&&/\s/.test(m)){u=!0,p=m.split(" "),d=s;for(var L=0,A=p.length;A>L;L++)if(""!==p[L]){if(!~d.indexOf(p[L])){u=!1;break}d=d.replace(p[L],"")}}if(0>o&&!u)continue;if(this.options.offset&&0!==o)continue;if(h){if(c=h.call(this,i,r),void 0===c)break;if(!c)continue;"object"==typeof c&&(i=c)}}if(this.resultCount++,this.resultCountPerGroup[g]++,this.resultItemCount<v){if(b&&this.result[g].length>=b)break;this.result[g].push(t.extend(!0,{matchedKey:n[S]},i)),this.resultItemCount++}break}if(!this.options.callback.onResult){if(this.resultItemCount>=v)break;if(b&&this.result[g].length>=b&&"group"===y)break}}}if(this.options.order){var j,n=[];for(var e in this.result)if(this.result.hasOwnProperty(e)){for(var x=0,C=this.result[e].length;C>x;x++)j=this.options.source[this.result[e][x].group].display||this.options.display,~n.indexOf(j[0])||n.push(j[0]);this.result[e].sort(f.helper.sort(n,"asc"===f.options.order,function(t){return t.toString().toUpperCase()}))}}var G=[],T=[];T="function"==typeof this.options.groupOrder?this.options.groupOrder.apply(this,[this.node,this.query,this.result,this.resultCount,this.resultCountPerGroup]):Array.isArray(this.options.groupOrder)?this.options.groupOrder:"string"==typeof this.options.groupOrder&&~["asc","desc"].indexOf(this.options.groupOrder)?Object.keys(this.result).sort(f.helper.sort([],"asc"===f.options.groupOrder,function(t){return t.toString().toUpperCase()})):Object.keys(this.result);for(var x=0,C=T.length;C>x;x++)G=G.concat(this.result[T[x]]||[]);this.groups=JSON.parse(JSON.stringify(T)),this.result=G},buildLayout:function(){if(this.buildHtmlLayout(),this.buildBackdropLayout(),this.buildHintLayout(),this.options.callback.onLayoutBuiltBefore){var e=this.helper.executeCallback.call(this,this.options.callback.onLayoutBuiltBefore,[this.node,this.query,this.result,this.resultHtml]);e instanceof t&&(this.resultHtml=e)}this.resultHtml&&this.resultContainer.html(this.resultHtml),this.options.callback.onLayoutBuiltAfter&&this.helper.executeCallback.call(this,this.options.callback.onLayoutBuiltAfter,[this.node,this.query,this.result])},buildHtmlLayout:function(){if(this.options.resultContainer!==!1){this.resultContainer||(this.resultContainer=t("<div/>",{"class":this.options.selector.result}),this.container.append(this.resultContainer));var e;if(!this.result.length){if(!this.options.emptyTemplate||""===this.query)return;e="function"==typeof this.options.emptyTemplate?this.options.emptyTemplate.call(this,this.query):this.options.emptyTemplate.replace(/\{\{query}}/gi,this.helper.cleanStringFromScript(this.query))}var i=this.query.toLowerCase();this.options.accent&&(i=this.helper.removeAccent.call(this,i));var o=this,s=this.groupTemplate||"<ul></ul>",n=!1;this.groupTemplate?s=t(s.replace(/<([^>]+)>\{\{(.+?)}}<\/[^>]+>/g,function(t,i,s,r,a){var l="",h="group"===s?o.groups:[s];if(!o.result.length)return n===!0?"":(n=!0,"<"+i+' class="'+o.options.selector.empty+'"><a href="javascript:;">'+e+"</a></"+i+">");for(var c=0,u=h.length;u>c;++c)l+="<"+i+' data-group-template="'+h[c]+'"><ul></ul></'+i+">";return l})):(s=t(s),this.result.length||s.append(e instanceof t?e:'<li class="'+o.options.selector.empty+'"><a href="javascript:;">'+e+"</a></li>")),s.addClass(this.options.selector.list+(this.helper.isEmpty(this.result)?" empty":""));for(var r,a,l,h,c,u,p,d,f,y,g,m,v=this.groupTemplate&&this.result.length&&o.groups||[],b=0,k=this.result.length;k>b;++b)l=this.result[b],r=l.group,h=this.options.source[l.group].href||this.options.href,f=[],y=this.options.source[l.group].display||this.options.display,this.options.group&&(r=l[this.options.group.key],this.options.group.template&&("function"==typeof this.options.group.template?a=this.options.group.template(l):"string"==typeof this.options.template&&(a=this.options.group.template.replace(/\{\{([\w\-\.]+)}}/gi,function(t,e){return o.helper.namespace.call(o,e,l,"get","")}))),s.find('[data-search-group="'+r+'"]')[0]||(this.groupTemplate?s.find('[data-group-template="'+r+'"] ul'):s).append(t("<li/>",{"class":o.options.selector.group,html:t("<a/>",{href:"javascript:;",html:a||r,tabindex:-1}),"data-search-group":r}))),this.groupTemplate&&v.length&&(m=v.indexOf(r||l.group),~m&&v.splice(m,1)),c=t("<li/>",{"class":o.options.selector.item+" "+o.options.selector.group+"-"+this.helper.slugify.call(this,r),html:t("<a/>",{href:function(){return h&&("string"==typeof h?h=h.replace(/\{\{([^\|}]+)(?:\|([^}]+))*}}/gi,function(t,e,i){var s=o.helper.namespace.call(o,e,l,"get","");return i=i&&i.split("|")||[],~i.indexOf("slugify")&&(s=o.helper.slugify.call(o,s)),s}):"function"==typeof h&&(h=h(l)),l.href=h),h||"javascript:;"}(),"data-group":r,"data-index":b,html:function(){if(u=l.group&&o.options.source[l.group].template||o.options.template)"function"==typeof u&&(u=u.call(o,o.query,l)),d=u.replace(/\{\{([^\|}]+)(?:\|([^}]+))*}}/gi,function(t,e,s){var n=o.helper.cleanStringFromScript(String(o.helper.namespace.call(o,e,l,"get","")));return s=s&&s.split("|")||[],~s.indexOf("slugify")&&(n=o.helper.slugify.call(o,n)),~s.indexOf("raw")||o.options.highlight===!0&&i&&~y.indexOf(e)&&(n=o.helper.highlight.call(o,n,i.split(" "),o.options.accent)),n});else{for(var e=0,s=y.length;s>e;e++)g=/\./.test(y[e])?o.helper.namespace.call(o,y[e],l,"get",""):l[y[e]],"undefined"!=typeof g&&""!==g&&f.push(g);d='<span class="'+o.options.selector.display+'">'+o.helper.cleanStringFromScript(String(f.join(" ")))+"</span>"}(o.options.highlight===!0&&i&&!u||"any"===o.options.highlight)&&(d=o.helper.highlight.call(o,d,i.split(" "),o.options.accent)),t(this).append(d)}})}),function(e,i,s){s.on("click",function(e,s){return s&&"object"==typeof s&&(e.originalEvent=s),o.options.mustSelectItem&&o.helper.isEmpty(i)?void e.preventDefault():(o.item=i,void(o.helper.executeCallback.call(o,o.options.callback.onClickBefore,[o.node,t(this),i,e])!==!1&&(e.originalEvent&&e.originalEvent.defaultPrevented||e.isDefaultPrevented()||(p=i.group&&o.options.source[i.group].templateValue||o.options.templateValue,"function"==typeof p&&(p=p.call(o)),o.query=o.rawQuery=p?p.replace(/\{\{([\w\-\.]+)}}/gi,function(t,e){return o.helper.namespace.call(o,e,i,"get","")}):o.helper.namespace.call(o,i.matchedKey,i).toString(),o.focusOnly=!0,o.node.val(o.query).focus(),o.searchResult(!0),o.buildLayout(),o.hideLayout(),o.helper.executeCallback.call(o,o.options.callback.onClickAfter,[o.node,t(this),i,e])))))}),s.on("mouseenter",function(e){o.helper.executeCallback.call(o,o.options.callback.onMouseEnter,[o.node,t(this),i,e])}),s.on("mouseleave",function(e){o.helper.executeCallback.call(o,o.options.callback.onMouseLeave,[o.node,t(this),i,e])})}(b,l,c),(this.groupTemplate?s.find('[data-group-template="'+r+'"] ul'):s).append(c);if(this.result.length&&v.length)for(var b=0,k=v.length;k>b;++b)s.find('[data-group-template="'+v[b]+'"]').remove();this.resultHtml=s}},buildBackdropLayout:function(){this.options.backdrop&&(this.backdrop.container||(this.backdrop.css=t.extend({opacity:.6,filter:"alpha(opacity=60)",position:"fixed",top:0,right:0,bottom:0,left:0,"z-index":1040,"background-color":"#000"},this.options.backdrop),this.backdrop.container=t("<div/>",{"class":this.options.selector.backdrop,css:this.backdrop.css}).insertAfter(this.container)),this.container.addClass("backdrop").css({"z-index":this.backdrop.css["z-index"]+1,position:"relative"}))},buildHintLayout:function(e){if(this.options.hint){if(this.node[0].scrollWidth>Math.ceil(this.node.innerWidth()))return void(this.hint.container&&this.hint.container.val(""));var i=this,o="",e=e||this.result,s=this.query.toLowerCase();if(this.options.accent&&(s=this.helper.removeAccent.call(this,s)),this.hintIndex=null,this.searchGroups.length){if(this.hint.container||(this.hint.css=t.extend({"border-color":"transparent",position:"absolute",top:0,display:"inline","z-index":-1,"float":"none",color:"silver","box-shadow":"none",cursor:"default","-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"},this.options.hint),this.hint.container=t("<input/>",{type:this.node.attr("type"),"class":this.node.attr("class"),readonly:!0,unselectable:"on","aria-hidden":"true",tabindex:-1,click:function(){i.node.focus()}}).addClass(this.options.selector.hint).css(this.hint.css).insertAfter(this.node),this.node.parent().css({position:"relative"})),this.hint.container.css("color",this.hint.css.color),s)for(var n,r,a,l=0,h=e.length;h>l;l++){r=e[l].group,n=this.options.source[r].display||this.options.display;for(var c=0,u=n.length;u>c;c++)if(a=String(e[l][n[c]]).toLowerCase(),this.options.accent&&(a=this.helper.removeAccent.call(this,a)),0===a.indexOf(s)){o=String(e[l][n[c]]),this.hintIndex=l;break}if(null!==this.hintIndex)break}this.hint.container.val(o.length>0&&this.rawQuery+o.substring(this.query.length)||"")}}},buildDropdownLayout:function(){if(this.options.dropdownFilter){var e=this;t("<span/>",{"class":this.options.selector.filter,html:function(){t(this).append(t("<button/>",{type:"button","class":e.options.selector.filterButton,style:"display: none;",click:function(i){i.stopPropagation(),e.container.toggleClass("filter");var o=e.namespace+"-dropdown-filter";t("html").off(o),e.container.hasClass("filter")&&t("html").on("click"+o+" touchend"+o,function(i){t(i.target).closest("."+e.options.selector.filter)[0]||e.hasDragged||e.container.removeClass("filter")})}})),t(this).append(t("<ul/>",{"class":e.options.selector.dropdown}))}}).insertAfter(e.container.find("."+e.options.selector.query))}},buildDropdownItemLayout:function(e){function i(t){"*"===t.value?delete this.filters.dropdown:this.filters.dropdown=t,this.container.removeClass("filter").find("."+this.options.selector.filterButton).html(t.template),this.isDropdownEvent=!0,this.node.trigger("search"+this.namespace),this.node.focus()}if(this.options.dropdownFilter){var o,s,n=this,r="string"==typeof this.options.dropdownFilter&&this.options.dropdownFilter||"All",a=this.container.find("."+this.options.selector.dropdown);"static"!==e||this.options.dropdownFilter!==!0&&"string"!=typeof this.options.dropdownFilter||this.dropdownFilter["static"].push({key:"group",template:"",all:r,value:Object.keys(this.options.source)});for(var l=0,h=this.dropdownFilter[e].length;h>l;l++){s=this.dropdownFilter[e][l],Array.isArray(s.value)||(s.value=[s.value]),s.all&&(this.dropdownFilterAll=s.all);for(var c=0,u=s.value.length;u>=c;c++)(c!==u||l===h-1)&&(c===u&&l===h-1&&"static"===e&&this.dropdownFilter.dynamic.length||(o=this.dropdownFilterAll||r,s.value[c]?o=s.template?s.template.replace(new RegExp("+s.key+","gi"),s.value[c]):s.value[c]:this.container.find("."+n.options.selector.filterButton).html(o),function(e,o,s){a.append(t("<li/>",{"class":n.options.selector.dropdownItem+" "+n.helper.slugify.call(n,o.key+"-"+(o.value[e]||r)), html:t("<a/>",{href:"javascript:;",html:s,click:function(t){t.preventDefault(),i.call(n,{key:o.key,value:o.value[e]||"*",template:s})}})}))}(c,s,o)))}this.dropdownFilter[e].length&&this.container.find("."+n.options.selector.filterButton).removeAttr("style")}},dynamicFilter:{isEnabled:!1,init:function(){this.options.dynamicFilter&&(this.dynamicFilter.bind.call(this),this.dynamicFilter.isEnabled=!0)},validate:function(t){var e,i,o=null,s=null;for(var n in this.filters.dynamic)if(this.filters.dynamic.hasOwnProperty(n)&&(i=~n.indexOf(".")?this.helper.namespace.call(this,n,t,"get"):t[n],"|"!==this.filters.dynamic[n].modifier||o||(o=i==this.filters.dynamic[n].value||!1),"&"===this.filters.dynamic[n].modifier)){if(i!=this.filters.dynamic[n].value){s=!1;break}s=!0}return e=o,null!==s&&(e=s,s===!0&&null!==o&&(e=o)),!!e},set:function(t,e){var i=t.match(/^([|&])?(.+)/);e?this.filters.dynamic[i[2]]={modifier:i[1]||"|",value:e}:delete this.filters.dynamic[i[2]],this.dynamicFilter.isEnabled&&this.generateSource()},bind:function(){for(var e,i=this,o=0,s=this.options.dynamicFilter.length;s>o;o++)e=this.options.dynamicFilter[o],"string"==typeof e.selector&&(e.selector=t(e.selector)),e.selector instanceof t&&e.selector[0]&&e.key&&!function(t){t.selector.off(i.namespace).on("change"+i.namespace,function(){i.dynamicFilter.set.apply(i,[t.key,i.dynamicFilter.getValue(this)])}).trigger("change"+i.namespace)}(e)},getValue:function(t){var e;return"SELECT"===t.tagName?e=t.value:"INPUT"===t.tagName&&("checkbox"===t.type?e=t.checked&&t.getAttribute("value")||t.checked||null:"radio"===t.type&&t.checked&&(e=t.value)),e}},showLayout:function(){function e(){var e=this;t("html").off("keydown"+this.namespace).on("keydown"+this.namespace,function(i){i.keyCode&&9===i.keyCode&&setTimeout(function(){t(":focus").closest(e.container).find(e.node)[0]||e.hideLayout()},0)}),t("html").off("click"+this.namespace+" touchend"+this.namespace).on("click"+this.namespace+" touchend"+this.namespace,function(i){t(i.target).closest(e.container)[0]||e.hasDragged||e.hideLayout()})}this.container.hasClass("result")||(this.result.length||this.options.emptyTemplate||this.options.backdropOnFocus)&&(e.call(this),this.container.addClass([this.result.length||this.searchGroups.length&&this.options.emptyTemplate&&this.query.length?"result ":"",this.options.hint&&this.searchGroups.length?"hint":"",this.options.backdrop||this.options.backdropOnFocus?"backdrop":""].join(" ")),this.helper.executeCallback.call(this,this.options.callback.onShowLayout,[this.node,this.query]))},hideLayout:function(){(this.container.hasClass("result")||this.container.hasClass("backdrop"))&&(this.container.removeClass("result hint filter"+(this.options.backdropOnFocus&&t(this.node).is(":focus")?"":" backdrop")),this.options.backdropOnFocus&&this.container.hasClass("backdrop")||(t("html").off(this.namespace),this.helper.executeCallback.call(this,this.options.callback.onHideLayout,[this.node,this.query])))},resetLayout:function(){this.result={},this.groups=[],this.resultCount=0,this.resultCountPerGroup={},this.resultItemCount=0,this.resultHtml=null,this.options.hint&&this.hint.container&&this.hint.container.val("")},resetInput:function(){this.node.val(""),this.item=null,this.query="",this.rawQuery=""},buildCancelButtonLayout:function(){if(this.options.cancelButton){var e=this;t("<span/>",{"class":this.options.selector.cancelButton,mousedown:function(t){t.stopImmediatePropagation(),t.preventDefault(),e.resetInput(),e.node.trigger("input"+e.namespace,[t])}}).insertBefore(this.node)}},toggleCancelButtonVisibility:function(){this.container.toggleClass("cancel",!!this.query.length)},__construct:function(){this.extendOptions(),this.unifySourceFormat()&&(this.dynamicFilter.init.apply(this),this.init(),this.buildDropdownLayout(),this.buildDropdownItemLayout("static"),this.delegateEvents(),this.buildCancelButtonLayout(),this.helper.executeCallback.call(this,this.options.callback.onReady,[this.node]))},helper:{isEmpty:function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},removeAccent:function(t){if("string"==typeof t){var e=o;return"object"==typeof this.options.accent&&(e=this.options.accent),t=t.toLowerCase().replace(new RegExp("["+e.from+"]","g"),function(t){return e.to[e.from.indexOf(t)]})}},slugify:function(t){return t=String(t),""!==t&&(t=this.helper.removeAccent.call(this,t),t=t.replace(/[^-a-z0-9]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")),t},sort:function(t,e,i){var o=function(e){for(var o=0,s=t.length;s>o;o++)if("undefined"!=typeof e[t[o]])return i(e[t[o]]);return e};return e=[-1,1][+!!e],function(t,i){return t=o(t),i=o(i),e*((t>i)-(i>t))}},replaceAt:function(t,e,i,o){return t.substring(0,e)+o+t.substring(e+i)},highlight:function(t,e,i){t=String(t);var o=i&&this.helper.removeAccent.call(this,t)||t,s=[];Array.isArray(e)||(e=[e]),e.sort(function(t,e){return e.length-t.length});for(var n=e.length-1;n>=0;n--)""!==e[n].trim()?e[n]=e[n].replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):e.splice(n,1);o.replace(new RegExp("(?:"+e.join("|")+")(?!([^<]+)?>)","gi"),function(t,e,i){s.push({offset:i,length:t.length})});for(var n=s.length-1;n>=0;n--)t=this.helper.replaceAt(t,s[n].offset,s[n].length,"<strong>"+t.substr(s[n].offset,s[n].length)+"</strong>");return t},getCaret:function(t){if(t.selectionStart)return t.selectionStart;if(document.selection){t.focus();var e=document.selection.createRange();if(null===e)return 0;var i=t.createTextRange(),o=i.duplicate();return i.moveToBookmark(e.getBookmark()),o.setEndPoint("EndToStart",i),o.text.length}return 0},cleanStringFromScript:function(t){return"string"==typeof t&&t.replace(/<\/?(?:script|iframe)\b[^>]*>/gm,"")||t},executeCallback:function(t,e){if(t){var i;if("function"==typeof t)i=t;else if(("string"==typeof t||Array.isArray(t))&&("string"==typeof t&&(t=[t,[]]),i=this.helper.namespace.call(this,t[0],window),"function"!=typeof i))return;return i.apply(this,(t[1]||[]).concat(e?e:[]))}},namespace:function(t,e,i,o){if("string"!=typeof t||""===t)return!1;var s="undefined"!=typeof o?o:void 0;if(!~t.indexOf("."))return e[t]||s;for(var n=t.split("."),r=e||window,i=i||"get",a="",l=0,h=n.length;h>l;l++){if(a=n[l],"undefined"==typeof r[a]){if(~["get","delete"].indexOf(i))return"undefined"!=typeof o?o:void 0;r[a]={}}if(~["set","create","delete"].indexOf(i)&&l===h-1){if("set"!==i&&"create"!==i)return delete r[a],!0;r[a]=s}r=r[a]}return r},typeWatch:function(){var t=0;return function(e,i){clearTimeout(t),t=setTimeout(e,i)}}()}},t.fn.typeahead=t.typeahead=function(t){return l.typeahead(this,t)};var l={typeahead:function(e,i){if(i&&i.source&&"object"==typeof i.source){if("function"==typeof e){if(!i.input)return;e=t(i.input)}if(e.length&&"INPUT"===e[0].nodeName){if(1===e.length)return e[0].selector=e.selector||i.input||e[0].nodeName.toLowerCase(),window.Typeahead[e[0].selector]=new a(e,i);for(var o,s={},n=0,r=e.length;r>n;++n)o=e[n].nodeName.toLowerCase(),"undefined"!=typeof s[o]&&(o+=n),e[n].selector=o,window.Typeahead[o]=s[o]=new a(e.eq(n),i);return s}}}};return window.console=window.console||{log:function(){}},Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}),"indexOf"in Array.prototype||(Array.prototype.indexOf=function(t,e){void 0===e&&(e=0),0>e&&(e+=this.length),0>e&&(e=0);for(var i=this.length;i>e;e++)if(e in this&&this[e]===t)return e;return-1}),Object.keys||(Object.keys=function(t){var e,i=[];for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&i.push(e);return i}),a}); </script> <script> $('.k-navsearch-close').on('click',function(){ $('.k-nav-search-card').hide(); }); $('.k-navsearch-open').on('click',function(){ $('.k-nav-search-card').show(); }); $('#k-menu').on('click',function(e){ $('.k-nav-search-card').hide(); }); $('#k-menu .mdui-textfield').on('click',function(e){ e.stopPropagation(); $('.k-nav-search-card').show(); }); $(window).scroll(function() { $('.k-navsearch-close').click(); }); var names = new Array(); var urls = new Array(); $.ajaxSetup({ cache: true }); $.getJSON("/search.json").done(function(data){ for (var index in data){ var item = data[index]; names[index] = item.title; urls[names[index]] = item.url } $.typeahead({ input: '.k-nav-search', order: "desc", source: { data: names }, selector: { container: "typeahead__container", result: " mdui-card k-nav-search-card", list: "mdui-list", item: "mdui-list-item" }, callback: { onClick: function (node,a,item,event){ }, onMouseEnter:function (node, a, item, event){ a.find('a').attr('href',urls[item.display]); } } }); }); </script> <div class="mdui-container container"> <section class="content"> <style> /*img + em { position: relative; background-color: #dcdcdc; text-align: center; } img { display: block; margin: 0 auto; } */ .k-post-media { display:block cursor: pointer; max-height: 345px; min-height: 245px; background-position: 50% 50%; background-size: cover; background-color: #303033; } .k-post-media .mdui-card-primary-title a { text-decoration: none; } .k-noimg{ padding-left: 16px; } .k-noimg h1::before{ content: "“"; } .k-noimg h1::after{ content: "”"; } .k-noimg h1:before,.k-noimg h1:after{ display: block; font-size: 80px; margin-top: 40px; } .k-noimg a,.k-noimg h1{ text-decoration: none; color: white; } </style> <script src="https://cdn.bootcss.com/jquery_lazyload/1.9.7/jquery.lazyload.min.js"></script> <script> $(function() { $("div.lazy").lazyload({ }); }); </script> <div id="postpage" class="mdui-container"> <div class="k-posts-list"></div> <div class="mdui-row"> <div class="mdui-col-sm-12 k-page-col mdui-col-md-9"> <div class="mdui-card k-postcontent"> <div class="mdui-card-media k-post-media" style="background-image: url(http://i.imgur.com/Y7b0J4q.jpg);"> <div class="mdui-card-media-covered mdui-card-media-covered-gradient"> <div class="mdui-card-primary"> <div class="mdui-card-primary-title"><a class="mdui-text-color-white-text">Hacking An IPCamera Part1</a></div> </div> </div> </div> <div class="mdui-card-header"> <div class="mdui-card-menu"> <style> #k-qrcode{ padding-bottom: 0px; width: 215px; } </style> <button class="mdui-btn mdui-btn-icon" mdui-tooltip="{content: 'QR Code', delay: 100}" mdui-menu="{target: '#k-qrcode',align:'right',covered:false}"><i class="mdui-icon material-icons">devices other</i></button> <ul class="mdui-menu mdui-menu-cascade" id="k-qrcode"> <li class="mdui-menu-item"> <a class="mdui-text-center" href="javascript:;" class="mdui-ripple">Read this article on other devices</a> </li> <li class="mdui-menu-item"> <img class="mdui-center" src="https://chart.googleapis.com/chart?chs=210x210&cht=qr&chl=http%3A%2F%2Flocalhost%3A4000%2Fembeddedsec%2F2017%2F10%2F19%2FHacking-A-IP-Camera.html" alt=""> </li> </ul> <button class="mdui-btn mdui-btn-icon" mdui-tooltip="{content: 'Tags', delay: 100}" mdui-menu="{target: '#k-page-tag',align:'right',covered:false}"><i class="mdui-icon material-icons">bookmark</i></button> <ul class="mdui-menu" id="k-page-tag"> <li class="mdui-menu-item"> <a id="tag_iot" class="mdui-text-center" href="/tags/" class="mdui-ripple">iot</a> </li> <li class="mdui-menu-item"> <a id="tag_hacking" class="mdui-text-center" href="/tags/" class="mdui-ripple">hacking</a> </li> <li class="mdui-menu-item"> <a id="tag_hardware" class="mdui-text-center" href="/tags/" class="mdui-ripple">hardware</a> </li> <li class="mdui-menu-item"> <a id="tag_ARM" class="mdui-text-center" href="/tags/" class="mdui-ripple">ARM</a> </li> </ul> <button class="mdui-btn mdui-btn-icon" mdui-tooltip="{content: 'Share ', delay: 100}" mdui-menu="{target: '#k-sns_share',align:'right',covered:false}"><i class="mdui-icon material-icons">&#xe80d;</i></button> <ul class="mdui-menu" id="k-sns_share"> <li class="mdui-menu-item"> <a href="https://twitter.com/intent/tweet?text=Hacking An IPCamera Part1&url=http://localhost:4000/embeddedsec/2017/10/19/Hacking-A-IP-Camera.html&via=herrfeder" target="_blank" class="mdui-ripple">Share to Twitter</a> </li> <li class="mdui-menu-item"> <a href="javascript:;" target="_blank" class="mdui-ripple">Share to Telegram</a> </li> </ul> </div> <img class="mdui-card-header-avatar" src="/assets/images/herrfeder_avatar.png" /> <div class="mdui-card-header-title">herrfeder</div> <div class="mdui-card-header-subtitle k-page-date" date="Oct 19, 2017">Oct 19, 2017</div> </div> <style> .k-lastupdate{ color: #000000; background: #ffffc0; border-left: 5px solid #fff000; cursor: default; text-transform: none; text-overflow: ellipsis; } .k-lastupdate:hover{ background: #ffffc0; } .k-lastupdate:active{ background: #ffffc0 !important; } </style> <a class="mdui-btn mdui-btn-block k-lastupdate" id="k-difference" href="javascript:;"></a> <script> var date1=Date.parse($('.k-page-date').attr('date')); var date2=new Date(); var date3=date2.getTime()-date1; var days=Math.floor(date3/(24*3600*1000)); if (days>= 100){ $('#k-difference').html("This article was last updated "+ days +" days ago. Please use caution."); }else{ $('#k-difference').hide(); } </script> <div class="mdui-card-content mdui-typo"> <ul id="markdown-toc"> <li><a href="#sricam-sp009-hardware-and-software-examination" id="markdown-toc-sricam-sp009-hardware-and-software-examination">Sricam SP009 Hardware and Software Examination</a> <ul> <li><a href="#1-first-recon" id="markdown-toc-1-first-recon">1. First Recon</a> <ul> <li><a href="#11-wifi" id="markdown-toc-11-wifi">1.1 WiFi</a></li> <li><a href="#12-soc" id="markdown-toc-12-soc">1.2 SoC</a></li> <li><a href="#13-flash" id="markdown-toc-13-flash">1.3 Flash</a></li> <li><a href="#14-power-management" id="markdown-toc-14-power-management">1.4 Power Management</a></li> <li><a href="#15-sd-card-slot" id="markdown-toc-15-sd-card-slot">1.5 SD card slot</a></li> <li><a href="#16-eeprom" id="markdown-toc-16-eeprom">1.6 EEPROM</a></li> <li><a href="#17-audio-amplifier" id="markdown-toc-17-audio-amplifier">1.7 Audio Amplifier</a></li> <li><a href="#18-shell" id="markdown-toc-18-shell">1.8 Shell</a></li> </ul> </li> <li><a href="#2-access-over-hardware-ports" id="markdown-toc-2-access-over-hardware-ports">2. Access over Hardware Ports</a> <ul> <li><a href="#21-uart" id="markdown-toc-21-uart">2.1 UART</a></li> <li><a href="#22-getting-firmware" id="markdown-toc-22-getting-firmware">2.2 Getting Firmware</a> <ul> <li><a href="#221-dumping-from-system-via-sdcard" id="markdown-toc-221-dumping-from-system-via-sdcard">2.2.1 Dumping from System via SDCard</a></li> <li><a href="#222-dumping-flash-via-spi" id="markdown-toc-222-dumping-flash-via-spi">2.2.2 Dumping Flash via SPI</a></li> </ul> </li> </ul> </li> <li><a href="#3-acess-over-wireless-interfaces-and-network" id="markdown-toc-3-acess-over-wireless-interfaces-and-network">3. Acess over Wireless Interfaces and Network</a> <ul> <li><a href="#31-internal-communication" id="markdown-toc-31-internal-communication">3.1 Internal Communication</a></li> <li><a href="#32-trying-interactingaccessing-the-provided-services" id="markdown-toc-32-trying-interactingaccessing-the-provided-services">3.2 Trying Interacting/Accessing the provided services</a></li> <li><a href="#33-external-communication" id="markdown-toc-33-external-communication">3.3 External Communication</a> <ul> <li><a href="#331-communication-between-mobile-phone-and-ipcam" id="markdown-toc-331-communication-between-mobile-phone-and-ipcam">3.3.1 Communication between Mobile Phone and IPCam</a></li> <li><a href="#332-firmware-update" id="markdown-toc-332-firmware-update">3.3.2 Firmware Update</a></li> <li><a href="#334-direct-communication-between-ipcam-and-servers" id="markdown-toc-334-direct-communication-between-ipcam-and-servers">3.3.4 Direct Communication between IPCam and servers</a></li> </ul> </li> <li><a href="#335-collecting-information" id="markdown-toc-335-collecting-information">3.3.5 Collecting Information</a></li> </ul> </li> <li><a href="#4-reversing" id="markdown-toc-4-reversing">4. Reversing</a> <ul> <li><a href="#41-jadx" id="markdown-toc-41-jadx">4.1 JADX</a></li> <li><a href="#42-apktool" id="markdown-toc-42-apktool">4.2 APKTOOL</a></li> <li><a href="#43-unzip-the-apk" id="markdown-toc-43-unzip-the-apk">4.3 Unzip the APK</a></li> <li><a href="#44-bytecode-viewer" id="markdown-toc-44-bytecode-viewer">4.4 Bytecode Viewer</a></li> </ul> </li> <li><a href="#overall-security-issues-for-now" id="markdown-toc-overall-security-issues-for-now">Overall Security Issues (for now)</a></li> <li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></li> </ul> </li> </ul> <h1 id="sricam-sp009-hardware-and-software-examination">Sricam SP009 Hardware and Software Examination</h1> <p>In this gist I will try to examine and exploit the Sricam SP009. I purchased it from Attify with the IOT Exploitation Kit.</p> <ol> <li>First Recon <ul> <li>doing Research on Manufacturer Details</li> <li>disassemble the ip-camera</li> </ul> </li> <li>Access over Harware Ports <ul> <li>get shell access</li> <li>dump the firmware</li> </ul> </li> <li>Acess over Wireless Interfaces and Network <ul> <li>use interfaces in intended manner and dump network exchange information</li> <li>scan network services on cam and servers</li> </ul> </li> <li>Reversing Android App <ul> <li>finding firmware and keys for further access encryption</li> <li>vulnerabilities</li> </ul> </li> </ol> <h2 id="1-first-recon">1. First Recon</h2> <p>There isn’t any manufactural ID on the Cam. So seaching for the product will probably give the necessary documents. http://www.sricam.com/product/id/07caa85ec45449fabc17c003345970bf.html http://www.sricam.com/download/id/3e984aa70a9d4e928b03c01787d6fb4f.html</p> <p>I wasn’t able of extracting any relevant FCCID, only for similiar models like SP022.</p> <div class="image-container"> <div class="image-wrapper-single"> <a href="http://i.imgur.com/6UA9B3B.png" title="Product Photo SP009" target="_blank"> <img class="image" src="http://i.imgur.com/6UA9B3B.png" alt="Product Photo SP009" /> </a> <p class="image-caption">Product Photo SP009</p> </div> </div> <p>Examing product without opening it reveals a 720p camera module, IR sensor, LED’s for indicating running system, SD card slot and a reset button. On the backshell of the camera is a sticker with the ID (probably for database issues) and the default password.</p> <div class="image-container"> <div class="image-wrapper-double"> <a href="http://i.imgur.com/6UA9B3B.png" title="Covering with product sticker" target="_blank"> <img class="image1" src="http://i.imgur.com/XAjB0hf.jpg" alt="Covering with product sticker" /> </a> <p class="image-caption">Covering with product sticker</p> </div> <div class="image-wrapper-double"> <a href="http://i.imgur.com/6UA9B3B.png" title="Inside view of covering with speaker" target="_blank"> <img class="image2" src="http://i.imgur.com/d09zn5q.jpg" alt="Inside view of covering with speaker" /> </a> <p class="image-caption">Inside view of covering with speaker</p> </div> </div> <p>On the inner side of the backshell lies a small speaker. It was my first action to plug it off the main board, because it does annoying beeps when not paired with the smartphone app.</p> <p>The main board reveals all the parts for the functionalities of the cam.</p> <div class="image-container"> <div class="image-wrapper-single"> <a href="http://i.imgur.com/Y7b0J4q.jpg" title="PCB front with assembly of parts" target="_blank"> <img class="image" src="http://i.imgur.com/Y7b0J4q.jpg" alt="PCB front with assembly of parts" /> </a> <p class="image-caption">PCB front with assembly of parts</p> </div> </div> <h4 id="11-wifi">1.1 WiFi</h4> <ul> <li>Link: https://www.mediatek.com/products/broadbandWifi/mt7601u</li> <li>Identifier: MT7601UN 1530-BMJL GTP39Y55</li> </ul> <p>According to mediatek “High-performance 802.11n for compact and cost-effective Wi-Fi devices”. Provides network connectivity for the cam and will communicate with the main processor via SPI.?</p> <h4 id="12-soc">1.2 SoC</h4> <ul> <li>Link: http://www.grain-media.com/html/8136S_8135S.htm</li> <li>Identifier: GM8 135S-OC SMSKH-000 AG-1525</li> </ul> <div class="image-container"> <div class="image-wrapper-single"> <a href="http://i.imgur.com/IPcaKkf.jpg" title="SoC architecture" target="_blank"> <img class="image" src="http://i.imgur.com/IPcaKkf.jpg" alt="SoC architecture" /> </a> <p class="image-caption">SoC architecture</p> </div> </div> <p>We can see that it’s a ARM architecture and it has a lot of interfaces. Next to the SoC lies the suspected UART interface.</p> <h4 id="13-flash">1.3 Flash</h4> <ul> <li>Link: http://html.alldatasheet.com/html-pdf/575542/MCNIX/MX25L12835E/1114/7/MX25L12835E.html (similiar model)</li> <li>Identifier: MX25L12805E (on the chip is MX25L12805D printed)</li> <li>Name: 16M-BIT [x 1] CMOS SERIAL FLASH</li> </ul> <div class="image-container"> <div class="image-wrapper-single"> <a href="http://i.imgur.com/y9UWskY.jpg" title="Flash pinout" target="_blank"> <img class="image" src="http://i.imgur.com/y9UWskY.jpg" alt="Flash pinout" /> </a> <p class="image-caption">Flash pinout</p> </div> </div> <p>It’s surprising that although there is printed MX25L12805E, it’s the chip MX25L12805D. They varies in pinning and flash size. This flash stores the operating system and all binaries and other files for operation. Looking later at the booting prompt will reveal it’s real “type”. We will examine later, whether it’s possible to get some information out of the chip via SPI.</p> <h4 id="14-power-management">1.4 Power Management</h4> <ul> <li>Link: http:/A3/www.everanalog.com/Product/ProductEA3036DetailInfo.aspx</li> <li>Identifier: EA3036 4j088s</li> <li>Name: 3CH power management IC</li> </ul> <p>Provides the driver circuit for the Power Management. Very Important for function of the cam but not really interesting for examination.</p> <h4 id="15-sd-card-slot">1.5 SD card slot</h4> <p>Looks like a typical reader for microSD cards like used on Raspberry Pi. I guess, it could be used to store videos and pictures, captured by the camera. It will become useful to copy things from the filesystem and maybe executing external binaries.</p> <p>On the back of the main board are some other parts.</p> <div class="image-container"> <div class="image-wrapper-single"> <a href="http://i.imgur.com/2wa6WmI.jpg" title="PCB backside" target="_blank"> <img class="image" src="http://i.imgur.com/2wa6WmI.jpg" alt="PCB backside" /> </a> <p class="image-caption">PCB backside</p> </div> </div> <h4 id="16-eeprom">1.6 EEPROM</h4> <ul> <li>Link: http://www.celtor.pl/2447,24c04d-eeprom-szeregowa-4kb-512bx-so8.html</li> <li>Identifier: 24c04d 538b1</li> </ul> <p>Like the Flash it should communicate via SPI with the main processor. The EEPROM stores the Bootloader that will provide the program to load the operating system from the Flash. It’s much smaller with only 16kB. When it’s not possible to read the Flash, I would continue with the EEPROM.</p> <h4 id="17-audio-amplifier">1.7 Audio Amplifier</h4> <ul> <li>Link: http://www.inkocean.in/the-md8002a-8002a-sop8-smd-3w-audio-amplifier-ic-chip</li> <li>Identifier: 8002a swire15</li> </ul> <p>You can find this part on the board two times. It will amplify the audio signal from the DAC to hearable power level. Won’t be in our focus, either.</p> <h4 id="18-shell">1.8 Shell</h4> <p>The WiFi antenna is stucked in the front shell of the camera.</p> <div class="image-container"> <div class="image-wrapper-single"> <a href="http://i.imgur.com/MwJ3CNj.jpg" title="Front covering with attached WiFi antenna" target="_blank"> <img class="image" src="http://i.imgur.com/MwJ3CNj.jpg" alt="Front covering with attached WiFi antenna" /> </a> <p class="image-caption">Front covering with attached WiFi antenna</p> </div> </div> <p>Inside this front shell lies this “LED ring” with some status LED’s and the IR sensor for measuring brightness, I guess.</p> <div class="image-container"> <div class="image-wrapper-double"> <a href="http://i.imgur.com/2Hy5mYM.png" title="LED circuit back side" target="_blank"> <img class="image1" src="http://i.imgur.com/2Hy5mYM.jpg" alt="LED circuit back side" /> </a> <p class="image-caption">LED circuit back side</p> </div> <div class="image-wrapper-double"> <a href="http://i.imgur.com/0H2RkYn.png" title="LED circuit front side" target="_blank"> <img class="image2" src="http://i.imgur.com/0H2RkYn.jpg" alt="LED circuit front side" /> </a> <p class="image-caption">LED circuit front side</p> </div> </div> <h2 id="2-access-over-hardware-ports">2. Access over Hardware Ports</h2> <h3 id="21-uart">2.1 UART</h3> <p>Without taking further measurements, I suspected the three pins in previous picture to be a UART serial port. As the first one has a squareformed joint, it’s supposed to be the GND pin and the two other ones Tx and Rx.</p> <div class="image-container"> <div class="image-wrapper-single"> <a href="http://i.imgur.com/kjnXzwU.jpg" title="UART Buspirate setup" target="_blank"> <img class="image" src="http://i.imgur.com/kjnXzwU.jpg" alt="UART Buspirate setup" /> </a> <p class="image-caption">UART Buspirate setup</p> </div> </div> <p>I examined the ports with a buspirate and beeing sure I have the right ports, I tried all popular baudrates and parity bits:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HiZ&gt;m	<span class="c">#Choose protocol from main buspirate interface</span>
1. HiZ
2. 1-WIRE
3. UART
4. I2C
5. SPI
6. 2WIRE
7. 3WIRE
8. LCD
9. DIO
x. <span class="nb">exit</span><span class="o">(</span>without change<span class="o">)</span>

<span class="o">(</span>1<span class="o">)&gt;</span>3	<span class="c">#taking UART</span>
Set serial port speed: <span class="o">(</span>bps<span class="o">)</span>
 1. 300
 2. 1200
 3. 2400
 4. 4800
 5. 9600
 6. 19200
 7. 38400
 8. 57600
 9. 115200
10. BRG raw value

<span class="o">(</span>1<span class="o">)&gt;</span>9	<span class="c">#taking baudrate 115200</span>
Data bits and parity:
 1. 8, NONE <span class="k">*</span>default 
 2. 8, EVEN 
 3. 8, ODD 
 4. 9, NONE
<span class="o">(</span>1<span class="o">)&gt;</span>	<span class="c"># taking default value "no parity"</span>
Stop bits:
 1. 1 <span class="k">*</span>default
 2. 2
<span class="o">(</span>1<span class="o">)&gt;</span>	<span class="c"># taking default value "no stop bits"</span>
Receive polarity:
 1. Idle 1 <span class="k">*</span>default
 2. Idle 0
<span class="o">(</span>1<span class="o">)&gt;</span>	<span class="c"># is the Rx port high or low when it's idle, taking default</span>
Select output <span class="nb">type</span>:
 1. Open drain <span class="o">(</span><span class="nv">H</span><span class="o">=</span>Hi-Z, <span class="nv">L</span><span class="o">=</span>GND<span class="o">)</span>
 2. Normal <span class="o">(</span><span class="nv">H</span><span class="o">=</span>3.3V, <span class="nv">L</span><span class="o">=</span>GND<span class="o">)</span>
<span class="o">(</span>1<span class="o">)&gt;</span>	<span class="c"># taking open drain as driver circuit for the port</span>
Ready
UART&gt;v	<span class="c"># checking the Pinout of the BusPirate</span>
Pinstates:
1.<span class="o">(</span>BR<span class="o">)</span>	2.<span class="o">(</span>RD<span class="o">)</span>	3.<span class="o">(</span>OR<span class="o">)</span>	4.<span class="o">(</span>YW<span class="o">)</span>	5.<span class="o">(</span>GN<span class="o">)</span>	6.<span class="o">(</span>BL<span class="o">)</span>	7.<span class="o">(</span>PU<span class="o">)</span>	8.<span class="o">(</span>GR<span class="o">)</span>	9.<span class="o">(</span>WT<span class="o">)</span>	0.<span class="o">(</span>Blk<span class="o">)</span>
GND	3.3V	5.0V	ADC	VPU	AUX	-	TxD	-	RxD
P	P	P	I	I	I	I	I	I	I	
GND	0.00V	0.00V	0.00V	0.00V	L	L	L	L	L	

UART&gt;<span class="o">(</span>2<span class="o">)</span> <span class="c"># choosing mode to only receive output</span>
Raw UART input
Any key to <span class="nb">exit</span>
<span class="o">&gt;</span>�ʛ���s�Ϲܒ<span class="sb">`</span>���e����k��������������ʗ���0�����������������컚�Ϙ�ߚЛ�������������%�������i���C�������q ��q����<span class="s2">"�c9�a�"</span>:�i���C�������q ��q����<span class="s2">"�c9�a�"</span>���i���C�������q ��q����<span class="s2">"�c9�a�"</span>���i��
...
q ��<span class="o">)</span>���<span class="s2">"��c9ñ"</span>:��C��������q <span class="p">;</span>�<span class="o">)</span>���<span class="s2">"�c9ñ"</span>:��C��������q <span class="p">;</span>�<span class="o">)</span>���<span class="s2">"�c9ñ"</span>:�i
</code></pre></div></div> <p>Trying all different baudrates and parity bits didn’t give any better result. With a hint of https://twitter.com/adi1391 (course instructor) it was easy. The square pin isn’t GND, it’s RX (RX,GND,TX) with baudrate of 115200. I don’t know whether it’s the desired behaviour or a bug. In every case it will create some confusion.</p> <div class="image-container"> <div class="image-wrapper-single"> <a href="http://i.imgur.com/ZIkf5W2.jpg" title="UART soldering" target="_blank"> <img class="image" src="http://i.imgur.com/ZIkf5W2.jpg" alt="UART soldering" /> </a> <p class="image-caption">UART soldering</p> </div> </div> <p>So first lesson learned: Never trust in habits. With this pinning I was able to get readable output and furthermore a shell with Root Rights but the whole file system is mounted only as readable. For the sake of readabilty I will put booting output into external link.</p> <p><a href="https://github.com/herrfeder/Offensive_IOT_Exploitation/blob/master/gist_files/booting_output.txt">Booting Stdout</a></p> <p>It gives some interesting information:</p> <ul> <li>The flash isn’t complying (like I mentioned before) with it’s printing. It’s 16MB in size. Enough to hold a whole flash firmware.</li> <li>Flash software is iJFFS2 version 2.2. (NAND) from Red Hat</li> <li>Flash communicates via SPI and creates 6 partitions on the flash <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SPI_FLASH spi0.0: MX25L12845E <span class="o">(</span>16384 Kbytes<span class="o">)</span>
Creating 6 MTD partitions on <span class="s2">"nor-flash"</span>:
0x000000010000-0x000000080000 : <span class="s2">"UBOOT"</span>
0x000000080000-0x000000380000 : <span class="s2">"LINUX"</span>
0x000000380000-0x000000b00000 : <span class="s2">"FS"</span>
0x000000b00000-0x000000c00000 : <span class="s2">"USER0"</span>
0x000000c00000-0x000001000000 : <span class="s2">"USER1"</span>
0x000000000000-0x000001000000 : <span class="s2">"ALL"</span>
</code></pre></div> </div> </li> <li>OS runs Linux RTOS with busybox on squashfs filesystem and library relies on microClib (important for executing external binaries)</li> <li>DRAM is 64 MiB</li> <li>we have USB interfaces (probably for the SD Card Reader) <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Drive Vbus because of ID pin shows Device A
fotg210 fotg210.0: FOTG2XX
fotg210 fotg210.0: new USB bus registered, assigned bus number 1
fotg210 fotg210.0: irq 9, io mem 0x93000000
fotg210 fotg210.0: USB 2.0 started, EHCI 1.00
hub 1-0:1.0: USB hub found
hub 1-0:1.0: 1 port detected
</code></pre></div> </div> </li> <li>there is a I2C bus <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>i2c /dev entries driver
ftiic010 ftiic010.0: irq 18, mapped at 84860000
I2C hangs detection thread started!
</code></pre></div> </div> </li> <li>uses lib80211 for WiFi functionalities</li> </ul> <p>After getting through booting and many applies of doing some OS tasks we have a shell. The shell will be harassed by intervalled output of WiFi Core that indicates it’s in STA mode and scans for a certain AP.</p> <h3 id="22-getting-firmware">2.2 Getting Firmware</h3> <h4 id="221-dumping-from-system-via-sdcard">2.2.1 Dumping from System via SDCard</h4> <ul> <li>We can dump nearly the whole filesystem by simply copying it onto an sdcard.</li> <li>It will be mounted as /mnt/disk1.</li> </ul> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/mnt <span class="c"># mmc0: new high speed SDHC card at address e624</span>
mmcblk0: mmc0:e624 SU08G 7.40 GiB 
 mmcblk0:
found removeable disk1 
mount  removeable disk1 OK 
dwDiscState <span class="o">=</span> 2 

/# <span class="nb">cp</span> <span class="nt">-r</span> / /mnt/disk1/
</code></pre></div></div> <p>Searching for interesting info bits in the file system</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># grep -rli aes</span>
npc/npc
patch/bin/wpa_supplicant
patch/lib/mt7601Usta_v2.ko
lib/modules/ms.ko

<span class="c"># grep -rli firmware</span>
npc/npc
patch/bin/ifrename
patch/lib/mt7601Usta_v2.ko
gm/bin/busybox
gm/tools/ethtool
</code></pre></div></div> <p>The directory npc with the executable npc seems to be very interesting:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/npc <span class="c"># ls</span>
dhcp.script     minihttpd.conf  patch           txt             wPipe
gwellipc        mtd             pipe_create     upgfile_ok
img             npc             sound           version.txt

/npc <span class="c"># cat npc | grep aes</span>
aes-128-ecb
aes-128-cbc
aes-128-ofb
aes-128-cfb
...
id-aes128-wrap
id-aes192-wrap
id-aes256-wrap
e_aes.c
aes key setup failed


/npc <span class="c"># cat npc | grep -i password</span>
Password
PasswordType
RemotlySetPassword
Super_Password
<span class="k">*</span>cESSID:%s,cPassword:%s,dwEncType <span class="o">=</span> %d
challengePassword
...
Password Fail <span class="nv">IP</span><span class="o">=</span>%d <span class="nv">Counter</span><span class="o">=</span>%d <span class="nv">dwPassword</span><span class="o">=</span>%d
Guest Password verify OK 1...
Password verify fail 1...
Super Password 
super+manager Password 
Password verify OK1 ...
Password verify fail 1...
</code></pre></div></div> <p>npc has a lot of strings in it related to encrypting and network authentication. It’s necessary to obtain this binary from the filesystem to examine it in detail. I will look into the npc binary in a additional gistfile: https://gist.github.com/herrfeder/883093ae93eaefba8950c00f6a6bbed8#file-sricam_upnp_npc-md</p> <h4 id="222-dumping-flash-via-spi">2.2.2 Dumping Flash via SPI</h4> <p>My initial concept was to use the Attify Badge with the description from the IOT Exploitation Manual with the tool spiflash (https://github.com/devttys0/libmpsse). As I own a Testclip for 8-pin DIP-Chips, I can simply attach it to the Flash Chip with the following pinning:</p> <div class="image-container"> <div class="image-wrapper-double"> <a href="http://i.imgur.com/HTxJdvf.jpg" title="Testclip on the Flash Chip" target="_blank"> <img class="image1" src="http://i.imgur.com/HTxJdvf.jpg" alt="Testclip on the Flash Chip" /> </a> <p class="image-caption">Testclip on the Flash Chip</p> </div> <div class="image-wrapper-double"> <a href="http://i.imgur.com/53Claa1.jpg" title="Pinning of the Testclip Cable" target="_blank"> <img class="image2" src="http://i.imgur.com/53Claa1.jpg" alt="Pinning of the Testclip Cable" /> </a> <p class="image-caption">Pinning of the Testclip Cable</p> </div> </div> <div class="image-container"> <div class="image-wrapper-single"> <a href="http://i.imgur.com/8q7AWW3.jpg" title="Overview of SPI flashing with Attify Badge" target="_blank"> <img class="image" src="http://i.imgur.com/8q7AWW3.jpg" alt="Overview of SPI flashing with Attify Badge" /> </a> <p class="image-caption">Overview of SPI flashing with Attify Badge</p> </div> </div> <p>It will sucessfully detect the Flash Chip probably indicated by the zeros. Because without attaching anything or the wrong pins it will show up “FF FF FF” instead (maybe it’s only indicating signal high on connected pin):</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ~/tools/libmpsse/src/examples</span>
<span class="nv">$ </span><span class="nb">sudo </span>python spiflash.py <span class="nt">-i</span>
<span class="o">[</span><span class="nb">sudo</span><span class="o">]</span> password <span class="k">for </span>oit: 
FT232H Future Technology Devices International, Ltd initialized at 15000000 hertz
00 00 00 
</code></pre></div></div> <p>Now I will try to dump it’s memory to a file. We need some information to do so like the address offset where the firmware image starts and the size of memory. We know from the booting process that the uBoot Partition starts at 0x10000 (int 65536) and the memory size is 16MiB (16<em>1024</em>1024). So we can try to start the script with the right params:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ~/tools/libmpsse/src/examples</span>
<span class="nv">$ </span><span class="nb">sudo </span>python spiflash.py <span class="nt">-a</span> 65536 <span class="nt">-s</span> 167510016 <span class="nt">-r</span> ip_cam.bin
FT232H Future Technology Devices International, Ltd initialized at 15000000 hertz
Reading 167510016 bytes starting at address 0x10000...saved to ip_cam.bin.
</code></pre></div></div> <p>But when looking into the file, it only has 0x0000 in it:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ~/tools/libmpsse/src/examples</span>
<span class="nv">$ </span>hexdump ip_cam.bin 
0000000 0000 0000 0000 0000 0000 0000 0000 0000
<span class="k">*</span>
9fc0000
</code></pre></div></div> <p>After some research I saw that others struggled with the same problem:</p> <ul> <li>https://github.com/Marzogh/SPIFlash/issues/37</li> <li>https://www.ghostlyhaks.com/forum/rom-eeprom-bios-efi-uefi/64-can-t-dump-or-read-mx25l6406e-chip</li> </ul> <p>I decided to give the Bus Pirate a try with the tool flashrom (https://www.flashrom.org/Bus_Pirate) as it’s supports the BusPirate directly. I got the BusPirate SPI Pinning:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SPI&gt;v
Pinstates:
1.<span class="o">(</span>BR<span class="o">)</span>	2.<span class="o">(</span>RD<span class="o">)</span>	3.<span class="o">(</span>OR<span class="o">)</span>	4.<span class="o">(</span>YW<span class="o">)</span>	5.<span class="o">(</span>GN<span class="o">)</span>	6.<span class="o">(</span>BL<span class="o">)</span>	7.<span class="o">(</span>PU<span class="o">)</span>	8.<span class="o">(</span>GR<span class="o">)</span>	9.<span class="o">(</span>WT<span class="o">)</span>	0.<span class="o">(</span>Blk<span class="o">)</span>
GND	3.3V	5.0V	ADC	VPU	AUX	CLK	MOSI	CS	MISO
P	P	P	I	I	I	O	O	O	I	
GND	0.00V	0.00V	0.00V	0.00V	L	L	L	L	L	
</code></pre></div></div> <p>and connected it to the Testclip, the following way:</p> <div class="image-container"> <div class="image-wrapper-single"> <a href="http://i.imgur.com/CqYLtBW.jpg" title="Overview of SPI flashing with Buspirate" target="_blank"> <img class="image" src="http://i.imgur.com/CqYLtBW.jpg" alt="Overview of SPI flashing with Buspirate" /> </a> <p class="image-caption">Overview of SPI flashing with Buspirate</p> </div> </div> <p>Using the command for flashrom to write the memory into file:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ~/tools/</span>
<span class="nv">$ </span>flashrom <span class="nt">-V</span> <span class="nt">-p</span> buspirate_spi:dev<span class="o">=</span>/dev/ttyUSB0,spispeed<span class="o">=</span>1M <span class="nt">-r</span> MX25L128.bin <span class="nt">-c</span> MX25L12835F/MX25L12845E/MX25L12865E

flashrom v0.9.9-r1954 on Linux 4.7.0-kali1-amd64 <span class="o">(</span>x86_64<span class="o">)</span>
flashrom is free software, get the <span class="nb">source </span>code at https://flashrom.org

flashrom was built with libpci 3.5.2, GCC 6.3.0 20170221, little endian
Command line <span class="o">(</span>7 args<span class="o">)</span>: flashrom <span class="nt">-V</span> <span class="nt">-p</span> buspirate_spi:dev<span class="o">=</span>/dev/ttyUSB0,spispeed<span class="o">=</span>1M <span class="nt">-r</span> MX25L128.bin <span class="nt">-c</span> MX25L12835F/MX25L12845E/MX25L12865E
Calibrating delay loop... OS timer resolution is 1 usecs, 2605M loops per second, 10 myus <span class="o">=</span> 11 us, 100 myus <span class="o">=</span> 111 us, 1000 myus <span class="o">=</span> 1025 us, 10000 myus <span class="o">=</span> 10064 us, 4 myus <span class="o">=</span> 5 us, OK.
Initializing buspirate_spi programmer
Detected Bus Pirate hardware v3b
Detected Bus Pirate firmware 5.10
Using SPI <span class="nb">command set </span>v2.
SPI speed is 1MHz
Raw bitbang mode version 1
Raw SPI mode version 1
The following protocols are supported: SPI.
Probing <span class="k">for </span>Macronix MX25L12835F/MX25L12845E/MX25L12865E, 16384 kB: probe_spi_rdid_generic: id1 0xc2, id2 0x2018
Found Macronix flash chip <span class="s2">"MX25L12835F/MX25L12845E/MX25L12865E"</span> <span class="o">(</span>16384 kB, SPI<span class="o">)</span> on buspirate_spi.
Chip status register is 0x00.
Chip status register: Status Register Write Disable <span class="o">(</span>SRWD, SRP, ...<span class="o">)</span> is not <span class="nb">set
</span>Chip status register: Bit 6 is not <span class="nb">set
</span>Chip status register: Block Protect 3 <span class="o">(</span>BP3<span class="o">)</span> is not <span class="nb">set
</span>Chip status register: Block Protect 2 <span class="o">(</span>BP2<span class="o">)</span> is not <span class="nb">set
</span>Chip status register: Block Protect 1 <span class="o">(</span>BP1<span class="o">)</span> is not <span class="nb">set
</span>Chip status register: Block Protect 0 <span class="o">(</span>BP0<span class="o">)</span> is not <span class="nb">set
</span>Chip status register: Write Enable Latch <span class="o">(</span>WEL<span class="o">)</span> is not <span class="nb">set
</span>Chip status register: Write In Progress <span class="o">(</span>WIP/BUSY<span class="o">)</span> is not <span class="nb">set
</span>This chip may contain one-time programmable memory. flashrom cannot <span class="nb">read
</span>and may never be able to write it, hence it may not be able to completely
clone the contents of this chip <span class="o">(</span>see man page <span class="k">for </span>details<span class="o">)</span><span class="nb">.</span>
Reading flash...
</code></pre></div></div> <p>This process took very long and wasn’t really promising but after nearly an hour it finished and I was able to examine a firmware binary:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ~/tools/</span>
<span class="nv">$ </span>strings MX25L128.bin | <span class="nb">grep</span> <span class="nt">-i</span> gcc 
arm-unknown-linux-uclibcgnueabi-gcc <span class="o">(</span>Buildroot 2012.02<span class="o">)</span> 4.4.0 20100318 <span class="o">(</span>experimental<span class="o">)</span>
GcC<span class="se">\M</span>
jGcc
</code></pre></div></div> <p>I guess, due to low maximum sample rates of the BusPirate it will dump really slow. Link for the extracted binary: https://github.com/herrfeder/Offensive_IOT_Exploitation/blob/master/gist_files/ip_cam_firmware.bin</p> <p>Some other interesting links for this purpose:</p> <ul> <li><img src="http://freneticrapport.blogspot.de/2010/10/how-to-restore-bios-after-bad-flash.html" alt="How to restore BIOS after bad flash" /></li> <li><img src="http://hackaday.com/2009/06/30/parts-spi-eeprom-25aa25lc/" alt="SPI interfacing experiments" /></li> <li><img src="https://medium.com/@rxseger/spi-interfacing-experiments-eeproms-bus-pirate-adc-opt101-with-raspberry-pi-9c819511efea" alt="Other SPI interfacing experiments" /></li> </ul> <h2 id="3-acess-over-wireless-interfaces-and-network">3. Acess over Wireless Interfaces and Network</h2> <h4 id="31-internal-communication">3.1 Internal Communication</h4> <p>The UI experience of the App for communicating with the Cam is really bad and I wasn’t patient enough, to set up WiFi connectivity with the App. On first glance I suspected it would setup an open access point and I can simply connect to it but it doesn’t. There is some functionality to connect to another existent WiFi by capturing with the provided Smartphone App generated QR-Code. I took another way and examined the OS of the Cam to find out what it is up to:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/etc/network <span class="c"># cat interfaces </span>
auto lo

iface lo inet loopback

iface eth0 inet static
	address	172.19.78.3
	broadcast 172.31.255.255
	netmask 255.240.0.0
	gateway 172.19.78.2
	pre-up	/sbin/insmod /lib/modules/2.6.14/extra/ftmac100.ko
	post-down /sbin/rmmod ftmac100.ko

<span class="c"># no hints in the configuration on the interfaces</span>

/etc <span class="c"># cat wpa_supplicant0.conf </span>
<span class="nv">ctrl_interface</span><span class="o">=</span>/etc/Wireless  
 <span class="nv">network</span><span class="o">={</span> 
     <span class="nv">ssid</span><span class="o">=</span><span class="s2">"Free-AP0"</span>   
     <span class="nv">key_mgmt</span><span class="o">=</span>NONE  
  <span class="o">}</span>
<span class="c"># but a wpa_supplicant conf with a given SSID  </span>
</code></pre></div></div> <p>As I set up an open AP with the SSID “Free-AP0” the Cam connects immediately to it.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> CH  1 <span class="o">][</span> Elapsed: 6 s <span class="o">][</span> 2017-08-17 18:16 <span class="o">][</span> paused output                                        
                                                                                                       
 BSSID              PWR RXQ  Beacons    <span class="c">#Data, #/s  CH  MB   ENC  CIPHER AUTH ESSID</span>
                                                                                                        
 00:C0:CA:62:41:8F   <span class="nt">-9</span> 100       90       13    0   1  54   OPN              Free-AP0                  
                                                                                                        
 BSSID              STATION            PWR   Rate    Lost    Frames  Probe                              
                                                                                                        
 00:C0:CA:62:41:8F  F8:0C:F3:FF:5F:6C   14   54 - 6      0       11       <span class="c"># Smartphone with App                               </span>
 00:C0:CA:62:41:8F  20:F4:1B:5C:07:AD  <span class="nt">-19</span>    1 - 1      0        5       <span class="c"># IPCam                               </span>
</code></pre></div></div> <p>To set up open or WEP/WPA access points with internet access quickly, I recommend the little bashtool qw (https://github.com/file-not-found/qw) of a collegue of mine. Prequesities are hostapd and dnsmasque. Of course, you can do it with hostapd by bridging or routing the connectivity manually.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/wlan <span class="c"># ./qw ap Free-AP0 wlan0       </span>
Enter passphrase <span class="o">(</span>leave blank <span class="k">for </span>open network<span class="o">)</span>: 
Configuration file: /tmp/qw_1_hostapd.conf
Using interface wlan0 with hwaddr 00:c0:ca:62:41:8f and ssid <span class="s2">"Free-AP0"</span>
wlan0: interface state UNINITIALIZED-&gt;ENABLED
wlan0: AP-ENABLED 
wlan0: STA f8:0c:f3:ff:5f:6c IEEE 802.11: authenticated		<span class="c"># smartphone tries to connect</span>
wlan0: STA f8:0c:f3:ff:5f:6c IEEE 802.11: associated <span class="o">(</span>aid 1<span class="o">)</span>
wlan0: AP-STA-CONNECTED f8:0c:f3:ff:5f:6c
wlan0: STA f8:0c:f3:ff:5f:6c RADIUS: starting accounting session C7E9972B18913018
Unsupported authentication algorithm <span class="o">(</span>1<span class="o">)</span>
handle_auth_cb: STA 20:f4:1b:5c:07:ad not found
Unsupported authentication algorithm <span class="o">(</span>1<span class="o">)</span>
handle_auth_cb: STA 20:f4:1b:5c:07:ad not found
wlan0: STA 20:f4:1b:5c:07:ad IEEE 802.11: authenticated		<span class="c"># IPCam tries to connect</span>
wlan0: STA 20:f4:1b:5c:07:ad IEEE 802.11: associated <span class="o">(</span>aid 2<span class="o">)</span>
wlan0: AP-STA-CONNECTED 20:f4:1b:5c:07:ad
wlan0: STA 20:f4:1b:5c:07:ad RADIUS: starting accounting session 611E6C4DC8EFDE0C
</code></pre></div></div> <p>As the IPCam has network connection we will take the first step of network recon and scan the IPCam itself:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># nmap 10.0.0.21</span>

Starting Nmap 7.50 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2017-08-15 15:10 CEST
Nmap scan report <span class="k">for </span>10.0.0.21
Host is up <span class="o">(</span>0.022s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 998 closed ports
PORT     STATE SERVICE
554/tcp  open  rtsp	<span class="c"># streaming video data locally</span>
5000/tcp open  upnp	<span class="c"># connect to distanced web server, will probably open port on router</span>
MAC Address: 20:F4:1B:5C:07:AD <span class="o">(</span>Shenzhen Bilian electronic<span class="o">)</span>
</code></pre></div></div> <p>As it has an open upnp port I suspected it to open a port on a router, when it is allowed to. I checked this out on a FritzBox but it doesn’t open a port automatically.</p> <p>There is a telnet daemon on the device. It seems to work:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># nmap 10.0.0.21

Starting Nmap 7.50 ( https://nmap.org ) at 2017-08-15 15:23 CEST
Nmap scan report for 10.0.0.21
Host is up (0.20s latency).
Not shown: 997 closed ports
PORT     STATE SERVICE
23/tcp   open  telnet
554/tcp  open  rtsp
5000/tcp open  upnp
MAC Address: 20:F4:1B:5C:07:AD (Shenzhen Bilian electronic)
</code></pre></div></div> <h4 id="32-trying-interactingaccessing-the-provided-services">3.2 Trying Interacting/Accessing the provided services</h4> <p>To get a more detailed view of provided services we will use nmap again to fingerprint the previous found ports and services:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># nmap --script rtsp-url-brute -p 554 10.0.1.25                                                                                                               :(</span>

PORT    STATE SERVICE
554/tcp open  rtsp
| rtsp-url-brute: 
|   discovered: 
...

|     rtsp://10.0.1.25/cam4/mpeg4
|     rtsp://10.0.1.25/Video?Codec<span class="o">=</span>MPEG4&amp;Width<span class="o">=</span>720&amp;Height<span class="o">=</span>576&amp;Fps<span class="o">=</span>30
|     rtsp://10.0.1.25/cam1/onvif-h264
...
|     rtsp://10.0.1.25/cgi-bin/viewer/video.jpg?resolution<span class="o">=</span>640x480
|     rtsp://10.0.1.25/h264Preview_01_sub
|     rtsp://10.0.1.25/h264_vga.sdp
...
|     rtsp://10.0.1.25/nphMpeg4/g726-640x480
|     rtsp://10.0.1.25/nphMpeg4/nil-320x240
|     rtsp://10.0.1.25/onvif-media/media.amp
|     rtsp://10.0.1.25/mpeg4unicast
|     rtsp://10.0.1.25/onvif/live/2
|     rtsp://10.0.1.25/onvif1
|     rtsp://10.0.1.25/onvif2
...
|     rtsp://10.0.1.25/vis
|     rtsp://10.0.1.25/video1+audio1
|     rtsp://10.0.1.25/wfov
|_    rtsp://10.0.1.25/user<span class="o">=</span><span class="nv">admin_password</span><span class="o">=</span><span class="nv">tlJwpbo6_channel</span><span class="o">=</span><span class="nv">1_stream</span><span class="o">=</span>0.sdp?real_stream



<span class="c"># nmap --script rtsp-methods -p 554 10.0.1.25</span>

PORT    STATE SERVICE
554/tcp open  rtsp
|_rtsp-methods: OPTIONS, DESCRIBE, SETUP, TEARDOWN, PLAY, PAUSE, GET_PARAMETER, SET_PARAMETER,USER_CMD_SET

</code></pre></div></div> <p>Many of these detected URL’s doesn’t work. rtsp://10.0.1.25/onvif1 will give definitely a stream.</p> <p>This seems very interesting but doing research for it doesn’t bring up as many attack vectors and info material as UPNP does. The services presented on this port suffers often evil vulnerabilties. It’s more critical that UPNP devices often forces the gateway to open ports independently to connect to backend or remote servers of the manufacturers or other third parties. Many DDos attacks in the past with IOT involved used open UPNP ports to control them. Footprinting this UPNP port reveals it’s presented service and version:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># nmap -sV -p 5000 10.0.1.25</span>

PORT     STATE SERVICE VERSION
5000/tcp open  soap    gSOAP 2.8
</code></pre></div></div> <p>So my first action was to speak with popular UPNP hacker tools to the interface but didn’t respond:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># miranda -i wlan0 -v</span>

Binding to interface wlan0 ...

Verbose mode enabled!
upnp&gt; msearch

Entering discovery mode <span class="k">for</span> <span class="s1">'upnp:rootdevice'</span>, Ctl+C to stop...
</code></pre></div></div> <p>Metasploit, the famous exploiting framework includes some UPNP attack vectors for exploits especially for routers. To act as a real noob I will fire up some of these scripts to hope for any reaction without any knowledge of the underlying service “gSoap”. Obviously this didn’t result in any success. Metasploit includes another UPNP ssdp scanner but it won’t triggers anythin neither.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>msf <span class="o">&gt;</span> use auxiliary/scanner/upnp/ssdp_msearch
msf auxiliary<span class="o">(</span>ssdp_msearch<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>RHOSTS 10.0.1.25/32
msf auxiliary<span class="o">(</span>ssdp_msearch<span class="o">)</span> <span class="o">&gt;</span> run

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Sending UPnP SSDP probes to 10.0.1.25-&gt;10.0.1.25 <span class="o">(</span>1 hosts<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> No SSDP endpoints found.
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Scanned 1 of 1 hosts <span class="o">(</span>100% <span class="nb">complete</span><span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Auxiliary module execution completed
</code></pre></div></div> <p>As it won’t broadcasting anything to it’s environment it has to be an API I have to trigger somehow. So I tried to access the port it via Webbrowser at first. It shows a SOAP XML-API that doesn’t want’s to be served with GET requests:</p> <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;SOAP-ENV:Fault</span> <span class="na">xmlns:SOAP-ENV=</span><span class="s">"http://www.w3.org/2003/05/soap-envelope"</span> <span class="na">xmlns:SOAP-ENC=</span><span class="s">"http://www.w3.org/2003/05/soap-encoding"</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="na">xmlns:xsd=</span><span class="s">"http://www.w3.org/2001/XMLSchema"</span> <span class="na">xmlns:wsa=</span><span class="s">"http://schemas.xmlsoap.org/ws/2004/08/addressing"</span> <span class="na">xmlns:wsdd=</span><span class="s">"http://schemas.xmlsoap.org/ws/2005/04/discovery"</span> <span class="na">xmlns:chan=</span><span class="s">"http://schemas.microsoft.com/ws/2005/02/duplex"</span> <span class="na">xmlns:wsa5=</span><span class="s">"http://www.w3.org/2005/08/addressing"</span> <span class="na">xmlns:xmime=</span><span class="s">"http://tempuri.org/xmime.xsd"</span> <span class="na">xmlns:xop=</span><span class="s">"http://www.w3.org/2004/08/xop/include"</span> <span class="na">xmlns:tt=</span><span class="s">"http://www.onvif.org/ver10/schema"</span> <span class="na">xmlns:wsrfbf=</span><span class="s">"http://docs.oasis-open.org/wsrf/bf-2"</span> <span class="na">xmlns:wstop=</span><span class="s">"http://docs.oasis-open.org/wsn/t-1"</span> <span class="na">xmlns:wsrfr=</span><span class="s">"http://docs.oasis-open.org/wsrf/r-2"</span> <span class="na">xmlns:tdn=</span><span class="s">"http://www.onvif.org/ver10/network/wsdl"</span> <span class="na">xmlns:tds=</span><span class="s">"http://www.onvif.org/ver10/device/wsdl"</span> <span class="na">xmlns:tev=</span><span class="s">"http://www.onvif.org/ver10/events/wsdl"</span> <span class="na">xmlns:wsnt=</span><span class="s">"http://docs.oasis-open.org/wsn/b-2"</span> <span class="na">xmlns:tptz=</span><span class="s">"http://www.onvif.org/ver20/ptz/wsdl"</span> <span class="na">xmlns:trt=</span><span class="s">"http://www.onvif.org/ver10/media/wsdl"</span><span class="nt">&gt;</span>
<span class="nt">&lt;faultcode&gt;</span>SOAP-ENV:Client<span class="nt">&lt;/faultcode&gt;</span>
<span class="nt">&lt;faultstring&gt;</span>HTTP GET method not implemented<span class="nt">&lt;/faultstring&gt;</span>
<span class="nt">&lt;/SOAP-ENV:Fault&gt;</span>
</code></pre></div></div> <p>Now I need to get to know how to communicate with this api. This link can help: http://forums.opto22.com/t/how-to-send-soap-messages/951/9 I need to send POST requests with a XML string in SOAP format. In addition I was searching for “soap” string in the filesystem, it will reveal that the binary npc holds the gSoap service and used headers and SOAP elements:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># strings npc | grep -i soap </span>
SOAP-ENV
http://www.w3.org/2003/05/soap-envelope
http://schemas.xmlsoap.org/soap/envelope/
SOAP-ENC
...
gSOAP Web Service
gSOAP/2.8
wsa5:SoapAction
SOAP-ENC:id
SOAP-ENC:position
...
xmlns:SOAP-RPC
SOAP-ENC:ref
application/xop+xml<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-8<span class="p">;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"application/soap+xml"</span>
SOAPAction
SOAP-ENC:Array
...
no master socket <span class="k">in </span>soap_accept<span class="o">()</span>
accept failed <span class="k">in </span>soap_accept<span class="o">()</span>
setsockopt SO_RCVBUF failed <span class="k">in </span>soap_accept<span class="o">()</span>
setsockopt TCP_NODELAY failed <span class="k">in </span>soap_accept<span class="o">()</span>
SOAP-ENC:root
</code></pre></div></div> <p>There are interesting strings like “xmlns:SOAP-RPC” and “wsa5:SoapAction” which leads to implemented methods, I guess. As I know I have to send POST requests with attached XML content I can easily craft such a request with curl:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-H</span> <span class="s2">"Content-Type: text/xml; charset=utf-8"</span> <span class="nt">-H</span> <span class="s2">"SOAPAction:"</span> <span class="nt">-d</span> @soap_req_01.txt <span class="nt">-X</span> POST http://10.0.1.25:5000
</code></pre></div></div> <p>With the example soap request:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># cat soap_req_01.txt </span>

&lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">"1.0"</span> <span class="nv">encoding</span><span class="o">=</span><span class="s2">"UTF-8"</span> <span class="nv">standalone</span><span class="o">=</span><span class="s2">"no"</span> ?&gt;
  &lt;SOAP-ENV:Envelope
   SOAP-ENV:encodingStyle<span class="o">=</span><span class="s2">"http://schemas.xmlsoap.org/soap/encoding/"</span>
   xmlns:SOAP-ENV<span class="o">=</span><span class="s2">"http://schemas.xmlsoap.org/soap/envelope/"</span>
   xmlns:SOAP-ENC<span class="o">=</span><span class="s2">"http://schemas.xmlsoap.org/soap/encoding/"</span>
   xmlns:xsi<span class="o">=</span><span class="s2">"http://www.w3.org/1999/XMLSchema-instance"</span>
   xmlns:xsd<span class="o">=</span><span class="s2">"http://www.w3.org/1999/XMLSchema"</span><span class="o">&gt;</span>
	&lt;SOAP-ENV:Body&gt;
		&lt;ns1:doubleAnInteger
		 xmlns:ns1<span class="o">=</span><span class="s2">"urn:MySoapServices"</span><span class="o">&gt;</span>
			&lt;param1 xsi:type<span class="o">=</span><span class="s2">"xsd:int"</span><span class="o">&gt;</span>123&lt;/param1&gt;
		&lt;/ns1:doubleAnInteger&gt;
	&lt;/SOAP-ENV:Body&gt;
  &lt;/SOAP-ENV:Envelope&gt;
</code></pre></div></div> <p>I tried a lot of different ones and it will result in errors like “Method not implemented” as I don’t know the used methods. I don’t know how to craft the headers for the methods as I don’t have much knowledge about SOAP API’s and it seems to be not the easiest API especially when not knowing the used methods.</p> <p>There was released a quite fresh Exploit “Devil’s Ivy” of the service gSoap in several versions. This will be handled in a extra gistfile: https://gist.github.com/herrfeder/883093ae93eaefba8950c00f6a6bbed8#file-sricam_upnp_npc-md http://blog.senr.io/devilsivy.html</p> <h3 id="33-external-communication">3.3 External Communication</h3> <p>As I suspect an encrypted connection between IPCam, Smartphone and Backend Server, we need to sniff directly on the IPCam or the smartphone. I guess, it’s much easier to setup raw sniffing on a rooted Android powered mobile phone. The rooting is necessary for sniffing raw traffic on the network. I downloaded tcpdump for Android (http://www.androidtcpdump.com/) and load it onto the phone. For placing and executing an external binary are only a few places appropriate in the android file system. You can use /data/local/tmp or /sdcard/tmp or maybe some other. With adb we can control our Phone now.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>adb shell		<span class="c">#opening shell on android phone</span>
shell@mako:/ <span class="nv">$ </span>su
root@mako:/data/local/tmp <span class="c"># ./tcpdump -n -s 0 -w ipcam_cap                   </span>
tcpdump: listening on wlan0, link-type EN10MB <span class="o">(</span>Ethernet<span class="o">)</span>, capture size 262144 bytes
^C16598 packets captured
16598 packets received by filter
0 packets dropped by kernel
root@mako:/data/local/tmp <span class="c"># ls</span>
hexdump.bin
ipcam_cap
tcpdump
</code></pre></div></div> <h4 id="331-communication-between-mobile-phone-and-ipcam">3.3.1 Communication between Mobile Phone and IPCam</h4> <p>I was trying to trigger many activities in the communication between App and IPCam to get interesting traffic. There was some interesting traffic. In following screenshots the App activity screenshots will be paired with screenshots of interesting packets. To filter all the Android and Google Stuff it’s useful to filter some IP’s. I use wireshark for this:</p> <p><a href="https://github.com/herrfeder/Offensive_IOT_Exploitation/blob/master/gist_files/smartphone_10.0.0.27_ipcam_10.0.0.21.cap">Communication Smartphone IPCam</a></p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>not ip.addr <span class="o">==</span> 172.217.22.99 <span class="o">&amp;&amp;</span> not ip.addr <span class="o">==</span> 216.58.205.0/24 <span class="o">&amp;&amp;</span> ip.addr <span class="o">==</span> 10.0.0.0/24
</code></pre></div></div> <div class="image-container"> <div class="image-wrapper-double"> <a href="http://i.imgur.com/OQz4e8X.png" title="Register Screenshot 1" target="_blank"> <img class="image1" src="http://i.imgur.com/OQz4e8X.png" alt="Register Screenshot 1" /> </a> <p class="image-caption">Register Screenshot 1</p> </div> <div class="image-wrapper-double"> <a href="http://i.imgur.com/0H2RkYn.png" title="Register Screenshot 2" target="_blank"> <img class="image2" src="http://i.imgur.com/0H2RkYn.jpg" alt="Register Screenshot 2" /> </a> <p class="image-caption">Register Screenshot 2</p> </div> </div> <div class="image-container"> <div class="image-wrapper-single"> <a href="http://i.imgur.com/4nQNNgK.png" title="Login Check" target="_blank"> <img class="image" src="http://i.imgur.com/4nQNNgK.png" alt="Login Check" /> </a> <p class="image-caption">Login Check</p> </div> </div> <div class="image-container"> <div class="image-wrapper-single"> <a href="http://i.imgur.com/ldewdMA.png" title="Answer for existing login" target="_blank"> <img class="image" src="http://i.imgur.com/ldewdMA.png" alt="Answer for existing login" /> </a> <p class="image-caption">Answer for existing login</p> </div> </div> <div class="image-container"> <div class="image-wrapper-double"> <a href="http://i.imgur.com/OPrbLyR.png" title="Add Friend / Add camera to personal dash" target="_blank"> <img class="image1" src="http://i.imgur.com/OPrbLyR.png" alt="Add Friend / Add camera to personal dash" /> </a> <p class="image-caption">Add Friend / Add camera to personal dash</p> </div> <div class="image-wrapper-double"> <a href="http://i.imgur.com/YDGSJ34.png" title="After adding =&gt; Get friends list" target="_blank"> <img class="image2" src="http://i.imgur.com/YDGSJ34.png" alt="After adding =&gt; Get friends list" /> </a> <p class="image-caption">After adding =&gt; Get friends list</p> </div> </div> <div class="image-container"> <div class="image-wrapper-single"> <a href="http://i.imgur.com/ldewdMA.png" title="Answer for existing login" target="_blank"> <img class="image" src="http://i.imgur.com/ldewdMA.png" alt="Answer for existing login" /> </a> <p class="image-caption">Answer for existing login</p> </div> </div> <div class="image-container"> <div class="image-wrapper-single"> <a href="http://i.imgur.com/zybnO0G.png" title="Add friend capture" target="_blank"> <img class="image" src="http://i.imgur.com/zybnO0G.png" alt="Add friend capture" /> </a> <p class="image-caption">Add friend capture</p> </div> </div> <div class="image-container"> <div class="image-wrapper-single"> <a href="http://i.imgur.com/ldewdMA.png" title="Reply for existing login" target="_blank"> <img class="image" src="http://i.imgur.com/ldewdMA.png" alt="Reply for existing login" /> </a> <p class="image-caption">Reply for existing login</p> </div> </div> <div class="image-container"> <div class="image-wrapper-single"> <a href="http://i.imgur.com/Ixswo9z.png" title="Get friends list" target="_blank"> <img class="image" src="http://i.imgur.com/Ixswo9z.png" alt="Get friends list" /> </a> <p class="image-caption">Get friends list</p> </div> </div> <div class="image-container"> <div class="image-wrapper-single"> <a href="http://i.imgur.com/8I54Wvk.png" title="Delete friend" target="_blank"> <img class="image" src="http://i.imgur.com/8I54Wvk.png" alt="Delete friend" /> </a> <p class="image-caption">Delete friend</p> </div> </div> <div class="image-container"> <div class="image-wrapper-single"> <a href="http://i.imgur.com/jF4HlyL.png" title="Get Version" target="_blank"> <img class="image" src="http://i.imgur.com/jF4HlyL.png" alt="Get Version" /> </a> <p class="image-caption">Get Version</p> </div> </div> <div class="image-container"> <div class="image-wrapper-single"> <a href="http://i.imgur.com/O9da1vS.png" title="Reply for version" target="_blank"> <img class="image" src="http://i.imgur.com/O9da1vS.png" alt="Reply for version" /> </a> <p class="image-caption">Reply for version</p> </div> </div> <p>The first bad intention of the security architecture is using only plain HTTP communication. They are “secured” by a Session ID and some kind of encryption in the payloads.</p> <h4 id="332-firmware-update">3.3.2 Firmware Update</h4> <p>The app delivers the possibility of doing a firmware update of the IPCam. Of course, I captured this: <a href="https://github.com/herrfeder/Offensive_IOT_Exploitation/blob/master/gist_files/firmware_upgrade.cap">Firmware Upgrade</a> But there isn’t any obvious activity in the file, that would point out a firmware upgrade. Only many udp traffic between smartphone and IPCam. Following this UDP stream over the whole capture:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="sb">`</span>...<span class="o">}</span>E.k............4...<span class="sb">`</span>...<span class="o">}</span>E.k............4...<span class="sb">`</span>...<span class="o">}</span>E.k............4...<span class="sb">`</span>...~E.k.... ...........<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>...~E.k.... ...........<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... .......	...<span class="sb">`</span>....E.k.... .......
...<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... .......!...<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... ....... ...<span class="sb">`</span>....E.k.... .......!...<span class="sb">`</span>....E.k.... .......<span class="s2">"...</span><span class="sb">`</span>....E.k.... ...........<span class="sb">`</span><span class="s2">....E.k.... ...........</span><span class="sb">`</span>....E.k.... ...........<span class="sb">`</span><span class="s2">....E.k.... ....... ...</span><span class="sb">`</span>....E.k.... .......!...<span class="sb">`</span><span class="s2">....E.k.... ......."</span>...<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... .........dm..<span class="sb">`</span>....E.k............4...<span class="sb">`</span>....E.k............4...<span class="sb">`</span>....E.k............4...<span class="sb">`</span>....E.k............4...<span class="sb">`</span>....E.k............4...<span class="sb">`</span>....E.k............4...<span class="sb">`</span>....E.k............4...<span class="sb">`</span>....E.k............4...<span class="sb">`</span>....E.k............4...<span class="sb">`</span>....E.k.... .......<span class="o">(</span>...<span class="sb">`</span>....E.k.... .......<span class="o">)</span>...<span class="sb">`</span>....E.k.... .......<span class="k">*</span>...<span class="sb">`</span>....E.k.... .......+...<span class="sb">`</span>....E.k.... .......,...<span class="sb">`</span>....E.k.... .......-...<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... ......./...<span class="sb">`</span>....E.k.... .......0...<span class="sb">`</span>....E.k.... .......1...<span class="sb">`</span>....E.k.... .......2...<span class="sb">`</span>....E.k.... .......3...<span class="sb">`</span>....E.k.... .......<span class="o">)</span>...<span class="sb">`</span>....E.k.... .......<span class="k">*</span>...<span class="sb">`</span>....E.k.... .......+...<span class="sb">`</span>....E.k.... .......,...<span class="sb">`</span>....E.k.... .......-...<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... ......./...<span class="sb">`</span>....E.k.... .......0...<span class="sb">`</span>....E.k.... .......1...<span class="sb">`</span>....E.k.... .......2...<span class="sb">`</span>....E.k.... .......3...<span class="sb">`</span>....E.k.... .......<span class="k">*</span>...<span class="sb">`</span>....E.k.... .......+...<span class="sb">`</span>....E.k.... .......,...<span class="sb">`</span>....E.k.... .......-...<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... ......./...<span class="sb">`</span>....E.k.... .......0...<span class="sb">`</span>....E.k.... .......1...<span class="sb">`</span>....E.k.... .......2...<span class="sb">`</span>....E.k.... .......3...<span class="sb">`</span>....E.k.... .......4...<span class="sb">`</span>....E.k.... .......5...<span class="sb">`</span>....E.k.... .......5...<span class="sb">`</span>....E.k.... .......5...<span class="sb">`</span>....E.k.... .......6...<span class="sb">`</span>....E.k.... .......5...<span class="sb">`</span>....E.k.... .......6...<span class="sb">`</span>....E.k.... .......5...<span class="sb">`</span>....E.k.... .......6...<span class="sb">`</span>....E.k.... .......7...<span class="sb">`</span>....E.k.... .......5...<span class="sb">`</span>....E.k.... .......6...<span class="sb">`</span>....E.k.... .......7...<span class="sb">`</span>....E.k.... .......8...<span class="sb">`</span>....E.k.... .......N...<span class="sb">`</span>....E.k.... .......I...<span class="sb">`</span>....E.k.... .......J...<span class="sb">`</span>....E.k.... .......K...<span class="sb">`</span>....E.k.... .......L...<span class="sb">`</span>....E.k.... .......M...<span class="sb">`</span>....E.k.... .......N...<span class="sb">`</span>....E.k.... .......O...<span class="sb">`</span>....E.k.... .......J...<span class="sb">`</span>....E.k.... .......K...<span class="sb">`</span>....E.k.... .......L...<span class="sb">`</span>....E.k.... .......M...<span class="sb">`</span>....E.k.... .......N...<span class="sb">`</span>....E.k.... .......O...<span class="sb">`</span>....E.k.... .......J...<span class="sb">`</span>....E.k.... .......K...<span class="sb">`</span>....E.k.... .......L...<span class="sb">`</span>....E.k.... .......M...<span class="sb">`</span>....E.k.... .......N...<span class="sb">`</span>....E.k.... .......O...<span class="sb">`</span>....E.k.... .......P...<span class="sb">`</span>....E.k.... .......Q...<span class="sb">`</span>....E.k.... .......Q...<span class="sb">`</span>....E.k.... .......R...<span class="sb">`</span>....E.k.... .......Q...<span class="sb">`</span>....E.k.... .......R...<span class="sb">`</span>....E.k.... .......S...<span class="sb">`</span>....E.k.... .......S...<span class="sb">`</span>....E.k.... .......T...<span class="sb">`</span>....E.k.... .......T...<span class="sb">`</span>....E.k.... .......U...<span class="sb">`</span>....E.k.... .......U...<span class="sb">`</span>....E.k.... .......U...<span class="sb">`</span>....E.k.... .......V...<span class="sb">`</span>....E.k.... .......U...<span class="sb">`</span>....E.k.... .......V...<span class="sb">`</span>....E.k.... .......W...<span class="sb">`</span>....E.k.... .......W...<span class="sb">`</span>....E.k.... .......W...<span class="sb">`</span>....E.k.... .......em..<span class="sb">`</span>...<span class="o">}</span>E.k............4...<span class="sb">`</span>...<span class="o">}</span>E.k............4...<span class="sb">`</span>...<span class="o">}</span>E.k............4...<span class="sb">`</span>...~E.k.... ...........<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>...~E.k.... ...........<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... ...........<span class="sb">`</span>....E.k.... .......	...<span class="sb">`</span>....E.k.... .......

As the file is to small <span class="k">for </span>including a firmware stream and examining this repeatedly structure something has to went wrong on capturing the firmware upgrade.


<span class="c">### 3.3.3 Remote Website for accessing IPCam via Internet</span>

Applying more filter to see communication between Laptop and the remote feature on videoipcamera.cn/view. Requires Internet Explorer to use it. There is a lot of traffic with three participants, so I have to use multiple rules and append only the file with the already filtered packets:
<span class="o">[</span>Communication AP Laptop prefiltered]<span class="o">(</span>https://github.com/herrfeder/Offensive_IOT_Exploitation/blob/master/gist_files/access_point_cap_laptop_10.0.1.36_website_101.1.17.22_filtered.cap<span class="o">)</span>
<span class="sb">```</span>bash
not ip.addr <span class="o">==</span> 172.217.22.99 <span class="o">&amp;&amp;</span> not ip.addr <span class="o">==</span> 216.58.205.234 <span class="o">&amp;&amp;</span> ip.addr <span class="o">==</span> 101.1.17.22 <span class="o">&amp;&amp;</span> ip.addr <span class="o">==</span> 10.0.1.36 <span class="o">&amp;&amp;</span> http.request
</code></pre></div></div> <p>This will reveal a lot of GET requests to videoipcamera.cn and a binary setup.exe on http://videoipcamera.cn/view/setup.exe. This is necessary to use the cam-client on a PC. By the way, installing and starting it on Windows 10 and Windows 7 Internet Explorer will kill Internet Explorer.</p> <div class="image-container"> <div class="image-wrapper-double"> <a href="http://i.imgur.com/UqKd2is.png" title="Login for the web app" target="_blank"> <img class="image1" src="http://i.imgur.com/UqKd2is.png" alt="Login for the web app" /> </a> <p class="image-caption">Login for the web app</p> </div> <div class="image-wrapper-double"> <a href="http://i.imgur.com/BC6Aclr.png" title="Internet Explorer crashes on login attempt" target="_blank"> <img class="image2" src="http://i.imgur.com/BC6Aclr.png" alt="Internet Explorer crashes on login attempt" /> </a> <p class="image-caption">Internet Explorer crashes on login attempt</p> </div> </div> <p>It will install some files into the directory C:Programme/Viewer_IPCam(SDL2.dll,Viewer.ocx). SDL2.dll won’t reveal anything interesting with a short look in IDA Disassembler:</p> <p><img src="http://i.imgur.com/bpIRtZs.png" alt="Image" /></p> <p>Viewer.ocx has some interesting strings in it that will reveal some new type of requests to the server:</p> <p><img src="http://i.imgur.com/Ch1FEOt.png" alt="Image" /></p> <p>Put that into a list with the new info:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Viewer  1   327681  -1  39  /   
http:// DomainList  500 404 29  23  &amp;Language=  &amp;AppName=   &amp;AppOS= &amp;AppOS  &amp;AppVersion=    &amp;AppVersion 
Users/LoginCheck.ashx   &amp;DomainList=    &amp;Pwd=   VersionFlag=1&amp;User= 
Users/Logout.ashx   &amp;SessionID= UserID= 
Users/AddFriend.ashx    &amp;MonitorPwd=    &amp;RemarkName=    &amp;Groupname= &amp;FriendID=  
Users/DeleteFriend.ashx &amp;DelFromHisList=0   Users/GetFriendList.ashx    &amp;Type=  
Users/PhoneCheckCode.ashx   &amp;PhoneNO=   CountryCode=    
Users/RegisterCheck.ashx    &amp;IgnoreSafeWarning= &amp;VerifyCode=    &amp;CountryCode=   &amp;Email= &amp;RePwd= VersionFlag=1&amp;Pwd=  
Users/modifyFriendRemarkName.ashx   &amp;OldRemarkName= &amp;NewRemarkName= 
Users/ModifyMonitorPwd.ashx {"error_code":"100100","error":"ÕÒ²»µ½¿ÉÓÃ·þÎñÆ÷"}  {"error_code":"100101","error":"·¢ËÍÇëÇóÊ§°Ü"}  ðíHTTP    
  Host:   Content-Length: %ld
   User-Agent: Neeao/4.0
 Accept-Encoding: gzip, default
    Accept-Language: en-us
    Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, application/vnd.ms-excel, application/msword, application/vnd.ms-powerpoint, */*
  HTTP/1.0
 POST    GET     Content-Type: application/x-www-form-urlencoded
</code></pre></div></div> <p>This will reveal some common HTTP requests and the related attributes that has to be sent with the request. I tried several ones with random filling of the known attributes which only resulted in errors.</p> <h4 id="334-direct-communication-between-ipcam-and-servers">3.3.4 Direct Communication between IPCam and servers</h4> <p>Using this rule we can filter only the direct communication of the IPCam:</p> <p><a href="https://github.com/herrfeder/Offensive_IOT_Exploitation/blob/master/gist_files/ipcam_10.0.1.25.cap">IPCam Communication to Server</a></p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ip.addr == 10.0.1.25
</code></pre></div></div> <p>It’s obvious, that the exchanged payloads are encrypted somehow as I’m not able to read it’s content directly or base64 etc. I guess the encrypting for these UDP messages will happen for the IPCam in the npc binary too. It has to be some static encryption as many bit chunks will repeat often.</p> <h3 id="335-collecting-information">3.3.5 Collecting Information</h3> <p>I collected a list of participating servers with IP and often used requests:</p> <div align="right"> <table border="0"> <tr> <td>videoipcamera.com</td> <td>218.30.35.92</td> <td>POST /Users/GetFriendList.ashx</td> <td>POST /Users/AddFriend.ashx</td> </tr> <tr> <td>videoipcamera.cn</td> <td>101.1.17.22</td> <td>POST /Users/GetFriendList.ashx</td> <td>POST /Users/AddFriend.ashx</td> </tr> <tr> <td>upg1.videoipcamera.cn</td> <td>218.30.35.92</td> <td>GET /00/06/latestversion.asp</td> </tr> <tr> <td>p2p1.videoipcamera.cn</td> <td>146.0.238.42</td> </tr> <tr> <td>api1.videoipcamera.cn</td> <td>101.1.17.22</td> <td>POST /Users/LoginCheck.ashx</td> </tr> <tr> <td>api2.videoipcamera.cn</td> <td>218.30.35.92</td> <td>POST /Users/LoginCheck.ashx</td> </tr> <tr> <td>p2p2.videoipcamera.com</td> <td>218.30.35.92</td> </tr> <tr> <td>api3.videoipcamera.cn</td> <td>101.1.17.22</td> <td>POST /Users/LoginCheck.ashx</td> </tr> <tr> <td>p2p6.videoipcamera.com</td> <td>101.1.17.22</td> </tr> <tr> <td>api4.videoipcamera.com</td> <td>146.0.238.42</td> <td>POST /Users/LoginCheck.ashx</td> <td>UDP Port 8000</td> <td>UDP Port 51880</td> </tr> <tr> <td>p2p3.videoipcamera.com</td> <td>146.0.238.42</td> </tr> <tr> <td>p2p4.videoipcamera.com</td> <td>146.0.238.42</td> </tr> <tr> <td></td> <td>92.42.106.94</td> <td>UDP Port 4000</td> <td>UDP Port 4001</td> </tr> <tr> <td>p2p5.videoipcamera.com</td> <td>103.41.127.199</td> <td>UDP Port 51880</td> <td>UDP Port 51881</td> </tr> <tr> <td>104-250-152-26.static.gorillaservers.com</td> <td>104.250.152.26</td> <td>UDP Port 8000</td> <td>UDP Port 8001</td> <td></td> </tr> </table> </div> <p>There are some other servers participated talking directly to the IPCam and the Phone over UDP. We can identify some often used UDP Ports on our devices:</p> <ul> <li>Phone =&gt; IPCam UDP to 51880</li> <li>IPCam =&gt; Phone UDP to 5188{0,1,2} Please be cautious, when intended to scan unkown web servers. Your actions could be understand as an attack. ```bash $ nmap -sU -p8000 api4.videoipcamera.com</li> </ul> <p>PORT STATE SERVICE 8000/udp open|filtered irdmi # Intel Remote Desktop Management Interface</p> <p>$ nmap -sU -p4000 92.42.106.94</p> <p>PORT STATE SERVICE 4000/udp open|filtered icq # conferencing protocol</p> <p>$ nmap -sU -p4001 92.42.106.94</p> <p>PORT STATE SERVICE 4001/udp open|filtered newoak</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>I guess this UDP ports are used to control the IPCam and the app remotely.

```bash
$ nmap 92.42.106.94                                                   

PORT     STATE  SERVICE
3389/tcp open   ms-wbt-server
5060/tcp closed sip
5061/tcp closed sip-tls


$ nmap 103.41.127.199

PORT      STATE    SERVICE
80/tcp    open     http
135/tcp   filtered msrpc
139/tcp   filtered netbios-ssn
445/tcp   filtered microsoft-ds
593/tcp   filtered http-rpc-epmap
1025/tcp  filtered NFS-or-IIS
3389/tcp  open     ms-wbt-server
6129/tcp  filtered unknown
49152/tcp open     unknown
49153/tcp open     unknown
49154/tcp open     unknown
49155/tcp open     unknown
49156/tcp open     unknown
49157/tcp open     unknown
49165/tcp open     unknown


$ host 104.250.152.26
26.152.250.104.in-addr.arpa domain name pointer 104-250-152-26.static.gorillaservers.com.

$ nmap 104.250.152.26

PORT      STATE    SERVICE
80/tcp    open     http
135/tcp   filtered msrpc
139/tcp   filtered netbios-ssn
445/tcp   filtered microsoft-ds
593/tcp   filtered http-rpc-epmap
1025/tcp  filtered NFS-or-IIS
6129/tcp  filtered unknown
8080/tcp  open     http-proxy
9090/tcp  open     zeus-admin
33899/tcp open     unknown
49152/tcp open     unknown
49153/tcp open     unknown
49154/tcp open     unknown
49155/tcp open     unknown
49158/tcp open     unknown
49159/tcp open     unknown
</code></pre></div></div> <p>Using GeoLocation services the server 104.250.152.26 is the only one that isn’t hosted in China. Regarding the similiar port fingerprint and exchanging similiar UDP messages with mobile phone and IPCam I can determine that this server is involved in the infrastructure. We can see multiple server with interesting port fingerprint and interesting UDP ports, too. Without strong assumption of vulnerabilities, I won’t start to attack any server. Collecting some encrypted Info bits, that may will help me on reversing App and firmware:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Passwort: &lt;secret&gt; <span class="o">=&gt;</span> 891A54C4E2EAB52D01C6FBF85A4C143E  <span class="c"># hashing for passwort</span>
UserID: 0732910 <span class="o">=&gt;</span> <span class="nt">-2146750738</span>   <span class="c"># conversion for UserID</span>

Encrypted UDP: 10.0.0.21 <span class="o">(</span>IPCam<span class="o">)</span> -&gt; 10.0.0.27 <span class="o">(</span>Smartphone<span class="o">)</span>
00:00:00:02:00:00:00:01:00:00:00:50:00:00:00:01:00:09:41:38:00:00:00:07:00:00:00:01:0e:00:00:0f:00:30:61:72:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:2f:00:00:00:00:00:00:00:00

Encrypted UDP: 10.0.0.27 <span class="o">(</span>Smartphone<span class="o">)</span> -&gt; 146.0.238.42
0c:05:03:00:ee:b6:b9:67:ee:2e:0b:80:3c:88:2a:1d:4e:25:36:4f:9a:44:28:8e:00:00:00:00:e4:74:85:3b

Encrypted UDP: 146.0.238.42 -&gt; 10.0.0.27 <span class="o">(</span>Smartphone<span class="o">)</span>
0d:01:00:00:9a:44:28:8e:b1:e8:c6:af:09:00:00:00:5c:2a:6a:5e:0f:a0:01:01:92:00:ee:2a:ca:a8:01:01:68:fa:98:1a:1f:40:01:01:67:29:7f:c7:ca:a8:01:01:dc:e7:8e:89:22:53:03:01:da:1e:23:5c:22:53:03:01:92:00:ee:2a:22:53:03:01:da:1e:23:5c:2b:5c:04:01:92:00:ee:2a:2b:5c:04:01
</code></pre></div></div> <p>This UDP packet payloads are exchanged between smartphone and multiple servers (146.0.238.42,103.41.127.199,104.250.152.26):</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0103caa80a00011eee2e0b80b486ca4d073e19397593056b8675f8030001000051000000
0103caa80a00011eee2e0b8024ac620c080cc0b07aa1dce26f79f8030001000051000000
0203caa800000000ee2e0b80b486ca4d073e19397593056b8675f80300010000010000000000000000000000
0203caa800000000ee2e0b8024ac620c080cc0b07aa1dce26f79f80300010000010000000000000000000000
0103caa80a00011eee2e0b806285763d44675edb36ca4289587df8030001000051000000
0103caa80a00011eee2e0b80422226691c0471f66ea96da44381f8030001000051000000
0203caa800000000ee2e0b806285763d44675edb36ca4289587df80300010000010000000000000000000000
0103caa80a00011eee2e0b802792d54f60749ffd12d983af2d85f8030001000051000000
0203caa800000000ee2e0b80422226691c0471f66ea96da44381f80300010000010000000000000000000000
0203caa800000000ee2e0b802792d54f60749ffd12d983af2d85f80300010000010000000000000000000000

</code></pre></div></div> <p>This partly cleartext packages was exchanged between IPCam and phone when trying to subscribe an email for an alarm notification: <a href="https://github.com/herrfeder/Offensive_IOT_Exploitation/blob/master/gist_files/email_subscribe.cap">Email Subscribing for Alarm</a></p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.......p...........8...
....iZo8...Ej.q.iZo(H..........0........N............[o....IC.q..[oPPvop.Po[... ...........433.../..............GVo8.[o............
.....C...U.8.[o..C..........W.sa....6..........`...|E.k........hildagard@temp-mail.de..............................................smtp.gmail.com,173.194.193.108,173.194.67.108...................anabelle@shitmail.de............................................2v..i....i0e....`iZo....`...=8O.^....F..0.......p...........8...Attention: alarm...............................................qDear User,
 Please check the attached picture for more information.................................sa...|E.k........
</code></pre></div></div> <p>It needs more research and examination to get the “bigger picture” of this server infrastructure. But most important for this part, getting information about encryption and key management.</p> <h2 id="4-reversing">4. Reversing</h2> <p>There are multiple binaries contributed to the whole application that are worth to be examined. We have to look at the android application and the extracted firmware. Moreover there are single binaries in the firmware beeing suspected to store interesting information that have to be examined. I will go through this process by using different tools to get deeper into the application logic.</p> <h3 id="41-jadx">4.1 JADX</h3> <p>JADX is a decompiler for java executables that will also process apk. You can simply execute the binary of jadx by appending your desired apk.</p> <p>On executing JADX I recognized this:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Exception <span class="k">in </span>thread java.lang.OutOfMemoryError: Java heap space
</code></pre></div></div> <p>As I work in a VM with low RAM JADX overflows my virtual machine heap. By changing the environment variable we can maximize the memory space and using only one thread it will work better.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ JAVA_OPTS</span><span class="o">=</span><span class="s2">"-Xmx1300M"</span> ../tools/jadx/bin/jadx <span class="nt">-j</span> 1 Sricam_17.7.17_apk-dl.com.apk 
</code></pre></div></div> <p>But there are a lot of errors on execution of JADX. Although I started in examining the decompiled files. At first glance I will search for JNI (Java Native Interfaces) that could reveal linkings to the library files:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ~/doku/Sricam_17.7.17_apk-dl.com</span>
<span class="nv">$ </span><span class="nb">grep</span> <span class="nt">-rli</span> jni <span class="nb">.</span>
./com/mediatek/elian/ElianNative.java
./com/baidu/android/pushservice/g.java
./com/baidu/android/pushservice/message/g.java
./com/baidu/android/pushservice/c/e.java
./com/baidu/android/pushservice/c/j.java
./com/baidu/android/pushservice/c/b.java
./com/baidu/android/pushservice/util/c.java
./com/baidu/android/pushservice/util/s.java
./com/baidu/android/pushservice/j/d.java
./com/baidu/android/pushservice/jni/PushSocket.java
./com/baidu/android/pushservice/jni/BaiduAppSSOJni.java
./com/baidu/android/pushservice/g/d.java
./com/baidu/android/pushservice/f.java
./com/baidu/android/pushservice/config/b.java
./com/xapcamera/SetWifiActivity3.java
./com/tencent/connect/auth/AuthDialog.java
./com/tencent/stat/StatNativeCrashReport.java
./com/tencent/open/web/security/SecureJsInterface.java
./com/tencent/open/web/security/JniInterface.java
./ilnk/lib/IlnkApi.java
</code></pre></div></div> <p>We can see on first position ElianNative.java the load of libraries for the wifi chip.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">LoadLib</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">loadLibrary</span><span class="o">(</span><span class="s">"elianjni"</span><span class="o">);</span>
</code></pre></div></div> <p>We will look into the paired library file in the unzipping part of the APK. Searching for other interesting strings:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ~/doku/Sricam_17.7.17_apk-dl.com</span>
<span class="nv">$ </span><span class="nb">grep</span> <span class="nt">-rli</span> aes <span class="nb">.</span>
./cn/jiguang/api/BasePreferenceManager.java
./cn/jiguang/api/JCoreInterface.java
./com/sina/weibo/sdk/cmd/WbAppActivator.java
./com/sina/weibo/sdk/utils/AesEncrypt.java
./com/baidu/android/pushservice/message/g.java
./com/baidu/android/pushservice/config/b.java
...
./com/baidu/android/pushservice/c/b.java

<span class="c"># ~/doku/Sricam_17.7.17_apk-dl.com/cn/jiguang</span>
<span class="nv">$ </span><span class="nb">grep</span> <span class="nt">-rli</span> encrypt <span class="nb">.</span>
./res/layout/activity_modify_npc_bound_email.xml
./res/layout-v11/activity_modify_npc_bound_email.xml
./cn/jiguang/api/BasePreferenceManager.java
./cn/jiguang/c/a/a.java
./cn/jiguang/a/a/b/h.java
./com/google/zxing/client/result/WifiParsedResult.java
./com/xapcamera/entity/Email.java
./com/xapcamera/p2p/SettingListener.java
./com/xapcamera/device/settings/AlarmSetActivity.java
./com/xapcamera/device/settings/ModifyBoundEmailActivity.java
./com/xapcamera/R.java
./com/p2p/core/MediaPlayer.java
./com/p2p/core/P2PHandler.java
./com/p2p/core/utils/DES.java
...
./com/tencent/open/utils/SystemUtils.java
</code></pre></div></div> <p>BasePreferenceManager.java seems to be interesting. Looking into the sourcecode reveals nothing good:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public abstract class BasePreferenceManager {
    private static final String AES_ENCRYPTION_SEED;
    private static final String JPUSH_PREF;
    private static SharedPreferences mSharedPreferences;
    private static final String[] z;
    /* JADX: method processing error */
    /*
        Error: java.lang.StackOverflowError
	...

</code></pre></div></div> <p>Checking this with multiple other decompilers lead to the same result. (See in Bytecode Viewer) This file as many others have shortly after beginning some decompiler errors. Some sort of decompiling protection, I guess. I don’t know enough about Android Reversing, so I can’t interprete this the right way at the moment and research doesn’t bring fruity results about this.</p> <p>Another interesting file points to a default user on a p2p server:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ vim lnkConstant.java

    public static final String P2P_PARAM_DEFAULT_DEVICE_ID = "XXX-000000-XXXXX";
    public static final String P2P_PARAM_DEFAULT_DEVICE_NAME = "Node161205";
    public static final String P2P_PARAM_DEFAULT_PWD = "admin";
    public static final String P2P_PARAM_DEFAULT_SERVER = "EKPNHXIDAUAOEHLOTBSQEJSWPAARTAPKLXPGENLKLUPLHUATSVEESTPFHWIHPDIEHYAOLVEISQLNEGLPPALQHXERELIALKEHEOHZHUEKIFEEEPEJ-$$";
</code></pre></div></div> <p>I suspected a encrypted domain name in the default_server but I wasn’t able to decrypt it.</p> <p>It’s possible to checkout the upgrade mechanism for the apk on the upg1 server. But redo all requests from a desktop browser by simply appending the clear strings like “/latestversion.asp” results in 404.</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ vim ./com/p2p/core/update/UpdateManager.java
...
private static final String UPDATE_URL = "http://upg1.videoipcamera.cn/";
...

public boolean checkUpdate() {
...
StringBuilder(UPDATE_URL).append(version_parse[0]).append(HttpUtils.PATHS_SEPARATOR).append(version_parse[1]).append("/latestversion.asp").toString();
...

public String getUpdateDescription() {
		...
            HttpURLConnection connection = (HttpURLConnection) new URL(new StringBuilder(UPDATE_URL).append(version_parse[0]).append(HttpUtils.PATHS_SEPARATOR).append(version_parse[1]).append("/des_html.asp").toString()).openConnection();
         
       		....

public void downloadApk(Handler handler, String filePath, String fileName) {
     		...
                HttpURLConnection connection = (HttpURLConnection) new URL("http://upg1.videoipcamera.cn//" + version_parse[0] + HttpUtils.PATHS_SEPARATOR + version_parse[1] + HttpUtils.PATHS_SEPARATOR + this.version_server.trim() + ".apk").openConnection();
 ...
</code></pre></div></div> <p>Another interesting file bit is in WXLoginRequest. It reveals another post request “Users/ThirdLogin.ashx” with ID and Token to http://api1.cloudlinks.cn/Users/ThirdLogin.ashx. Overall it reveals the origin of the smartphone app: https://www.yooseecamera.com/</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vim ./com/xapcamera/network/WXLoginRequest.java

params.add<span class="o">(</span>new BasicNameValuePair<span class="o">(</span><span class="s2">"AppID"</span>, <span class="s2">"d591b466644a0420e5f29aefb0cf0088"</span><span class="o">))</span><span class="p">;</span>
        params.add<span class="o">(</span>new BasicNameValuePair<span class="o">(</span><span class="s2">"AppToken"</span>, <span class="s2">"2db6962ff0901b8ce771f20f14a651a2786086e55615f951aa0c7c9b33fc5340"</span><span class="o">))</span><span class="p">;</span>
        params.add<span class="o">(</span>new BasicNameValuePair<span class="o">(</span><span class="s2">"Language"</span>, App.application.getResources<span class="o">()</span>.getConfiguration<span class="o">()</span>.locale.getLanguage<span class="o">()))</span><span class="p">;</span>
        params.add<span class="o">(</span>new BasicNameValuePair<span class="o">(</span><span class="s2">"AppOS"</span>, Constants.VIA_TO_TYPE_QQ_DISCUSS_GROUP<span class="o">))</span><span class="p">;</span>
        params.add<span class="o">(</span>new BasicNameValuePair<span class="o">(</span><span class="s2">"AppName"</span>, <span class="s2">"com.yoosee"</span><span class="o">))</span><span class="p">;</span>
        String[] parseVerson <span class="o">=</span> new String[]<span class="o">{</span><span class="s2">"00"</span>, <span class="s2">"46"</span>, <span class="s2">"00"</span>, Constants.VIA_REPORT_TYPE_WPA_STATE<span class="o">}</span><span class="p">;</span>
        int c <span class="o">=</span> Integer.parseInt<span class="o">(</span>parseVerson[2]<span class="o">)</span> <span class="o">&lt;&lt;</span> <span class="no">8</span><span class="sh">;
        params.add(new BasicNameValuePair("AppVersion", String.valueOf((((Integer.parseInt(parseVerson[0]) &lt;&lt; 24) | (Integer.parseInt(parseVerson[1]) &lt;&lt; 16)) | c) | Integer.parseInt(parseVerson[3]))));
        params.add(new BasicNameValuePair("PackageName", "com.yoosee"));
        params.add(new BasicNameValuePair("ApiVersion", Constants.VIA_TO_TYPE_QQ_GROUP));
        return doPost(params, "Users/ThirdLogin.ashx");
</span></code></pre></div></div> <p>cloudlinks.cn redirects to gwelltimes.cc which seems to provide a SDK for creating P2P enabled devices like our IPCam. This Post Request looks like the login for the cloud API to initialize a P2P session. I tried to do the same with curl with the help of https://github.com/dxsdyhm/GwellDemo and http://doc.cloud-links.net/SDK/iOS/GWP2P/GWP2PDeveloperGuide.html#10101 but I got everytime the same result:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl http://api1.cloudlinks.cn/Users/ThirdLogin.ashx  <span class="nt">-H</span> <span class="s2">"User-Agent: Mozilla/5.0 (Linux; U; Android 2.2.1; en-us; Nexus One Build/FRG83)"</span> <span class="nt">-d</span> <span class="nv">AppID</span><span class="o">=</span>d591b466644a0420e5f29aefb0cf0088 <span class="nt">-d</span> <span class="nv">AppToken</span><span class="o">=</span>2db6962ff0901b8ce771f20f14a651a2786086e55615f951aa0c7c9b33fc5340 <span class="nt">-d</span> <span class="nv">AppOS</span><span class="o">=</span>Android <span class="nt">-d</span> <span class="nv">AppName</span><span class="o">=</span>com.yoosee <span class="nt">-d</span> <span class="nv">Language</span><span class="o">=</span>eng <span class="nt">-d</span> <span class="nv">PackageName</span><span class="o">=</span>com.yoosee <span class="nt">-d</span> <span class="nv">AppVersion</span><span class="o">=</span>00.23.00.03 <span class="nt">-d</span> <span class="nv">ApiVersion</span><span class="o">=</span>0.1 

<span class="o">{</span><span class="s2">"error_code"</span>:<span class="s2">"14"</span>,<span class="s2">"error"</span>:<span class="s2">"参数错误"</span><span class="o">}</span>
</code></pre></div></div> <h3 id="42-apktool">4.2 APKTOOL</h3> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>oit@ubuntu&gt; ~/tools/apktool
<span class="nv">$ </span>./apktool <span class="nt">-d</span> Sricam_17.7.17_apk-dl.com.apk 
</code></pre></div></div> <p>APKTool will generate smali files from the APK. Smali is a readable format of the dalvik executable dex file. As JADX isn’t capable of disassembling all files it could be worthwile to look at the smali files. It looks like kind of assembler code. Looking into the smali file of BasePreferenceManager.smali we recognize some constant strings:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.method static constructor &lt;clinit&gt;<span class="o">()</span>V
    .locals 14
    const/16 v9, 0x35
    const/16 v10, 0x11
    const/4 v8, 0x4
    const/4 v12, 0x1
    const/4 v1, 0x0
    const-string v2, <span class="s2">"W#F</span><span class="se">\u</span><span class="s2">0013titY</span><span class="se">\u</span><span class="s2">0008p</span><span class="sb">`</span><span class="se">\u</span>0016<span class="se">\\\u</span>0005ce<span class="o">(</span>L]+n9Z<span class="se">\u</span>0015t5k<span class="se">\u</span>0004<span class="s2">"
</span></code></pre></div></div> <p>But they have no typical length for a IV or a AES key. The strings.xml file could be very useful, as it includes nearly all constant strings, that are used in the Java apk. But doesn’t reveal anything new.</p> <h3 id="43-unzip-the-apk">4.3 Unzip the APK</h3> <p>Simply unzipping the apk will unpack it’s resources for Linking and Compiling and reveals DEX binary and the native ARM libraries. We can use the compiled dalvic executable dex file to convert it to a smali. We can use the dex file to repack it to a jar file. The Bytecode Viewer will do exactly this. For now I will simply examining the shared objects files for interesting functions by using information from previous findings. I will use radare2 to examining the binaries:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>r2 libelianjni.so 
<span class="o">[</span>0x00004b90]&gt; afl
...
0x000059a8   12 290          sym.RT_AES_KeyExpansion
0x00005ad8   43 604          sym.RT_AES_Encrypt
0x00005d4c   42 540          sym.RT_AES_Decrypt
0x00005f80   12 230          sym.RT_HMAC_SHA1
0x0000606c    1 42           sym.RT_SHA1_Init
0x0000609c   15 412          sym.RT_SHA1_Hash
0x00006248    6 96           sym.RT_SHA1_Append
0x000062a8    5 174          sym.RT_SHA1_End
0x00006358    3 72           sym.RT_SHA1
...
</code></pre></div></div> <p>Going deeper into this lib file:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[0x0000597c]&gt; s sym.elianStart
sym.createV1Packet
sym.createV2Packet
sym.RT_AES_Encrypt
</code></pre></div></div> <p>Examining these functions are strongly related to using or generating AES related keys or Initialization Vectors but I wasn’t able of extracting them.</p> <h3 id="44-bytecode-viewer">4.4 Bytecode Viewer</h3> <p>Bytecode Viewer runs into the same errors as JADX and won’t give new information:</p> <div class="image-container"> <div class="image-wrapper-single"> <a href="http://i.imgur.com/xXLwCwn.png" title="Bytecode Viewer" target="_blank"> <img class="image" src="http://i.imgur.com/xXLwCwn.png" alt="Bytecode Viewer" /> </a> <p class="image-caption">Bytecode Viewer</p> </div> </div> <p>Bytecode Viewer combines multiple different Java decompilers. In the screenshot we can see the output of “JD-Gui”. This is the “Java Decompiler”. This will only work on native .jar files.After unzipping the apk we can find next to the library files a .dex file. We can convert with “dex2jar” the .dex file to a native Java application. Bytecode Viewer uses this mechanism but is running into the same errors.</p> <h2 id="overall-security-issues-for-now">Overall Security Issues (for now)</h2> <ul> <li>overall HTTP connections</li> <li>probably vulnerable gSoap service</li> </ul> <h2 id="conclusion">Conclusion</h2> <p>It was a lot of fun to examine this piece of hardware for vulnerabilties and it’s secrets. I guess, I found a lot interesting stuff but I leave with many possible courses of action that could lead into a serious exploit. This is due to lack of knowledge because it’s my first project to start into embedded security. I will doing research into Android Applications and ARM-Architecture to continue the examination in Part 2. If someone reads this blog and could give hints about going further I would be very grateful.</p> </div> </div> </div> <div class="mdui-col-md-3 mdui-hidden-sm-down"> <style> #k-toc-card{ background-color: transparent; width: 500px; list-style: none; padding: 0; } #k-toc-card ul{ list-style: none; padding: 0px; } .pin-top { margin-top: 100px; } .pinned { position: fixed; } #k-toc-card li{ max-width: 500px; min-width: 200px; } #k-toc-card a{ text-align: left; color: #2f4f4f; display: block; width: 100%; text-decoration: none; position: relative; min-width: 88px; height: 25px; box-sizing: border-box; padding: 0 16px; margin: 0; overflow: hidden; //font-size: 15px; font-weight: 500; line-height: 36px; text-transform: uppercase; letter-spacing: .04em; white-space: nowrap; vertical-align: middle; -ms-touch-action: manipulation; touch-action: manipulation; zoom: 1; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; background: transparent; border: none; border-radius: 2px; outline: none; transition: all .2s cubic-bezier(.4, 0, .2, 1), box-shadow .2s cubic-bezier(.4, 0, 1, 1); will-change: box-shadow; -webkit-user-drag: none; } #k-toc-card a:hover { background-color: rgba(0, 0, 0, .1); } #toc ul .toc-active { border-left: 3px solid #448aff; background-color: rgba(0, 0, 0, .2); } #k-toc-card .toc-h2 { font-size: 15px; } #k-toc-card .toc-h3 { font-size: 10px; text-indent: 6px; } </style> <div id="k-toc-card" class="mdui-card mdui-shadow-0"> <div id="toc"></div> </div> <script> Materialize={};Materialize.guid=(function(){function s4(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return function(){return s4()+s4()+"-"+s4()+"-"+s4()+"-"+s4()+"-"+s4()+s4()+s4()}})();(function($){$.fn.pushpin=function(options){var defaults={top:0,bottom:Infinity,offset:0};if(options==="remove"){this.each(function(){if(id=$(this).data("pushpin-id")){$(window).off("scroll."+id);$(this).removeData("pushpin-id").removeClass("pin-top pinned pin-bottom").removeAttr("style")}});return false}options=$.extend(defaults,options);$index=0;return this.each(function(){var $uniqueId=Materialize.guid(),$this=$(this),$original_offset=$(this).offset().top;function removePinClasses(object){object.removeClass("pin-top");object.removeClass("pinned");object.removeClass("pin-bottom")}function updateElements(objects,scrolled){objects.each(function(){if(options.top<=scrolled&&options.bottom>=scrolled&&!$(this).hasClass("pinned")){removePinClasses($(this));$(this).css("top",options.offset);$(this).addClass("pinned")}if(scrolled<options.top&&!$(this).hasClass("pin-top")){removePinClasses($(this));$(this).css("top",0);$(this).addClass("pin-top")}if(scrolled>options.bottom&&!$(this).hasClass("pin-bottom")){removePinClasses($(this));$(this).addClass("pin-bottom");$(this).css("top",options.bottom-$original_offset)}})}$(this).data("pushpin-id",$uniqueId);updateElements($this,$(window).scrollTop());$(window).on("scroll."+$uniqueId,function(){var $scrolled=$(window).scrollTop()+options.offset;updateElements($this,$scrolled)})})}}(jQuery)); !function(a){a.fn.smoothScroller=function(b){b=a.extend({},a.fn.smoothScroller.defaults,b);var c=a(this);return a(b.scrollEl).animate({scrollTop:c.offset().top-a(b.scrollEl).offset().top-b.offset},b.speed,b.ease,function(){var a=c.attr("id");a.length&&(history.pushState?history.pushState(null,null,"#"+a):document.location.hash=a),c.trigger("smoothScrollerComplete")}),this},a.fn.smoothScroller.defaults={speed:400,ease:"swing",scrollEl:"body,html",offset:0},a("body").on("click","[data-smoothscroller]",function(b){b.preventDefault();var c=a(this).attr("href");0===c.indexOf("#")&&a(c).smoothScroller()})}(jQuery),function(a){var b={};a.fn.toc=function(b){var c,d=this,e=a.extend({},jQuery.fn.toc.defaults,b),f=a(e.container),g=a(e.selectors,f),h=[],i=e.activeClass,j=function(b,c){if(e.smoothScrolling&&"function"==typeof e.smoothScrolling){b.preventDefault();var f=a(b.target).attr("href");e.smoothScrolling(f,e,c)}a("li",d).removeClass(i),a(b.target).parent().addClass(i)},k=function(){c&&clearTimeout(c),c=setTimeout(function(){for(var b,c=a(window).scrollTop(),f=Number.MAX_VALUE,g=0,j=0,k=h.length;k>j;j++){var l=Math.abs(h[j]-c);f>l&&(g=j,f=l)}a("li",d).removeClass(i),b=a("li:eq("+g+")",d).addClass(i),e.onHighlight(b)},50)};return e.highlightOnScroll&&(a(window).bind("scroll",k),k()),this.each(function(){var b=a(this),c=a(e.listType);g.each(function(d,f){var g=a(f);h.push(g.offset().top-e.highlightOffset);var i=e.anchorName(d,f,e.prefix);if(f.id!==i){a("<span/>").attr("id",i).insertBefore(g)}var l=a("<a/>").text(e.headerText(d,f,g)).attr("href","#"+i).bind("click",function(c){a(window).unbind("scroll",k),j(c,function(){a(window).bind("scroll",k)}),b.trigger("selected",a(this).attr("href"))}),m=a("<li/>").addClass(e.itemClass(d,f,g,e.prefix)).append(l);c.append(m)}),b.html(c)})},jQuery.fn.toc.defaults={container:"body",listType:"<ul/>",selectors:"h1,h2,h3",smoothScrolling:function(b,c,d){a(b).smoothScroller({offset:c.scrollToOffset}).on("smoothScrollerComplete",function(){d()})},scrollToOffset:0,prefix:"toc",activeClass:"toc-active",onHighlight:function(){},highlightOnScroll:!0,highlightOffset:100,anchorName:function(c,d,e){if(d.id.length)return d.id;var f=a(d).text().replace(/[^a-z0-9]/gi," ").replace(/\s+/g,"-").toLowerCase();if(b[f]){for(var g=2;b[f+g];)g++;f=f+"-"+g}return b[f]=!0,e+"-"+f},headerText:function(a,b,c){return c.text()},itemClass:function(a,b,c,d){return d+"-"+c[0].tagName.toLowerCase()}}}(jQuery); </script> <script> $('#toc').toc({ 'selectors': 'h2,h3', 'prefix': 'toc', 'highlightOffset': 64 }); var tocTop = $('.mdui-card-header').offset().top; $('#k-toc-card').pushpin({ top: tocTop, bottom: 99999, offset: 200 }); </script> </div> </div> <br> </div> <link href="//cdn.bootcss.com/prism/1.6.0/themes/prism-okaidia.min.css" rel="stylesheet"> <script> var _self="undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?self:{},Prism=function(){var e=/\blang(?:uage)?-(\w+)\b/i,t=0,n=_self.Prism={manual:_self.Prism&&_self.Prism.manual,util:{encode:function(e){return e instanceof a?new a(e.type,n.util.encode(e.content),e.alias):"Array"===n.util.type(e)?e.map(n.util.encode):e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(e){return Object.prototype.toString.call(e).match(/\[object (\w+)\]/)[1]},objId:function(e){return e.__id||Object.defineProperty(e,"__id",{value:++t}),e.__id},clone:function(e){var t=n.util.type(e);switch(t){case"Object":var a={};for(var r in e)e.hasOwnProperty(r)&&(a[r]=n.util.clone(e[r]));return a;case"Array":return e.map&&e.map(function(e){return n.util.clone(e)})}return e}},languages:{extend:function(e,t){var a=n.util.clone(n.languages[e]);for(var r in t)a[r]=t[r];return a},insertBefore:function(e,t,a,r){r=r||n.languages;var i=r[e];if(2==arguments.length){a=arguments[1];for(var l in a)a.hasOwnProperty(l)&&(i[l]=a[l]);return i}var o={};for(var s in i)if(i.hasOwnProperty(s)){if(s==t)for(var l in a)a.hasOwnProperty(l)&&(o[l]=a[l]);o[s]=i[s]}return n.languages.DFS(n.languages,function(t,n){n===r[e]&&t!=e&&(this[t]=o)}),r[e]=o},DFS:function(e,t,a,r){r=r||{};for(var i in e)e.hasOwnProperty(i)&&(t.call(e,i,e[i],a||i),"Object"!==n.util.type(e[i])||r[n.util.objId(e[i])]?"Array"!==n.util.type(e[i])||r[n.util.objId(e[i])]||(r[n.util.objId(e[i])]=!0,n.languages.DFS(e[i],t,i,r)):(r[n.util.objId(e[i])]=!0,n.languages.DFS(e[i],t,null,r)))}},plugins:{},highlightAll:function(e,t){var a={callback:t,selector:'code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'};n.hooks.run("before-highlightall",a);for(var r,i=a.elements||document.querySelectorAll(a.selector),l=0;r=i[l++];)n.highlightElement(r,e===!0,a.callback)},highlightElement:function(t,a,r){for(var i,l,o=t;o&&!e.test(o.className);)o=o.parentNode;o&&(i=(o.className.match(e)||[,""])[1].toLowerCase(),l=n.languages[i]),t.className=t.className.replace(e,"").replace(/\s+/g," ")+" language-"+i,o=t.parentNode,/pre/i.test(o.nodeName)&&(o.className=o.className.replace(e,"").replace(/\s+/g," ")+" language-"+i);var s=t.textContent,u={element:t,language:i,grammar:l,code:s};if(n.hooks.run("before-sanity-check",u),!u.code||!u.grammar)return u.code&&(n.hooks.run("before-highlight",u),u.element.textContent=u.code,n.hooks.run("after-highlight",u)),n.hooks.run("complete",u),void 0;if(n.hooks.run("before-highlight",u),a&&_self.Worker){var g=new Worker(n.filename);g.onmessage=function(e){u.highlightedCode=e.data,n.hooks.run("before-insert",u),u.element.innerHTML=u.highlightedCode,r&&r.call(u.element),n.hooks.run("after-highlight",u),n.hooks.run("complete",u)},g.postMessage(JSON.stringify({language:u.language,code:u.code,immediateClose:!0}))}else u.highlightedCode=n.highlight(u.code,u.grammar,u.language),n.hooks.run("before-insert",u),u.element.innerHTML=u.highlightedCode,r&&r.call(t),n.hooks.run("after-highlight",u),n.hooks.run("complete",u)},highlight:function(e,t,r){var i=n.tokenize(e,t);return a.stringify(n.util.encode(i),r)},matchGrammar:function(e,t,a,r,i,l,o){var s=n.Token;for(var u in a)if(a.hasOwnProperty(u)&&a[u]){if(u==o)return;var g=a[u];g="Array"===n.util.type(g)?g:[g];for(var c=0;c<g.length;++c){var h=g[c],f=h.inside,d=!!h.lookbehind,m=!!h.greedy,p=0,y=h.alias;if(m&&!h.pattern.global){var v=h.pattern.toString().match(/[imuy]*$/)[0];h.pattern=RegExp(h.pattern.source,v+"g")}h=h.pattern||h;for(var b=r,k=i;b<t.length;k+=t[b].length,++b){var w=t[b];if(t.length>e.length)return;if(!(w instanceof s)){h.lastIndex=0;var _=h.exec(w),P=1;if(!_&&m&&b!=t.length-1){if(h.lastIndex=k,_=h.exec(e),!_)break;for(var A=_.index+(d?_[1].length:0),j=_.index+_[0].length,x=b,O=k,S=t.length;S>x&&(j>O||!t[x].type&&!t[x-1].greedy);++x)O+=t[x].length,A>=O&&(++b,k=O);if(t[b]instanceof s||t[x-1].greedy)continue;P=x-b,w=e.slice(k,O),_.index-=k}if(_){d&&(p=_[1].length);var A=_.index+p,_=_[0].slice(p),j=A+_.length,N=w.slice(0,A),C=w.slice(j),E=[b,P];N&&(++b,k+=N.length,E.push(N));var L=new s(u,f?n.tokenize(_,f):_,y,_,m);if(E.push(L),C&&E.push(C),Array.prototype.splice.apply(t,E),1!=P&&n.matchGrammar(e,t,a,b,k,!0,u),l)break}else if(l)break}}}}},tokenize:function(e,t){var a=[e],r=t.rest;if(r){for(var i in r)t[i]=r[i];delete t.rest}return n.matchGrammar(e,a,t,0,0,!1),a},hooks:{all:{},add:function(e,t){var a=n.hooks.all;a[e]=a[e]||[],a[e].push(t)},run:function(e,t){var a=n.hooks.all[e];if(a&&a.length)for(var r,i=0;r=a[i++];)r(t)}}},a=n.Token=function(e,t,n,a,r){this.type=e,this.content=t,this.alias=n,this.length=0|(a||"").length,this.greedy=!!r};if(a.stringify=function(e,t,r){if("string"==typeof e)return e;if("Array"===n.util.type(e))return e.map(function(n){return a.stringify(n,t,e)}).join("");var i={type:e.type,content:a.stringify(e.content,t,r),tag:"span",classes:["token",e.type],attributes:{},language:t,parent:r};if("comment"==i.type&&(i.attributes.spellcheck="true"),e.alias){var l="Array"===n.util.type(e.alias)?e.alias:[e.alias];Array.prototype.push.apply(i.classes,l)}n.hooks.run("wrap",i);var o=Object.keys(i.attributes).map(function(e){return e+'="'+(i.attributes[e]||"").replace(/"/g,"&quot;")+'"'}).join(" ");return"<"+i.tag+' class="'+i.classes.join(" ")+'"'+(o?" "+o:"")+">"+i.content+"</"+i.tag+">"},!_self.document)return _self.addEventListener?(_self.addEventListener("message",function(e){var t=JSON.parse(e.data),a=t.language,r=t.code,i=t.immediateClose;_self.postMessage(n.highlight(r,n.languages[a],a)),i&&_self.close()},!1),_self.Prism):_self.Prism;var r=document.currentScript||[].slice.call(document.getElementsByTagName("script")).pop();return r&&(n.filename=r.src,!document.addEventListener||n.manual||r.hasAttribute("data-manual")||("loading"!==document.readyState?window.requestAnimationFrame?window.requestAnimationFrame(n.highlightAll):window.setTimeout(n.highlightAll,16):document.addEventListener("DOMContentLoaded",n.highlightAll))),_self.Prism}();"undefined"!=typeof module&&module.exports&&(module.exports=Prism),"undefined"!=typeof global&&(global.Prism=Prism); Prism.languages.markup={comment:/<!--[\s\S]*?-->/,prolog:/<\?[\s\S]+?\?>/,doctype:/<!DOCTYPE[\s\S]+?>/i,cdata:/<!\[CDATA\[[\s\S]*?]]>/i,tag:{pattern:/<\/?(?!\d)[^\s>\/=$<]+(?:\s+[^\s>\/=]+(?:=(?:("|')(?:\\\1|\\?(?!\1)[\s\S])*\1|[^\s'">=]+))?)*\s*\/?>/i,inside:{tag:{pattern:/^<\/?[^\s>\/]+/i,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"attr-value":{pattern:/=(?:('|")[\s\S]*?(\1)|[^\s>]+)/i,inside:{punctuation:/[=>"']/}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},entity:/&#?[\da-z]{1,8};/i},Prism.hooks.add("wrap",function(a){"entity"===a.type&&(a.attributes.title=a.content.replace(/&amp;/,"&"))}),Prism.languages.xml=Prism.languages.markup,Prism.languages.html=Prism.languages.markup,Prism.languages.mathml=Prism.languages.markup,Prism.languages.svg=Prism.languages.markup; Prism.languages.css={comment:/\/\*[\s\S]*?\*\//,atrule:{pattern:/@[\w-]+?.*?(;|(?=\s*\{))/i,inside:{rule:/@[\w-]+/}},url:/url\((?:(["'])(\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1|.*?)\)/i,selector:/[^\{\}\s][^\{\};]*?(?=\s*\{)/,string:{pattern:/("|')(\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},property:/(\b|\B)[\w-]+(?=\s*:)/i,important:/\B!important\b/i,"function":/[-a-z0-9]+(?=\()/i,punctuation:/[(){};:]/},Prism.languages.css.atrule.inside.rest=Prism.util.clone(Prism.languages.css),Prism.languages.markup&&(Prism.languages.insertBefore("markup","tag",{style:{pattern:/(<style[\s\S]*?>)[\s\S]*?(?=<\/style>)/i,lookbehind:!0,inside:Prism.languages.css,alias:"language-css"}}),Prism.languages.insertBefore("inside","attr-value",{"style-attr":{pattern:/\s*style=("|').*?\1/i,inside:{"attr-name":{pattern:/^\s*style/i,inside:Prism.languages.markup.tag.inside},punctuation:/^\s*=\s*['"]|['"]\s*$/,"attr-value":{pattern:/.+/i,inside:Prism.languages.css}},alias:"language-css"}},Prism.languages.markup.tag)); Prism.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\s\S]*?\*\//,lookbehind:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0}],string:{pattern:/(["'])(\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},"class-name":{pattern:/((?:\b(?:class|interface|extends|implements|trait|instanceof|new)\s+)|(?:catch\s+\())[a-z0-9_\.\\]+/i,lookbehind:!0,inside:{punctuation:/(\.|\\)/}},keyword:/\b(if|else|while|do|for|return|in|instanceof|function|new|try|throw|catch|finally|null|break|continue)\b/,"boolean":/\b(true|false)\b/,"function":/[a-z0-9_]+(?=\()/i,number:/\b-?(?:0x[\da-f]+|\d*\.?\d+(?:e[+-]?\d+)?)\b/i,operator:/--?|\+\+?|!=?=?|<=?|>=?|==?=?|&&?|\|\|?|\?|\*|\/|~|\^|%/,punctuation:/[{}[\];(),.:]/}; Prism.languages.javascript=Prism.languages.extend("clike",{keyword:/\b(as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|var|void|while|with|yield)\b/,number:/\b-?(0x[\dA-Fa-f]+|0b[01]+|0o[0-7]+|\d*\.?\d+([Ee][+-]?\d+)?|NaN|Infinity)\b/,"function":/[_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*(?=\()/i,operator:/-[-=]?|\+[+=]?|!=?=?|<<?=?|>>?>?=?|=(?:==?|>)?|&[&=]?|\|[|=]?|\*\*?=?|\/=?|~|\^=?|%=?|\?|\.{3}/}),Prism.languages.insertBefore("javascript","keyword",{regex:{pattern:/(^|[^\/])\/(?!\/)(\[.+?]|\\.|[^\/\\\r\n])+\/[gimyu]{0,5}(?=\s*($|[\r\n,.;})]))/,lookbehind:!0,greedy:!0}}),Prism.languages.insertBefore("javascript","string",{"template-string":{pattern:/`(?:\\\\|\\?[^\\])*?`/,greedy:!0,inside:{interpolation:{pattern:/\$\{[^}]+\}/,inside:{"interpolation-punctuation":{pattern:/^\$\{|\}$/,alias:"punctuation"},rest:Prism.languages.javascript}},string:/[\s\S]+/}}}),Prism.languages.markup&&Prism.languages.insertBefore("markup","tag",{script:{pattern:/(<script[\s\S]*?>)[\s\S]*?(?=<\/script>)/i,lookbehind:!0,inside:Prism.languages.javascript,alias:"language-javascript"}}),Prism.languages.js=Prism.languages.javascript; </script> <script src="//cdn.bootcss.com/prism/1.6.0/components/prism-bash.min.js"></script> <style> img[data-action="zoom"] { cursor: pointer; cursor: -webkit-zoom-in; cursor: -moz-zoom-in; } .zoom-img, .zoom-img-wrap { position: relative; z-index: 1001; -webkit-transition: all 300ms; -o-transition: all 300ms; transition: all 300ms; } img.zoom-img { cursor: pointer; cursor: -webkit-zoom-out; cursor: -moz-zoom-out; } .zoom-overlay { z-index: 1000; background: #292929; position: fixed; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none; filter: "alpha(opacity=0)"; opacity: 0; -webkit-transition: opacity 300ms; -o-transition: opacity 300ms; transition: opacity 300ms; } .zoom-overlay-open .zoom-overlay { filter: "alpha(opacity=100)"; opacity: 1; } </style> <script> $(function(){ $('.mdui-typo img').attr('data-action','zoom'); }) +function ($) { 'use strict'; function transitionEnd() { var el = document.createElement('bootstrap'); var transEndEventNames = { WebkitTransition : 'webkitTransitionEnd', MozTransition : 'transitionend', OTransition : 'oTransitionEnd otransitionend', transition : 'transitionend' }; for (var name in transEndEventNames) { if (el.style[name] !== undefined) { return { end: transEndEventNames[name] } } }; return false } $.fn.emulateTransitionEnd = function (duration) { var called = false; var $el = this; $(this).one('bsTransitionEnd', function () { called = true }); var callback = function () { if (!called) $($el).trigger($.support.transition.end) }; setTimeout(callback, duration); return this }; $(function () { $.support.transition = transitionEnd(); if (!$.support.transition) return; $.event.special.bsTransitionEnd = { bindType: $.support.transition.end, delegateType: $.support.transition.end, handle: function (e) { if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments); } } }); }(jQuery); +function ($) { "use strict"; function ZoomService () { this._activeZoom = this._initialScrollPosition = this._initialTouchPosition = this._touchMoveListener = null; this._$document = $(document); this._$window = $(window); this._$body = $(document.body); } ZoomService.prototype.listen = function () { if (!imgzoom){ this._$body.on('click', '[data-action="zoom"]', $.proxy(this._zoom, this)) } imgzoom = true; }; ZoomService.prototype._zoom = function (e) { var target = e.target; if (!target || target.tagName != 'IMG') return; if (e.metaKey) return window.open(e.target.src, '_blank'); if (target.width >= (window.innerWidth - Zoom.OFFSET)) return; this._activeZoomClose(true); this._activeZoom = new Zoom(target); this._activeZoom.zoomImage(); this._$window.on('scroll.zoom', $.proxy(this._scrollHandler, this)); this._$document.on('click.zoom', $.proxy(this._clickHandler, this)); this._$document.on('keyup.zoom', $.proxy(this._keyHandler, this)); this._$document.on('touchstart.zoom', $.proxy(this._touchStart, this)); e.stopPropagation(); }; ZoomService.prototype._activeZoomClose = function (forceDispose) { if (!this._activeZoom) return; if (forceDispose) { this._activeZoom.dispose(); } else { this._activeZoom.close(); } this._$window.off('.zoom'); this._$document.off('.zoom'); this._activeZoom = null; }; ZoomService.prototype._scrollHandler = function (e) { if (this._initialScrollPosition === null) this._initialScrollPosition = window.scrollY; var deltaY = this._initialScrollPosition - window.scrollY; if (Math.abs(deltaY) >= 40) this._activeZoomClose(); }; ZoomService.prototype._keyHandler = function (e) { if (e.keyCode == 27) this._activeZoomClose(); }; ZoomService.prototype._clickHandler = function (e) { e.stopPropagation(); e.preventDefault(); this._activeZoomClose(); }; ZoomService.prototype._touchStart = function (e) { this._initialTouchPosition = e.touches[0].pageY; $(e.target).on('touchmove.zoom', $.proxy(this._touchMove, this)); }; ZoomService.prototype._touchMove = function (e) { if (Math.abs(e.touches[0].pageY - this._initialTouchPosition) > 10) { this._activeZoomClose(); $(e.target).off('touchmove.zoom'); } }; function Zoom (img) { this._fullHeight = this._fullWidth = this._overlay = this._targetImageWrap = null; this._targetImage = img; this._$body = $(document.body); } Zoom.OFFSET = 80; Zoom._MAX_WIDTH = 2560; Zoom._MAX_HEIGHT = 4096; Zoom.prototype.zoomImage = function () { var img = document.createElement('img'); img.onload = $.proxy(function () { this._fullHeight = Number(img.height); this._fullWidth = Number(img.width); this._zoomOriginal(); }, this); img.src = this._targetImage.src; }; Zoom.prototype._zoomOriginal = function () { this._targetImageWrap = document.createElement('div'); this._targetImageWrap.className = 'zoom-img-wrap'; this._targetImage.parentNode.insertBefore(this._targetImageWrap, this._targetImage); this._targetImageWrap.appendChild(this._targetImage); $(this._targetImage) .addClass('zoom-img') .attr('data-action', 'zoom-out'); $('.k-postcontent').css('overflow','visible'); this._overlay = document.createElement('div'); this._overlay.className = 'zoom-overlay'; document.body.appendChild(this._overlay); this._calculateZoom(); this._triggerAnimation(); }; Zoom.prototype._calculateZoom = function () { this._targetImage.offsetWidth ; var originalFullImageWidth = this._fullWidth; var originalFullImageHeight = this._fullHeight; var scrollTop = window.scrollY; var maxScaleFactor = originalFullImageWidth / this._targetImage.width; var viewportHeight = (window.innerHeight - Zoom.OFFSET); var viewportWidth = (window.innerWidth - Zoom.OFFSET); var imageAspectRatio = originalFullImageWidth / originalFullImageHeight; var viewportAspectRatio = viewportWidth / viewportHeight; if (originalFullImageWidth < viewportWidth && originalFullImageHeight < viewportHeight) { this._imgScaleFactor = maxScaleFactor; } else if (imageAspectRatio < viewportAspectRatio) { this._imgScaleFactor = (viewportHeight / originalFullImageHeight) * maxScaleFactor; } else { this._imgScaleFactor = (viewportWidth / originalFullImageWidth) * maxScaleFactor; } }; Zoom.prototype._triggerAnimation = function () { this._targetImage.offsetWidth ; var imageOffset = $(this._targetImage).offset(); var scrollTop = window.scrollY; var viewportY = scrollTop + (window.innerHeight / 2); var viewportX = (window.innerWidth / 2); var imageCenterY = imageOffset.top + (this._targetImage.height / 2); var imageCenterX = imageOffset.left + (this._targetImage.width / 2); this._translateY = viewportY - imageCenterY; this._translateX = viewportX - imageCenterX; $(this._targetImage).css('transform', 'scale(' + this._imgScaleFactor + ')'); $(this._targetImageWrap).css('transform', 'translate(' + this._translateX + 'px, ' + this._translateY + 'px) translateZ(0)'); this._$body.addClass('zoom-overlay-open'); }; Zoom.prototype.close = function () { this._$body .removeClass('zoom-overlay-open') .addClass('zoom-overlay-transitioning'); $(this._targetImage).css('transform', ''); $(this._targetImageWrap).css('transform', ''); $(this._targetImage) .one($.support.transition.end, $.proxy(this.dispose, this)) .emulateTransitionEnd(300); }; Zoom.prototype.dispose = function () { if (this._targetImageWrap && this._targetImageWrap.parentNode) { $(this._targetImage) .removeClass('zoom-img') .attr('data-action', 'zoom'); $('.k-postcontent').css('overflow','hidden'); this._targetImageWrap.parentNode.replaceChild(this._targetImage, this._targetImageWrap); this._overlay.parentNode.removeChild(this._overlay); this._$body.removeClass('zoom-overlay-transitioning'); } }; new ZoomService().listen(); }(jQuery); </script> </section> </div> <script> if ('serviceWorker' in navigator) { navigator.serviceWorker.register("/sw.js").then(function() { console.log("Service Worker Registered"); }); } </script> <link rel="stylesheet" href="/assets/css/customCss.css"> <footer class="mdui-m-t-5"> <div class="mdui-card"> <div class="mdui-card-content mdui-shadow-0 mdui-p-a-5"> <div class="mdui-container"> <div class="mdui-row-sm-3 k-footer-sns"> <div class="mdui-col"> <div class="mdui-row"> <div class="mdui-col-xs-4 mdui-col-sm-3 mdui-col-md-2 "> <a href="https://github.com"><div class="mdui-center k-footer-icon k-github"></div></a> </div> <div class="mdui-col-xs-4 mdui-col-sm-3 mdui-col-md-2 "> <a href="https://web.telegram.org"><div class="mdui-center k-footer-icon k-telegram"></div></a> </div> <div class="mdui-col-xs-4 mdui-col-sm-3 mdui-col-md-2 "> <a href="https://twitter.com/"><div class="mdui-center k-footer-icon k-twitter"></div></a> </div> </div> </div> <div class="mdui-col mdui-text-center" style="line-height:48px"> Copyright ©<script>var fd=new Date;document.write("&nbsp;"+fd.getFullYear()+"&nbsp;")</script> H4ck and that </div> <div class="mdui-col mdui-text-center mdui-typo"> <div>Powered by <a href="https://jekyllrb.com">Jekyll</a></div> <div>Theme <a href="https://github.com/KeJunMao/jekyll-theme-mdui">Jekyll Theme MDUI</a></div> </div> </div> </div> </div> </div> </footer> </body> </html>